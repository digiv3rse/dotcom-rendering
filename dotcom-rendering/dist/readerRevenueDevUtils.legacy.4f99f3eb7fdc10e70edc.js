"use strict";(self.webpackChunk_guardian_dotcom_rendering=self.webpackChunk_guardian_dotcom_rendering||[]).push([[2509],{8534:(e,n,t)=>{t.d(n,{Hs:()=>i,Jt:()=>a,n1:()=>o});var r="gu.alreadyVisited",o=function(){var e,n=parseInt(null!==(e=localStorage.getItem(r))&&void 0!==e?e:"",10);return Number.isNaN(n)?0:n},a=function(e){localStorage.setItem(r,e.toString())},i=function(){var e=o();a(e+1)}},9175:(e,n,t)=>{t.d(n,{Am:()=>D,BQ:()=>w,C6:()=>f,CC:()=>p,G9:()=>M,H2:()=>P,K3:()=>m,Pl:()=>R,S9:()=>b,T0:()=>S,Ty:()=>v,ZD:()=>A,cs:()=>B,nh:()=>E,qQ:()=>_,qw:()=>k,tq:()=>I,y0:()=>g});var r=t(5809),o=t(7791),a=t(824),i=t.n(a),c=t(5226),u=t(4857),s=t(3904),l=t(2516),d=t(3287),f="gu_hide_support_messaging",v="gu_recurring_contributor",m="gu.contributions.recurring.contrib-timestamp.Monthly",g="gu.contributions.recurring.contrib-timestamp.Annual",p="gu.contributions.contrib-timestamp",h="gu.noRRBannerTimestamp",w="v3",C=function(){return!("true"===(0,u.e)({name:f}))},S=function(e){var n="true"===(0,u.e)({name:v}),t=null!==(0,u.e)({name:m,shouldMemoize:!0}),r=null!==(0,u.e)({name:g,shouldMemoize:!0});return e&&(n||t||r)},_=function(){var e=(0,u.e)({name:"gu_one_off_contribution_date"}),n=(0,u.e)({name:p});if(e||n){var t=e?Date.parse(e):0,r=n?parseInt(n,10):0;return t>r?t:r||void 0}},I=function(){var e=_();if(void 0!==e){var n=new Date(e),t=n.getFullYear(),r=(n.getMonth()+1).toString().padStart(2,"0"),o=n.getDate().toString().padStart(2,"0");return"".concat(t,"-").concat(r,"-").concat(o)}},T=function(){var e,n=_();return void 0!==n&&(e=Date.now()-n,Math.floor(e/864e5)<=90)},b=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!C()||S(e)||T()},U=[1,3,7],y=[1,3,5,7],M=function(){return new Promise((function(e){(0,u.e)({name:"gu-cmp-disabled",shouldMemoize:!0})&&e(!0),(0,c.onConsentChange)((function(n){var t=n.ccpa,r=n.tcfv2,o=n.aus;if(t||o)e(!0);else if(r){var a=U.every((function(e){return r.consents[e]}));a||(window.localStorage.removeItem("gu.history.dailyArticleCount"),window.localStorage.removeItem("gu.history.weeklyArticleCount")),e(a)}}))}))},D=function(){var e=(0,o.Z)(i().mark((function e(){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M();case 2:return n=e.sent,e.abrupt("return",!n||null!==(0,u.e)({name:"gu_article_count_opt_out"}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=function(){var e=(0,s.useState)("Pending"),n=(0,r.Z)(e,2),t=n[0],o=n[1];return(0,d.t)((function(){D().then(o).catch((function(){return o(!0)}))}),[]),t},P=function(){return new Promise((function(e){(0,u.e)({name:"gu-cmp-disabled",shouldMemoize:!0})&&e(!0),(0,c.onConsentChange)((function(n){var t=n.ccpa,r=n.tcfv2,o=n.aus;if(t||o)e(!0);else if(r){var a=y.every((function(e){return r.consents[e]}));e(a)}}))}))},R=function(){var e=window.localStorage.getItem(h);if(e&&!Number.isNaN(parseInt(e,10))){var n=parseInt(e,10)+12e5>Date.now();return n||window.localStorage.removeItem(h),n}return!1},A=function(){return window.localStorage.setItem(h,"".concat(Date.now()))},E=function(e){return function(){return new Promise((function(n){var t;setTimeout((function(){return n(null)}),1e3),(t=e,(0,l._)(t).then((function(e){var n;return null===(n=e.user)||void 0===n?void 0:n.primaryEmailAddress})).catch((function(e){window.guardian.modules.sentry.reportError(e,"getEmail")}))).then((function(e){n(e||null)}))}))}},B=function(){var e=(0,u.e)({name:"GU_CO_COMPLETE",shouldMemoize:!0});if(e){var n;try{n=JSON.parse(decodeURIComponent(e))}catch(e){}return n}}},2516:(e,n,t)=>{t.d(n,{T:()=>u,_:()=>c});var r=t(3742);function o(e){if(!e.ok)throw Error(e.statusText||"getIdApiUserData | An api call returned HTTP status ".concat(e.status));return e}var a=function(e){return fetch(e,{credentials:"include"}).then(o).then((function(e){return e.json()}))},i={},c=function(e){if(!i.idapiUserMeResponse){var n=(0,r.p)(e,"user/me");i.idapiUserMeResponse=a(n)}return i.idapiUserMeResponse},u=function(e){if(!i.idapiUserIdentifiersResponse){var n=(0,r.p)(e,"user/me/identifiers");i.idapiUserIdentifiersResponse=a(n)}return i.idapiUserIdentifiersResponse}},902:(e,n,t)=>{t.r(n),t.d(n,{changeGeolocation:()=>M,getForcedVariant:()=>D,showMeTheBanner:()=>b,showMeTheEpic:()=>T,showNextVariant:()=>U,showPreviousVariant:()=>y});var r=t(5809),o=t(5472),a=t(6793),i=t(1862),c=t(1681),u=t(7703),s=function(e){var n=e.name,t=e.value,s=e.daysToLive,l=e.isCrossSubdomain,d=void 0!==l&&l,f=new Date;if(!(0,c.I)(n,t))throw new Error("".concat(o.P," ").concat(n,"=").concat(t));if(s?f.setUTCDate(f.getUTCDate()+s):(f.setUTCMonth(f.getUTCMonth()+5),f.setUTCDate(1)),document.cookie="".concat(n,"=").concat(t,"; path=/; expires=").concat(f.toUTCString(),";").concat((0,i.B)({isCrossSubdomain:d})),u.k.has(n)){var v=(0,a.H)(n),m=(0,r.Z)(v,1)[0];m&&u.k.set(n,m)}},l=t(4857),d=t(7647),f=t(232),v=t(8534),m=t(9175),g=t(6358),p=[m.C6,m.Ty,m.K3,m.y0,m.CC],h=function(){localStorage.removeItem("gu.prefs.engagementBannerLastClosedAt"),localStorage.removeItem("gu.prefs.subscriptionBannerLastClosedAt"),localStorage.removeItem("gu.noRRBannerTimestamp")},w="GU_mvt_id",C=1e6,S=function(){var e,n=parseInt(null!==(e=(0,l.e)({name:w}))&&void 0!==e?e:"10",10);n&&s(n===C?{name:w,value:"1"}:{name:w,value:"".concat(n+1)})},_=function(){var e,n=parseInt(null!==(e=(0,l.e)({name:w}))&&void 0!==e?e:"10",10);n&&s(0===n?{name:w,value:C.toString()}:{name:w,value:"".concat(n-1)})},I=function(e,n){n?alert('This page has "Prevent membership/contribution appeals" ticked in Composer. Please try a different page'):(p.forEach((function(e){return t=(n={name:e}).name,o=void 0!==(r=n.currentDomainOnly)&&r,a="expires=Thu, 01 Jan 1970 00:00:01 GMT;",i="path=/;",document.cookie="".concat(t,"=;").concat(i).concat(a),void(o||(document.cookie="".concat(t,"=;").concat(i).concat(a," domain=").concat((0,d.W)(),";")));var n,t,r,o,a,i})),localStorage.removeItem("gu.contributions.views"),e&&s({name:m.CC,value:Date.now().toString()}),window.location.reload())},T=function(){I(arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1?arguments[1]:void 0)},b=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1?arguments[1]:void 0;h(),(0,v.Jt)(2),I(e,n)},U=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1?arguments[1]:void 0;S(),I(e,n)},y=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1?arguments[1]:void 0;_(),I(e,n)},M=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1?arguments[1]:void 0;(0,g.A)().then((function(t){var r=window.prompt("Enter two-letter geolocation code (e.g. GB, US, AU). Current is ".concat(null!=t?t:"null","."));"UK"===r?alert("'UK' is not a valid geolocation - please use 'GB' instead!"):r&&(f.t.local.set("gu.geo.override",r),I(e,n))})).catch((function(e){console.error("changeGeolocation - error: ".concat(String(e)))}))},D=function(e){if(URLSearchParams){var n=new URLSearchParams(window.location.search).get("force-".concat(e));if(n)return n}return null}},3287:(e,n,t)=>{t.d(n,{t:()=>a});var r=t(5809),o=t(3904),a=function(e,n){var t=(0,o.useState)(!1),a=(0,r.Z)(t,2),i=a[0],c=a[1],u=n.every((function(e){return void 0!==e}));(0,o.useEffect)((function(){!i&&u&&(e(),c(!0))}),[i,u,e])}},3742:(e,n,t)=>{t.d(n,{p:()=>o});var r=/\b\/{2,}/g,o=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return n.join("/").replace(r,"/")}}}]);
//# sourceMappingURL=readerRevenueDevUtils.legacy.4f99f3eb7fdc10e70edc.js.map