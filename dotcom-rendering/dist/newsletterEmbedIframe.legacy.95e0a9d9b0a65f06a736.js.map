{"version":3,"file":"newsletterEmbedIframe.legacy.95e0a9d9b0a65f06a736.js","mappings":"kMAEMA,EAAiB,CAAC,+BACXC,EAAwB,WACjC,IAAMC,EAAa,GAAGC,MAAMC,KAAKC,SAASC,iBAAiB,uBA+C3D,OA3CAJ,EAAWK,SAAQ,SAACC,GAAY,IAAD,EACP,QAApB,EAAAA,EAAOC,qBAAa,OAApB,EAAsBC,YAAY,SAAU,8BAChD,IACAC,OAAOC,iBAAiB,WAAW,SAACC,GAChC,GAAKb,EAAec,SAASD,EAAME,QAAnC,CAEA,IAAMC,EAAUd,EAAWe,QAAO,SAACC,GAC/B,IACI,GAAwB,OAApBA,EAAET,eAA2C,OAAjBI,EAAMM,OAClC,OAAOD,EAAET,gBAAkBI,EAAMM,MAKzC,CAFA,MAAOC,GACH,OAAO,CACX,CACA,OAAO,CACX,IACA,GAAuB,IAAnBJ,EAAQK,OACR,IACI,IAAMC,EAAUC,KAAKC,MAAMX,EAAMY,MACjC,KAAKC,EAAAA,EAAAA,GAASJ,IAAoC,iBAAjBA,EAAQK,KACrC,OAEK,eADDL,EAAQK,MAERX,EAAQT,SAAQ,SAACC,GACb,GAA6B,iBAAlBc,EAAQM,MACfpB,EAAOqB,OAAM,UAAMP,EAAQM,YAE1B,GAA6B,iBAAlBN,EAAQM,MAAoB,CACxC,IAAMA,EAAQE,SAASR,EAAQM,MAAO,IAClCG,OAAOC,UAAUJ,KACjBpB,EAAOqB,OAAM,UAAMD,GAE3B,CACJ,GAMA,CAAZ,MAAOR,GAAK,CAnCN,CAqCd,IACOa,QAAQC,SACnB,C","sources":["webpack://@guardian/dotcom-rendering/./src/web/browser/newsletterEmbedIframe.ts"],"sourcesContent":["import { isObject } from '@guardian/libs';\n// No trailing slash!\nconst allowedOrigins = ['https://www.theguardian.com'];\nexport const newsletterEmbedIframe = () => {\n    const allIframes = [].slice.call(document.querySelectorAll('.email-sub__iframe'));\n    // Tell the iframes to resize once this script is loaded\n    // Otherwise, earlier resize events might be missed\n    // So we don't have to load this script as a priority on each load\n    allIframes.forEach((iframe) => {\n        iframe.contentWindow?.postMessage('resize', 'https://www.theguardian.com');\n    });\n    window.addEventListener('message', (event) => {\n        if (!allowedOrigins.includes(event.origin))\n            return;\n        const iframes = allIframes.filter((i) => {\n            try {\n                if (i.contentWindow !== null && event.source !== null) {\n                    return i.contentWindow === event.source;\n                }\n            }\n            catch (e) {\n                return false;\n            }\n            return false;\n        });\n        if (iframes.length !== 0) {\n            try {\n                const message = JSON.parse(event.data);\n                if (!isObject(message) || typeof message.type !== 'string')\n                    return;\n                switch (message.type) {\n                    case 'set-height':\n                        iframes.forEach((iframe) => {\n                            if (typeof message.value === 'number') {\n                                iframe.height = `${message.value}`;\n                            }\n                            else if (typeof message.value === 'string') {\n                                const value = parseInt(message.value, 10);\n                                if (Number.isInteger(value)) {\n                                    iframe.height = `${value}`;\n                                }\n                            }\n                        });\n                        break;\n                    default:\n                }\n                // eslint-disable-next-line no-empty\n            }\n            catch (e) { }\n        }\n    });\n    return Promise.resolve();\n};\n"],"names":["allowedOrigins","newsletterEmbedIframe","allIframes","slice","call","document","querySelectorAll","forEach","iframe","contentWindow","postMessage","window","addEventListener","event","includes","origin","iframes","filter","i","source","e","length","message","JSON","parse","data","isObject","type","value","height","parseInt","Number","isInteger","Promise","resolve"],"sourceRoot":""}