"use strict";(self.webpackChunk_guardian_dotcom_rendering=self.webpackChunk_guardian_dotcom_rendering||[]).push([[1450],{7209:(e,t,n)=>{n.r(t),n.d(t,{StickyBottomBanner:()=>W});var i=n(7800),o=n(8706),r=n(1614),s=n(3904),a=n(5670),c=n(9658),d=n(6134),l=n(6622),u=n(7617),m=n(7410),p=n(397),g=n(43),y=n(9038),h=n(1780),C=n(9901),w=n(2011);function b(){const e=(t=["\n\tposition: fixed;\n\tbottom: -1px;\n\twidth: 100%;\n\t","\n"],n||(n=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(n)}})));var t,n;return b=function(){return e},e}const v=(0,g.css)(b(),(0,C.K)("banner")),S=e=>{let{BrazeComponent:t,meta:n,idApiUrl:o}=e;(0,s.useEffect)((()=>{var e;n.logImpressionWithBraze(),(0,y.X4)({component:{componentType:"RETENTION_ENGAGEMENT_BANNER",id:null!==(e=n.dataFromBraze.ophanComponentId)&&void 0!==e?e:n.dataFromBraze.componentName},action:"VIEW"})}),[]);const r=n.dataFromBraze.componentName;return r?(0,i.jsx)("div",{css:v,children:(0,i.jsx)(t,{logButtonClickWithBraze:n.logButtonClickWithBraze,submitComponentEvent:y.X4,componentName:r,brazeMessageProps:n.dataFromBraze,subscribeToNewsletter:async e=>{await fetch("".concat(o,"/users/me/newsletters"),{method:"PATCH",body:JSON.stringify({id:e,subscribed:!0}),credentials:"include"})}})}):null},f=e=>{let{meta:t,idApiUrl:o}=e;const[r,a]=(0,s.useState)();return(0,s.useEffect)((()=>{Promise.all([n.e(3033),n.e(9861),n.e(7371)]).then(n.bind(n,5325)).then((e=>{a((()=>e.BrazeBannerComponent))})).catch((e=>window.guardian.modules.sentry.reportError(e,"braze-banner")))}),[]),(0,i.jsx)(i.Fragment,{children:r?(0,i.jsx)(S,{BrazeComponent:r,meta:t,idApiUrl:o}):(0,i.jsx)("div",{})})};var A=n(1279),B=n(4642),I=n(4914),O=n(3633),P=n(6354),E=n(4463);function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){j(e,t,n[t])}))}return e}function z(){const e=(t=["\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\t","\n\t\t\t\t"],n||(n=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(n)}})));var t,n;return z=function(){return e},e}const R=async e=>{let{isSignedIn:t,shouldHideReaderRevenue:n,isPaidContent:i,alreadyVisitedCount:o,engagementBannerLastClosedAt:s,subscriptionBannerLastClosedAt:a,signInBannerLastClosedAt:c,countryCode:d,optedOutOfArticleCount:l,asyncArticleCounts:u,sectionId:m,tags:p,contentType:g}=e;const y=await u,h=null==y?void 0:y.weeklyArticleHistory,C=(e=>{const t=null==e?void 0:e.dailyArticleHistory[0];if(t)return t.day===(0,O.x2)()?t.count:0})(y),w=(0,r.e)({name:"bwid",shouldMemoize:!0});return{tracking:{ophanPageId:window.guardian.config.ophan.pageViewId,platformId:"GUARDIAN_WEB",clientName:"dcr",referrerUrl:window.location.origin+window.location.pathname},targeting:{alreadyVisitedCount:o,shouldHideReaderRevenue:n,isPaidContent:i,showSupportMessaging:!(0,I.S9)(t),engagementBannerLastClosedAt:s,subscriptionBannerLastClosedAt:a,signInBannerLastClosedAt:c,mvtId:Number((0,r.e)({name:"GU_mvt_id",shouldMemoize:!0})),countryCode:d,weeklyArticleHistory:h,articleCountToday:C,hasOptedOutOfArticleCount:l,modulesVersion:I.BQ,sectionId:m,tagIds:p.map((e=>e.id)),contentType:g,browserId:await(0,I.H2)()&&null!=w?w:void 0,purchaseInfo:(0,I.cs)(),isSignedIn:t,lastOneOffContributionDate:(0,I.tq)()}}},T=async e=>{let{remoteBannerConfig:t,isSignedIn:n,asyncCountryCode:i,contentType:o,sectionId:r,shouldHideReaderRevenue:s,isMinuteArticle:a,isPaidContent:c,isSensitive:d,tags:l,contributionsServiceUrl:u,alreadyVisitedCount:m,engagementBannerLastClosedAt:p,subscriptionBannerLastClosedAt:g,signInBannerLastClosedAt:y,isPreview:h,idApiUrl:C,signInGateWillShow:w,asyncArticleCounts:b}=e;if(!t)return{show:!1};if(s||c||h||w)return{show:!1};const v=(0,I.cs)()&&!n&&!y,S=window.location.search.includes("force-banner");if(!v&&!S&&p&&g&&(0,I.Pl)())return{show:!1};const f=await i,B=await(0,I.Am)(),O=await R({isSignedIn:n,countryCode:f,contentType:o,sectionId:r,shouldHideReaderRevenue:s,isMinuteArticle:a,isPaidContent:c,tags:l,contributionsServiceUrl:u,isSensitive:d,alreadyVisitedCount:m,engagementBannerLastClosedAt:p,subscriptionBannerLastClosedAt:g,signInBannerLastClosedAt:y,optedOutOfArticleCount:B,asyncArticleCounts:b}),P=await(0,A.Eg)(u,O);if(!P.data)return p&&g&&(0,I.ZD)(),{show:!1};const{module:E,meta:j}=P.data;return{show:!0,meta:{module:E,meta:j,fetchEmail:n?(0,I.nh)(C):void 0}}},k=async e=>{let{remoteBannerConfig:t,isSignedIn:n,asyncCountryCode:i,contentType:o,sectionId:r,shouldHideReaderRevenue:s,isMinuteArticle:a,isPaidContent:c,isSensitive:d,tags:l,contributionsServiceUrl:u,alreadyVisitedCount:m,engagementBannerLastClosedAt:p,subscriptionBannerLastClosedAt:g,section:y,asyncArticleCounts:h}=e;const C="crosswords"===y||l.some((e=>"Series"===e.type&&"Sudoku"===e.title));if(s)return{show:!1};if(C&&t){const e=await i,t=await(0,I.Am)(),y=await R({isSignedIn:n,countryCode:e,contentType:o,sectionId:r,shouldHideReaderRevenue:s,isMinuteArticle:a,isPaidContent:c,tags:l,contributionsServiceUrl:u,isSensitive:d,alreadyVisitedCount:m,engagementBannerLastClosedAt:p,subscriptionBannerLastClosedAt:g,optedOutOfArticleCount:t,asyncArticleCounts:h});return(0,A.Nh)(u,y).then((e=>{if(!e.data)return{show:!1};const{module:t,meta:n}=e.data;return{show:!0,meta:{module:t,meta:n}}}))}return{show:!1}},U=e=>{let{componentTypeName:t,displayEvent:n,meta:o,module:r,fetchEmail:a}=e;const[c,d]=(0,s.useState)(),[l,u]=(0,E.O)({threshold:0,debounce:!0});return(0,m.t)((()=>{void 0!==r&&void 0!==o&&((0,P.R)(),window.guardianPolyfilledImport(r.url).then((e=>{var t;d((()=>null!==(t=e[r.name])&&void 0!==t?t:null))})).catch((e=>{const t="Error importing RR banner: ".concat(String(e));console.log(t),window.guardian.modules.sentry.reportError(new Error(t),"rr-banner")})))}),[]),(0,m.t)((()=>{const{componentType:e}=o;e===t&&(0,B.C4)(n)}),[l,o]),void 0!==c?(0,i.jsx)("div",{ref:u,css:(0,g.css)(z(),(0,C.K)("banner")),children:(0,i.jsx)(c,(p=N({},r.props),h={submitComponentEvent:y.X4,fetchEmail:a},h=null!=h?h:{},Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(h)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(h)).forEach((function(e){Object.defineProperty(p,e,Object.getOwnPropertyDescriptor(h,e))})),p))}):null;var p,h},L=e=>{let{meta:t,module:n,fetchEmail:o}=e;return(0,i.jsx)(U,{componentTypeName:"ACQUISITIONS_SUBSCRIPTIONS_BANNER",displayEvent:"subscription-banner : display",meta:t,module:n,fetchEmail:o})},M=e=>{let{meta:t,module:n}=e;return(0,i.jsx)(U,{componentTypeName:"ACQUISITIONS_OTHER",displayEvent:"puzzles-banner : display",meta:t,module:n})},x=e=>{const t=localStorage.getItem("gu.prefs.".concat(e));return t?JSON.parse(t).value:t},H=e=>{let{id:t,BannerComponent:n,canShowFn:o,isEnabled:r}=e;return e=>{let{isSignedIn:s,asyncCountryCode:a,isPreview:d,asyncArticleCounts:l,signInGateWillShow:u=!1,contentType:m,section:p,shouldHideReaderRevenue:g,isMinuteArticle:y,isPaidContent:h,isSensitive:C,tags:w,contributionsServiceUrl:b,idApiUrl:v}=e;return{candidate:{id:t,canShow:()=>o({remoteBannerConfig:r,isSignedIn:s,asyncCountryCode:a,contentType:m,sectionId:p,shouldHideReaderRevenue:g,isMinuteArticle:y,isPaidContent:h,isSensitive:C,tags:w,contributionsServiceUrl:b,alreadyVisitedCount:(0,c.n1)(),engagementBannerLastClosedAt:x("engagementBannerLastClosedAt"),subscriptionBannerLastClosedAt:x("subscriptionBannerLastClosedAt"),signInBannerLastClosedAt:x("signInBannerLastClosedAt"),section:p,isPreview:d,idApiUrl:v,signInGateWillShow:u,asyncArticleCounts:l}),show:e=>{let{meta:t,module:o,fetchEmail:r}=e;return()=>(0,i.jsx)(n,{meta:t,module:o,fetchEmail:r})}},timeoutMillis:2e3}}},_=(e,t,n,o)=>({candidate:{id:"braze-banner",canShow:()=>(async(e,t,n)=>{const i=(0,h.P)();if(i)return{show:!0,meta:i};if((0,w.p)(n))return{show:!1};try{const n=await e.getMessageForBanner(t),i=e=>{n.logButtonClick(e)},o=()=>{n.logImpression()};return n.extras?{show:!0,meta:{dataFromBraze:n.extras,logImpressionWithBraze:o,logButtonClickWithBraze:i}}:{show:!1}}catch(e){return{show:!1}}})(e,t,o),show:e=>()=>(0,i.jsx)(f,{meta:e,idApiUrl:n})},timeoutMillis:2e3}),W=e=>{let{contentType:t,sectionName:n,section:c,tags:g,isPaidContent:y,isPreview:h,shouldHideReaderRevenue:C,isMinuteArticle:w,isSensitive:b,contributionsServiceUrl:v,idApiUrl:S,pageId:f,keywordIds:A,remoteBannerSwitch:B,puzzleBannerSwitch:I}=e;const{brazeMessages:O}=(0,u._)(S),P=(0,d.A)(),E=!!(0,r.e)({name:"GU_U",shouldMemoize:!0}),[j,N]=(0,s.useState)(null),[z,R]=(0,s.useState)(),U=(e=>{let{isSignedIn:t,contentType:n,sectionName:i,tags:o,isPaidContent:r,isPreview:a}=e;const[c,d]=(0,s.useState)(void 0),[l,u]=(0,s.useState)(void 0),[g,y]=(0,s.useState)(!1),h=(0,p.C)();return(0,m.t)((()=>{const[e,t]=h;d(e),u(t)}),[h]),(0,s.useEffect)((()=>{c&&l&&c.canShow({isSignedIn:!!t,currentTest:l,contentType:n,sectionName:i,tags:o,isPaidContent:r,isPreview:a}).then(y)}),[l,c,t,n,i,o,r,a]),g&&!!c&&!!c.gate})({isSignedIn:E,contentType:t,sectionName:n,tags:g,isPaidContent:y,isPreview:h});return(0,s.useEffect)((()=>{R((0,a.o)(f,A))}),[f,A]),(0,m.t)((()=>{const e={candidates:[{candidate:{id:"cmpUi",canShow:()=>o.cmp.willShowPrivacyMessage().then((e=>e?{show:!0,meta:void 0}:{show:!1})),show:()=>null},timeoutMillis:null},H({id:"puzzles-banner",BannerComponent:M,canShowFn:k,isEnabled:I})({isSignedIn:E,asyncCountryCode:P,isPreview:h,asyncArticleCounts:z,contentType:t,section:c,shouldHideReaderRevenue:C,isMinuteArticle:w,isPaidContent:y,isSensitive:b,tags:g,contributionsServiceUrl:v,idApiUrl:S}),H({id:"reader-revenue-banner",BannerComponent:L,canShowFn:T,isEnabled:B})({isSignedIn:E,asyncCountryCode:P,isPreview:h,asyncArticleCounts:z,signInGateWillShow:U,contentType:t,section:c,shouldHideReaderRevenue:C,isMinuteArticle:w,isPaidContent:y,isSensitive:b,tags:g,contributionsServiceUrl:v,idApiUrl:S}),_(O,{section:n},S,g)],name:"banner"};(0,l.B)(e).then((e=>N(e))).catch((e=>console.error("StickyBottomBanner pickMessage - error: ".concat(String(e)))))}),[E,P,O,z]),j?(0,i.jsx)(j,{}):null}},9658:(e,t,n)=>{n.d(t,{Hs:()=>s,Jt:()=>r,n1:()=>o});const i="gu.alreadyVisited",o=()=>{var e;const t=parseInt(null!==(e=localStorage.getItem(i))&&void 0!==e?e:"",10);return Number.isNaN(t)?0:t},r=e=>{localStorage.setItem(i,e.toString())},s=()=>{const e=o();r(e+1)}},9901:(e,t,n)=>{n.d(t,{K:()=>o});const i=["sticky-video-button","sticky-video","banner","dropdown","burger","expanded-veggie-menu-wrapper","expanded-veggie-menu","mobileSticky","stickyAdWrapperLabsHeader","stickyAdWrapper","stickyAdWrapperNav","editionDropdown","toast","onwardsCarousel","myAccountDropdown","searchHeaderLink","TheGuardian","headerWrapper","articleHeadline","immersiveBlackBox","bodyArea","rightColumnArea","mainMedia","card-nested-link","card-link"],o=e=>"z-index: ".concat((e=>{const t=i.indexOf(e);return-1===t?-1:i.length-t})(e),";")}}]);
//# sourceMappingURL=StickyBottomBanner-importable.modern.014f3b89393f08a37ef7.js.map