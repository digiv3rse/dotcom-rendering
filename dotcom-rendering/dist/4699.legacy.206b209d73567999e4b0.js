"use strict";(self.webpackChunk_guardian_dotcom_rendering=self.webpackChunk_guardian_dotcom_rendering||[]).push([[4699],{8059:(e,n,r)=>{r.d(n,{R:()=>p,o:()=>f});var t=r(5809),a=r(7791),o=r(824),i=r.n(o),u=r(232),c=r(1846),s=r(3904),l=r(9175),d=r(2460),f=function(){var e=(0,a.Z)(i().mark((function e(n,r){var t,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.Am)();case 2:if(!e.sent){e.next=4;break}return e.abrupt("return",void 0);case 4:return window.guardian.weeklyArticleCount||((0,c.DF)(u.t.local,n,r.split(",")),window.guardian.weeklyArticleCount=(0,c.lL)(u.t.local)),window.guardian.dailyArticleCount||((0,d.HN)(),window.guardian.dailyArticleCount=(0,d.lu)()),e.abrupt("return",{weeklyArticleHistory:null!==(t=window.guardian.weeklyArticleCount)&&void 0!==t?t:[],dailyArticleHistory:null!==(a=window.guardian.dailyArticleCount)&&void 0!==a?a:[]});case 7:case"end":return e.stop()}}),e)})));return function(n,r){return e.apply(this,arguments)}}(),p=function(e,n){var r=(0,s.useState)("Pending"),a=(0,t.Z)(r,2),o=a[0],i=a[1];return(0,s.useEffect)((function(){f(e,n).then(i).catch((function(){return i(void 0)}))}),[e,n]),o}},3053:(e,n,r)=>{r.d(n,{P:()=>a});var t=["preview.gutools.co.uk","preview.code.dev-gutools.co.uk","localhost","m.thegulocal.com"],a=function(){if(window.location.hash){var e="force-braze-message",n=window.location.hash;if(n.includes(e)){if(!t.includes(window.location.hostname))return console.log("".concat(e," is not supported on this domain")),null;var r=n.slice(n.indexOf("".concat(e,"="))+e.length+1,n.length);try{return{dataFromBraze:JSON.parse(decodeURIComponent(r)),logImpressionWithBraze:function(){},logButtonClickWithBraze:function(){}}}catch(n){var a=n;console.log("There was an error with ".concat(e,": "),a.message)}}}return null}},6530:(e,n,r)=>{r.d(n,{p:()=>t});var t=function(e){return!0===window.guardian.config.switches.brazeTaylorReport&&!e.find((function(e){return"news/series/cotton-capital"===e.id}))}},9175:(e,n,r)=>{r.d(n,{Am:()=>P,BQ:()=>h,C6:()=>f,CC:()=>w,G9:()=>O,H2:()=>M,K3:()=>v,Pl:()=>_,S9:()=>C,T0:()=>y,Ty:()=>p,ZD:()=>U,cs:()=>D,nh:()=>T,qQ:()=>S,qw:()=>A,tq:()=>z,y0:()=>m});var t=r(5809),a=r(7791),o=r(824),i=r.n(o),u=r(5226),c=r(4857),s=r(3904),l=r(2516),d=r(3287),f="gu_hide_support_messaging",p="gu_recurring_contributor",v="gu.contributions.recurring.contrib-timestamp.Monthly",m="gu.contributions.recurring.contrib-timestamp.Annual",w="gu.contributions.contrib-timestamp",g="gu.noRRBannerTimestamp",h="v3",b=function(){return!("true"===(0,c.e)({name:f}))},y=function(e){var n="true"===(0,c.e)({name:p}),r=null!==(0,c.e)({name:v,shouldMemoize:!0}),t=null!==(0,c.e)({name:m,shouldMemoize:!0});return e&&(n||r||t)},S=function(){var e=(0,c.e)({name:"gu_one_off_contribution_date"}),n=(0,c.e)({name:w});if(e||n){var r=e?Date.parse(e):0,t=n?parseInt(n,10):0;return r>t?r:t||void 0}},z=function(){var e=S();if(void 0!==e){var n=new Date(e),r=n.getFullYear(),t=(n.getMonth()+1).toString().padStart(2,"0"),a=n.getDate().toString().padStart(2,"0");return"".concat(r,"-").concat(t,"-").concat(a)}},k=function(){var e,n=S();return void 0!==n&&(e=Date.now()-n,Math.floor(e/864e5)<=90)},C=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!b()||y(e)||k()},x=[1,3,7],I=[1,3,5,7],O=function(){return new Promise((function(e){(0,c.e)({name:"gu-cmp-disabled",shouldMemoize:!0})&&e(!0),(0,u.onConsentChange)((function(n){var r=n.ccpa,t=n.tcfv2,a=n.aus;if(r||a)e(!0);else if(t){var o=x.every((function(e){return t.consents[e]}));o||(window.localStorage.removeItem("gu.history.dailyArticleCount"),window.localStorage.removeItem("gu.history.weeklyArticleCount")),e(o)}}))}))},P=function(){var e=(0,a.Z)(i().mark((function e(){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O();case 2:return n=e.sent,e.abrupt("return",!n||null!==(0,c.e)({name:"gu_article_count_opt_out"}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){var e=(0,s.useState)("Pending"),n=(0,t.Z)(e,2),r=n[0],a=n[1];return(0,d.t)((function(){P().then(a).catch((function(){return a(!0)}))}),[]),r},M=function(){return new Promise((function(e){(0,c.e)({name:"gu-cmp-disabled",shouldMemoize:!0})&&e(!0),(0,u.onConsentChange)((function(n){var r=n.ccpa,t=n.tcfv2,a=n.aus;if(r||a)e(!0);else if(t){var o=I.every((function(e){return t.consents[e]}));e(o)}}))}))},_=function(){var e=window.localStorage.getItem(g);if(e&&!Number.isNaN(parseInt(e,10))){var n=parseInt(e,10)+12e5>Date.now();return n||window.localStorage.removeItem(g),n}return!1},U=function(){return window.localStorage.setItem(g,"".concat(Date.now()))},T=function(e){return function(){return new Promise((function(n){var r;setTimeout((function(){return n(null)}),1e3),(r=e,(0,l._)(r).then((function(e){var n;return null===(n=e.user)||void 0===n?void 0:n.primaryEmailAddress})).catch((function(e){window.guardian.modules.sentry.reportError(e,"getEmail")}))).then((function(e){n(e||null)}))}))}},D=function(){var e=(0,c.e)({name:"GU_CO_COMPLETE",shouldMemoize:!0});if(e){var n;try{n=JSON.parse(decodeURIComponent(e))}catch(e){}return n}}},2460:(e,n,r)=>{r.d(n,{HN:()=>i,lu:()=>a,x2:()=>o});var t="gu.history.dailyArticleCount",a=function(){var e=localStorage.getItem(t);if(e)try{var n=JSON.parse(e).value;if(!n.length)throw new Error("Invalid gu.history.dailyArticleCount value");return n}catch(e){return void localStorage.removeItem(t)}},o=function(){return Math.floor(Date.now()/864e5)},i=function(){var e,n,r=null!==(e=a())&&void 0!==e?e:[],i=o();if((null===(n=r[0])||void 0===n?void 0:n.day)===i)r[0].count+=1;else{r.unshift({day:i,count:1});var u=i-60,c=r.findIndex((function(e){return e.day&&e.day<u}));c>0&&r.splice(c)}localStorage.setItem(t,JSON.stringify({value:r}))}},2516:(e,n,r)=>{r.d(n,{T:()=>c,_:()=>u});var t=r(3742);function a(e){if(!e.ok)throw Error(e.statusText||"getIdApiUserData | An api call returned HTTP status ".concat(e.status));return e}var o=function(e){return fetch(e,{credentials:"include"}).then(a).then((function(e){return e.json()}))},i={},u=function(e){if(!i.idapiUserMeResponse){var n=(0,t.p)(e,"user/me");i.idapiUserMeResponse=o(n)}return i.idapiUserMeResponse},c=function(e){if(!i.idapiUserIdentifiersResponse){var n=(0,t.p)(e,"user/me/identifiers");i.idapiUserIdentifiersResponse=o(n)}return i.idapiUserIdentifiersResponse}},8078:(e,n,r)=>{r.d(n,{B:()=>f});var t=r(7791),a=r(4649),o=r(824),i=r.n(o),u=r(7789),c=r(3203);function s(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function l(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?s(Object(r),!0).forEach((function(n){(0,a.Z)(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}var d=function(){return null},f=function(e){var n=e.candidates,r=e.name;return new Promise((function(e){var a=n.map((function(e){return t=r,l(l({},n=e),{},{candidate:l(l({},n.candidate),{},{canShow:function(){return new Promise((function(e){var r="messagePicker-canShow-".concat(n.candidate.id),o=(0,u.i)(r);o.start(),null!==n.timeoutMillis&&(a=window.setTimeout((function(){!function(e,n){(0,c.IM)({component:"".concat(n,"-picker-timeout-dcr"),value:e})}(n.candidate.id,t),e({show:!1})}),n.timeoutMillis)),n.candidate.canShow().then((function(t){e(t);var a=o.end();n.reportTiming&&(0,c.IM)({component:r,value:a})})).catch((function(e){return console.error("timeoutify candidate - error: ".concat(String(e)))}))}))}}),cancelTimeout:function(){return void 0!==a&&clearTimeout(a)}});var n,t,a})),o=a.map((function(e){return{candidateConfig:e,canShow:e.candidate.canShow()}})).reduce(function(){var e=(0,t.Z)(i().mark((function e(n,r){var t,a,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.candidateConfig,a=r.canShow,e.next=3,n;case 3:if(!e.sent){e.next=5;break}return e.abrupt("return",n);case 5:return e.next=7,a;case 7:if(o=e.sent,t.cancelTimeout(),!o.show){e.next=11;break}return e.abrupt("return",{candidate:t.candidate,meta:o.meta});case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e)})));return function(n,r){return e.apply(this,arguments)}}(),Promise.resolve(null));o.then((function(n){if(a.map((function(e){return e.cancelTimeout()})),null===n)e(d);else{var r=n.candidate,t=n.meta;e((function(){return r.show(t)}))}})).catch((function(e){return console.error("pickMessage winner - error: ".concat(String(e)))}))}))}},8576:(e,n,r)=>{r.d(n,{R:()=>u});var t=r(43),a=r(7800),o=r(3904),i=!1,u=function(){i||(window.guardian.automat={emotionReact:t,emotionReactJsxRuntime:a,react:o.default},i=!0)}},6849:(e,n,r)=>{r.d(n,{_:()=>P});var t=r(1504),a=r(2699),o=r(7791),i=r(824),u=r.n(i),c=r(232),s=r(4857),l=r(6621),d=r(7789),f=r(3203),p="gu.brazeUserSet",v=r(2516),m=function(){var e=(0,o.Z)(u().mark((function e(n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.T)(n).then((function(e){return e.brazeUuid})).catch((function(e){window.guardian.modules.sentry.reportError(e,"getBrazeUuid")})));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),w=r(5226);function g(e,n){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,n){if(e){if("string"==typeof e)return h(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){r&&(e=r);var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw o}}}}function h(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}var b,y=function(e,n,r){return{isSuccessful:!1,failure:{field:e,data:n},data:r}},S=function(e,n){return[{name:"apiKey",value:Promise.resolve(window.guardian.config.page.brazeApiKey)},{name:"brazeSwitch",value:Promise.resolve(window.guardian.config.switches.brazeSwitch)},{name:"brazeUuid",value:e?m(n):Promise.resolve(null)},{name:"consent",value:new Promise((function(e,n){(0,w.onConsentChange)((function(r){try{e((0,w.getConsentFor)("braze",r))}catch(e){n(e)}}))}))},{name:"isNotPaidContent",value:Promise.resolve(!window.guardian.config.page.isPaidContent)}]},z=function(){var e=(0,o.Z)(u().mark((function e(n,r){var t,a,o,i,c,s,l,d;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=S(n,r),a={},o=g(t),e.prev=3,o.s();case 5:if((i=o.n()).done){e.next=23;break}return c=i.value,s=c.name,l=c.value,e.prev=7,e.next=10,l;case 10:if(!(d=e.sent)){e.next=15;break}a[s]=d,e.next=16;break;case 15:return e.abrupt("return",y(s,d,a));case 16:e.next=21;break;case 18:return e.prev=18,e.t0=e.catch(7),e.abrupt("return",y(s,e.t0 instanceof Error?e.t0.message:e.t0,a));case 21:e.next=5;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(3),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:return e.abrupt("return",{isSuccessful:!0,data:a});case 32:case"end":return e.stop()}}),e,null,[[3,25,28,31],[7,18]])})));return function(n,r){return e.apply(this,arguments)}}(),k={enableLogging:!0,noCookies:!0,baseUrl:"https://sdk.fra-01.braze.eu/api/v3",sessionTimeoutInSeconds:1,minimumIntervalBetweenTriggerActionsInSeconds:0,devicePropertyAllowlist:[]},C=function(){var e=(0,o.Z)(u().mark((function e(n){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e(7845).then(r.t.bind(r,8e3,23));case 2:return(t=e.sent).setLogger((function(e){return(0,l.c)("tx",e)})),t.initialize(n,k),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),x=function(e){return void 0===b&&(b=C(e)),b},I=function(){var e=(0,o.Z)(u().mark((function e(n,r,a,o){var i,c,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i="true"===localStorage.getItem(p),c=!a&&i,s=!o&&i,!(!r&&i||c||s)){e.next=18;break}if(e.prev=5,!n){e.next=11;break}return e.next=9,x(n);case 9:e.sent.wipeData();case 11:t.dL.clear(),localStorage.removeItem(p),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),window.guardian.modules.sentry.reportError(e.t0,"braze-maybeWipeUserData");case 18:case"end":return e.stop()}}),e,null,[[5,15]])})));return function(n,r,t,a){return e.apply(this,arguments)}}(),O=function(){var e=(0,o.Z)(u().mark((function e(n){var r,a,o,i,v,m,w,g,h,b;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.t.local.isAvailable()){e.next=2;break}return e.abrupt("return",{brazeMessages:new t.Vp,brazeCards:new t.J9});case 2:return r=!!(0,s.e)({name:"GU_U",shouldMemoize:!0}),e.next=5,z(r,n);case 5:if((a=e.sent).isSuccessful){e.next=12;break}return o=a.failure,i=a.data,(0,l.c)("tx","Not attempting to show Braze messages. Dependency ".concat(o.field," failed with ").concat(String(o.data),".")),e.next=11,I(i.apiKey,i.brazeUuid,i.consent,i.brazeSwitch);case 11:return e.abrupt("return",{brazeMessages:new t.Vp,brazeCards:new t.J9});case 12:return e.prev=12,(v=(0,d.i)("braze-sdk-load")).start(),e.next=17,x(a.data.apiKey);case 17:return m=e.sent,w=v.end(),(0,f.IM)({component:"braze-sdk-load-timing",value:w}),g=function(e,n){window.guardian.modules.sentry.reportError(e,n)},localStorage.setItem(p,"true"),m.changeUser(a.data.brazeUuid),m.openSession(),h=window.guardian.config.switches.brazeContentCards?new t.BX(m,g):new t.J9,b=new t.uU(m,t.dL,g),e.abrupt("return",{brazeMessages:b,brazeCards:h});case 29:return e.prev=29,e.t0=e.catch(12),e.abrupt("return",{brazeMessages:new t.Vp,brazeCards:new t.J9});case 32:case"end":return e.stop()}}),e,null,[[12,29]])})));return function(n){return e.apply(this,arguments)}}(),P=function(e){var n=(0,a.Z)("braze-message",(function(){return O(e)})),r=n.data;return n.error?{brazeMessages:new t.Vp,brazeCards:new t.J9}:{brazeMessages:null==r?void 0:r.brazeMessages,brazeCards:null==r?void 0:r.brazeCards}}},9213:(e,n,r)=>{r.d(n,{O:()=>u});var t=r(5809),a=r(3198),o=r.n(a),i=r(3904),u=function(e){var n,r=(0,i.useState)(!1),a=(0,t.Z)(r,2),u=a[0],c=a[1],s=(0,i.useState)(null!==(n=e.node)&&void 0!==n?n:null),l=(0,t.Z)(s,2),d=l[0],f=l[1],p=(0,i.useRef)(null),v=function(n){var r=(0,t.Z)(n,1)[0];r&&(r.isIntersecting?c(!0):e.repeat&&c(!1))},m=e.debounce?o()(v,200):v;return(0,i.useEffect)((function(){return p.current&&p.current.disconnect(),window.IntersectionObserver&&(p.current=new window.IntersectionObserver(m,e),d&&p.current.observe(d)),function(){var e;return null===(e=p.current)||void 0===e?void 0:e.disconnect()}}),[d,e,m]),[u,f]}},3287:(e,n,r)=>{r.d(n,{t:()=>o});var t=r(5809),a=r(3904),o=function(e,n){var r=(0,a.useState)(!1),o=(0,t.Z)(r,2),i=o[0],u=o[1],c=n.every((function(e){return void 0!==e}));(0,a.useEffect)((function(){!i&&c&&(e(),u(!0))}),[i,c,e])}}}]);
//# sourceMappingURL=4699.legacy.206b209d73567999e4b0.js.map