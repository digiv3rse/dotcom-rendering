{"version":3,"file":"FetchCommentCounts-importable.modern.4b2fbbdcedf3690db1f2.js","mappings":"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","sources":["webpack://@guardian/dotcom-rendering/../node_modules/@kossnocorp/desvg/index.js","webpack://@guardian/dotcom-rendering/../node_modules/@kossnocorp/desvg/react.js","webpack://@guardian/dotcom-rendering/./src/static/icons/comment.svg","webpack://@guardian/dotcom-rendering/./src/web/components/CardCommentCount.tsx","webpack://@guardian/dotcom-rendering/./src/web/components/FetchCommentCounts.importable.tsx","webpack://@guardian/dotcom-rendering/./src/lib/formatters.ts","webpack://@guardian/dotcom-rendering/./src/web/lib/formatCount.ts","webpack://@guardian/dotcom-rendering/./src/web/lib/useApi.tsx","webpack://@guardian/dotcom-rendering/../node_modules/@guardian/libs/esm/format/ArticleDesign.js","webpack://@guardian/dotcom-rendering/../node_modules/@guardian/libs/esm/format/ArticleDisplay.js","webpack://@guardian/dotcom-rendering/../node_modules/@guardian/libs/esm/format/ArticlePillar.js","webpack://@guardian/dotcom-rendering/../node_modules/@guardian/libs/esm/format/ArticleSpecial.js","webpack://@guardian/dotcom-rendering/../node_modules/@guardian/source-foundations/esm/breakpoints/breakpoints.js","webpack://@guardian/dotcom-rendering/../node_modules/@guardian/source-foundations/esm/index.js","webpack://@guardian/dotcom-rendering/../node_modules/@guardian/source-foundations/esm/mq/mq.js"],"sourcesContent":["module.exports = desvg\n\nfunction desvg (h, svg, props) {\n  props = props || {}\n\n  var content = svg.content\n  var attributes = svg.attributes\n\n  return function (props) {\n    return h(\n      'svg',\n      Object.assign(\n        { dangerouslySetInnerHTML: { __html: content } },\n        attributes,\n        props\n      ),\n      props && props.children\n    )\n  }\n}\n","var desvg = require('.')\nvar React = require('react')\n\nmodule.exports = desvg.bind(null, React.createElement.bind(React))\n","\nmodule.exports = {\"attributes\":{\"width\":\"16\",\"height\":\"16\",\"viewBox\":\"0 0 16 16\"},\"content\":\"<path d=\\\"M13 0l1 1v7l-1 1H7l-2 3H4V9H2L1 8V1l1-1h11z\\\"></path>\"}\nvar desvg = require('@kossnocorp/desvg/react')\nmodule.exports = desvg(module.exports)\n","import { css } from '@emotion/react';\nimport { between, textSans } from '@guardian/source-foundations';\nimport CommentIcon from '../../static/icons/comment.svg';\nimport type { DCRContainerPalette } from '../../types/front';\nimport type { Palette } from '../../types/palette';\nimport { decidePalette } from '../lib/decidePalette';\n\ntype Props = {\n\tcontainerPalette?: DCRContainerPalette;\n\tformat: ArticleFormat;\n\tshort: string;\n\tlong: string;\n\tisDynamo?: true;\n};\n\nconst containerStyles = (palette: Palette, isDynamo?: boolean) => css`\n\tdisplay: flex;\n\tflex-direction: row;\n\t${textSans.xxsmall({ lineHeight: 'tight' })};\n\tmargin-top: -4px;\n\tpadding-left: 5px;\n\tpadding-right: 5px;\n\tcolor: ${isDynamo ? palette.text.dynamoHeadline : palette.text.cardFooter};\n`;\n\nconst svgStyles = (palette: Palette, isDynamo?: boolean) => css`\n\tsvg {\n\t\tmargin-bottom: -5px;\n\t\theight: 14px;\n\t\twidth: 14px;\n\t\tmargin-right: 2px;\n\t\tfill: ${isDynamo\n\t\t\t? palette.text.dynamoHeadline\n\t\t\t: palette.text.cardFooter};\n\t}\n`;\n\nconst longStyles = css`\n\tdisplay: block;\n\n\t${between.leftCol.and.wide} {\n\t\tdisplay: none;\n\t}\n`;\n\nconst shortStyles = css`\n\tdisplay: none;\n\n\t${between.leftCol.and.wide} {\n\t\tdisplay: block;\n\t}\n`;\n\nexport const CardCommentCount = ({\n\tcontainerPalette,\n\tformat,\n\tshort,\n\tlong,\n\tisDynamo,\n}: Props) => {\n\tconst palette = decidePalette(format, containerPalette);\n\treturn (\n\t\t<div css={containerStyles(palette, isDynamo)}>\n\t\t\t<div css={svgStyles(palette, isDynamo)}>\n\t\t\t\t<CommentIcon />\n\t\t\t</div>\n\t\t\t<div css={longStyles} aria-hidden=\"true\">\n\t\t\t\t{long}\n\t\t\t</div>\n\t\t\t<div css={shortStyles} aria-hidden=\"true\">\n\t\t\t\t{short}\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n","import { CacheProvider } from '@emotion/react';\nimport { useEffect, useState } from 'react';\nimport { createRoot } from 'react-dom/client';\nimport type { DCRContainerPalette } from '../../types/front';\nimport { getEmotionCache } from '../browser/islands/emotion';\nimport { formatCount } from '../lib/formatCount';\nimport { useApi } from '../lib/useApi';\nimport { CardCommentCount } from './CardCommentCount';\n\ntype Props = {\n\trepeat?: boolean;\n};\n\ntype MarkerType = {\n\tdiscussionId: string;\n\tformat: ArticleFormat;\n\tisDynamo?: true;\n\tcontainerPalette?: string;\n};\n\ntype RawCountType = {\n\tid: string;\n\tcount: number;\n};\n\ntype EnhancedCountType = {\n\tid: string;\n\tlong: string;\n\tshort: string;\n\tformat: ArticleFormat;\n\tisDynamo?: true;\n\tcontainerPalette?: DCRContainerPalette;\n};\n\n/**\n * @description\n * Reads the dom looking for markers that contain the information needed to render the\n * count\n */\nfunction extractMarkers() {\n\tconst markers: MarkerType[] = [];\n\tdocument\n\t\t.querySelectorAll('[data-discussion-id]')\n\t\t.forEach((element: Element) => {\n\t\t\tif (element instanceof HTMLElement) {\n\t\t\t\ttry {\n\t\t\t\t\tconst { discussionId, format, isDynamo, containerPalette } =\n\t\t\t\t\t\telement.dataset;\n\t\t\t\t\tif (discussionId && format) {\n\t\t\t\t\t\tmarkers.push({\n\t\t\t\t\t\t\tdiscussionId,\n\t\t\t\t\t\t\tformat: JSON.parse(format),\n\t\t\t\t\t\t\tisDynamo: isDynamo ? true : undefined,\n\t\t\t\t\t\t\tcontainerPalette,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\t// Do nothing\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\treturn markers;\n}\n\n/**\n * @description\n * Creates the url used to fetch the count data\n */\nfunction buildUrl(markers: MarkerType[]) {\n\tconst discussionIds = markers.flatMap((marker) => marker.discussionId); // E.g.: ['/p/3pm9v', '/p/4k83z', '/p/6bnba']\n\treturn `https://api.nextgen.guardianapps.co.uk/discussion/comment-counts.json?shortUrls=${discussionIds.join(\n\t\t',',\n\t)}`;\n}\n\n/**\n * @description\n * Converts the count number into a formatted string and parses the stringified\n * format\n *\n * E.g.:\n *   - The 'long' version of 12345 is 12,345\n *   - The 'short' version of 12345 is 12k\n */\nfunction enhanceCounts(\n\tcounts: RawCountType[],\n\tmarkers: MarkerType[],\n): EnhancedCountType[] {\n\treturn counts.map(({ count, id }) => {\n\t\tconst { long, short } = formatCount(count);\n\t\tconst thisMarker = markers.find((marker) => marker.discussionId === id);\n\t\t// We don't get format in the api response so look it up in the array\n\t\t// of DOM markers\n\t\tconst format = thisMarker?.format as ArticleFormat;\n\t\tconst isDynamo = thisMarker?.isDynamo;\n\t\tconst containerPalette =\n\t\t\tthisMarker?.containerPalette as DCRContainerPalette;\n\t\treturn {\n\t\t\tid,\n\t\t\tlong,\n\t\t\tshort,\n\t\t\tformat,\n\t\t\tisDynamo,\n\t\t\tcontainerPalette,\n\t\t};\n\t});\n}\n\n/**\n * @description\n * Takes the long and short version of each count and renders onto the page with react\n */\nfunction renderCounts(counts: EnhancedCountType[]) {\n\tcounts.forEach((count) => {\n\t\tconst container = document.querySelector(\n\t\t\t`[data-discussion-id=\"${count.id}\"]`,\n\t\t);\n\n\t\tif (container) {\n\t\t\tconst root = createRoot(container);\n\t\t\troot.render(\n\t\t\t\t<CacheProvider value={getEmotionCache()}>\n\t\t\t\t\t<CardCommentCount\n\t\t\t\t\t\tformat={count.format}\n\t\t\t\t\t\tshort={count.short}\n\t\t\t\t\t\tlong={count.long}\n\t\t\t\t\t\tisDynamo={count.isDynamo}\n\t\t\t\t\t\tcontainerPalette={count.containerPalette}\n\t\t\t\t\t/>\n\t\t\t\t</CacheProvider>,\n\t\t\t);\n\n\t\t\tcontainer.setAttribute('aria-label', `${count.short} Comments`);\n\t\t}\n\t});\n}\n\n/**\n * @description\n * Makes an api call to fetch the comment counts for all Cards on the page\n *\n * For each Card with comments found (by looking for a marker element) it:\n *\n * - Fetches the comment count data in a single call to Frontend's discussion API\n * - Enhances the data, transforming the count from a number to formatted strings\n * - Uses react 'render' to add the comment counts to their placeholders\n *\n * We do it this was so that we can make a single call, but still render multiple comment counts\n * Using an individual island for each comment count could be more costly, especially on fronts\n *\n * @param {boolean} repeat If true, the fetch call will be repeated on an interval\n */\nexport const FetchCommentCounts = ({ repeat }: Props) => {\n\tconst [url, setUrl] = useState<string | undefined>();\n\n\tuseEffect(() => {\n\t\tconst markers = extractMarkers();\n\t\tsetUrl(buildUrl(markers));\n\t}, []);\n\n\tuseApi<{\n\t\tcounts: RawCountType[];\n\t}>(url, {\n\t\trefreshInterval: repeat ? 15_000 : 0,\n\t\trefreshWhenHidden: false,\n\t\tonSuccess: (data?: { counts?: RawCountType[] }) => {\n\t\t\t// It's possible the DOM has been mutated and there are new Cards showing\n\t\t\t// so we check again\n\t\t\tconst markers = extractMarkers();\n\t\t\tif (data?.counts) {\n\t\t\t\ttry {\n\t\t\t\t\trenderCounts(enhanceCounts(data.counts, markers));\n\t\t\t\t} catch (e) {\n\t\t\t\t\t// Do nothing\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Make sure the list of discussionIds we fetch counts for is up to date\n\t\t\tsetUrl(buildUrl(markers));\n\t\t},\n\t});\n\n\treturn null;\n};\n","const integerCommas = (val: number): string => {\n\tconst digits = val.toFixed(0).split('');\n\tconst len = digits.length;\n\n\tfor (let i = digits.length - 1; i >= 1; i -= 1) {\n\t\tif ((len - i) % 3 === 0) {\n\t\t\tdigits.splice(i, 0, ',');\n\t\t}\n\t}\n\n\treturn digits.join('');\n};\n\nexport { integerCommas };\n","import { integerCommas } from '../../lib/formatters';\n\nexport const formatCount = (\n\tcount?: number,\n): { short: string; long: string } => {\n\tif (count === undefined) return { short: '…', long: '…' };\n\tif (count === 0) return { short: '0', long: '0' };\n\n\tconst countAsInteger = parseInt(count.toFixed(0), 10);\n\tconst displayCountLong = integerCommas(countAsInteger);\n\tconst displayCountShort =\n\t\tcountAsInteger > 10000\n\t\t\t? `${Math.round(countAsInteger / 1000)}k`\n\t\t\t: countAsInteger.toString();\n\n\treturn {\n\t\tshort: displayCountShort,\n\t\tlong: displayCountLong,\n\t};\n};\n","import type { SWRConfiguration } from 'swr';\nimport useSWR from 'swr';\n\nfunction checkForErrors(response: Response) {\n\tif (!response.ok) {\n\t\tthrow Error(\n\t\t\tresponse.statusText ||\n\t\t\t\t`useApi | An api call returned HTTP status ${response.status}`,\n\t\t);\n\t}\n\treturn response;\n}\n\nconst fetcher = (init?: RequestInit) => (url: string) =>\n\tfetch(url, init)\n\t\t.then(checkForErrors)\n\t\t.then((res) => res.json());\n\ninterface ApiResponse<T> {\n\tloading: boolean;\n\tdata?: T;\n\terror?: Error;\n}\n\n/**\n * @description\n * A custom hook to make a GET request using the given url using the SWR lib (https://swr.vercel.app/)\n * returns { loading, error, data }\n * @param {String} url - The url to fetch\n * @param {SWRConfiguration} options - The SWR config object - https://swr.vercel.app/docs/options\n * @param {RequestInit} init - The fetch init object - https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch#supplying_request_options\n * */\nexport const useApi = <T,>(\n\turl?: string,\n\toptions?: SWRConfiguration,\n\tinit?: RequestInit,\n): ApiResponse<T> => {\n\tconst { data, error } = useSWR(url, fetcher(init), options);\n\n\treturn {\n\t\tdata,\n\t\terror,\n\t\tloading: !!url && !error && !data,\n\t};\n};\n","var ArticleDesign;\n(function (ArticleDesign) {\n    ArticleDesign[ArticleDesign[\"Standard\"] = 0] = \"Standard\";\n    ArticleDesign[ArticleDesign[\"Gallery\"] = 1] = \"Gallery\";\n    ArticleDesign[ArticleDesign[\"Audio\"] = 2] = \"Audio\";\n    ArticleDesign[ArticleDesign[\"Video\"] = 3] = \"Video\";\n    ArticleDesign[ArticleDesign[\"Review\"] = 4] = \"Review\";\n    ArticleDesign[ArticleDesign[\"Analysis\"] = 5] = \"Analysis\";\n    ArticleDesign[ArticleDesign[\"Explainer\"] = 6] = \"Explainer\";\n    ArticleDesign[ArticleDesign[\"Comment\"] = 7] = \"Comment\";\n    ArticleDesign[ArticleDesign[\"Letter\"] = 8] = \"Letter\";\n    ArticleDesign[ArticleDesign[\"Feature\"] = 9] = \"Feature\";\n    ArticleDesign[ArticleDesign[\"LiveBlog\"] = 10] = \"LiveBlog\";\n    ArticleDesign[ArticleDesign[\"DeadBlog\"] = 11] = \"DeadBlog\";\n    ArticleDesign[ArticleDesign[\"Recipe\"] = 12] = \"Recipe\";\n    ArticleDesign[ArticleDesign[\"MatchReport\"] = 13] = \"MatchReport\";\n    ArticleDesign[ArticleDesign[\"Interview\"] = 14] = \"Interview\";\n    ArticleDesign[ArticleDesign[\"Editorial\"] = 15] = \"Editorial\";\n    ArticleDesign[ArticleDesign[\"Quiz\"] = 16] = \"Quiz\";\n    ArticleDesign[ArticleDesign[\"Interactive\"] = 17] = \"Interactive\";\n    ArticleDesign[ArticleDesign[\"PhotoEssay\"] = 18] = \"PhotoEssay\";\n    ArticleDesign[ArticleDesign[\"PrintShop\"] = 19] = \"PrintShop\";\n    ArticleDesign[ArticleDesign[\"Obituary\"] = 20] = \"Obituary\";\n    ArticleDesign[ArticleDesign[\"Correction\"] = 21] = \"Correction\";\n    ArticleDesign[ArticleDesign[\"FullPageInteractive\"] = 22] = \"FullPageInteractive\";\n    ArticleDesign[ArticleDesign[\"NewsletterSignup\"] = 23] = \"NewsletterSignup\";\n    ArticleDesign[ArticleDesign[\"Timeline\"] = 24] = \"Timeline\";\n    ArticleDesign[ArticleDesign[\"Profile\"] = 25] = \"Profile\";\n})(ArticleDesign || (ArticleDesign = {}));\n\nexport { ArticleDesign };\n//# sourceMappingURL=ArticleDesign.js.map\n","var ArticleDisplay;\n(function (ArticleDisplay) {\n    ArticleDisplay[ArticleDisplay[\"Standard\"] = 0] = \"Standard\";\n    ArticleDisplay[ArticleDisplay[\"Immersive\"] = 1] = \"Immersive\";\n    ArticleDisplay[ArticleDisplay[\"Showcase\"] = 2] = \"Showcase\";\n    ArticleDisplay[ArticleDisplay[\"NumberedList\"] = 3] = \"NumberedList\";\n})(ArticleDisplay || (ArticleDisplay = {}));\n\nexport { ArticleDisplay };\n//# sourceMappingURL=ArticleDisplay.js.map\n","var ArticlePillar;\n(function (ArticlePillar) {\n    ArticlePillar[ArticlePillar[\"News\"] = 0] = \"News\";\n    ArticlePillar[ArticlePillar[\"Opinion\"] = 1] = \"Opinion\";\n    ArticlePillar[ArticlePillar[\"Sport\"] = 2] = \"Sport\";\n    ArticlePillar[ArticlePillar[\"Culture\"] = 3] = \"Culture\";\n    ArticlePillar[ArticlePillar[\"Lifestyle\"] = 4] = \"Lifestyle\";\n})(ArticlePillar || (ArticlePillar = {}));\n\nexport { ArticlePillar };\n//# sourceMappingURL=ArticlePillar.js.map\n","var ArticleSpecial;\n(function (ArticleSpecial) {\n    ArticleSpecial[ArticleSpecial[\"SpecialReport\"] = 5] = \"SpecialReport\";\n    ArticleSpecial[ArticleSpecial[\"Labs\"] = 6] = \"Labs\";\n    ArticleSpecial[ArticleSpecial[\"SpecialReportAlt\"] = 7] = \"SpecialReportAlt\";\n})(ArticleSpecial || (ArticleSpecial = {}));\n\nexport { ArticleSpecial };\n//# sourceMappingURL=ArticleSpecial.js.map\n","/**\n * [Storybook](https://guardian.github.io/csnx/?path=/docs/source-foundations_media-queries--page) •\n * [Design System](https://theguardian.design/2a1e5182b/p/41be19-grids)\n */\nconst breakpoints = {\n    mobile: 320,\n    mobileMedium: 375,\n    mobileLandscape: 480,\n    phablet: 660,\n    tablet: 740,\n    desktop: 980,\n    leftCol: 1140,\n    wide: 1300,\n};\n\nexport { breakpoints };\n//# sourceMappingURL=breakpoints.js.map\n","import { palette } from './colour/palette.js';\nexport { background, border, brandAltBackground, brandAltBorder, brandAltLine, brandAltText, brandBackground, brandBorder, brandLine, brandText, line, palette, text } from './colour/palette.js';\nexport { descriptionId } from './accessibility/description-id.js';\nexport { focusHalo, focusHaloSpaced } from './accessibility/focus-halo.js';\nexport { generateSourceId } from './accessibility/generate-source-id.js';\nexport { visuallyHidden } from './accessibility/visually-hidden.js';\nexport { transitions } from './animation/transitions.js';\nexport { breakpoints } from './breakpoints/breakpoints.js';\nexport { between, from, until } from './mq/mq.js';\nexport { height, iconSize, remHeight, remWidth, size, width } from './size/size.js';\nexport { remSpace, space } from './space/space.js';\nexport { body, headline, textSans, titlepiece } from './typography/index.js';\nexport { body as bodyObjectStyles, headline as headlineObjectStyles, textSans as textSansObjectStyles, titlepiece as titlepieceObjectStyles } from './typography/api.js';\nexport { bodySizes, fontWeights, fonts, headlineSizes, lineHeights, remBodySizes, remHeadlineSizes, remTextSansSizes, remTitlepieceSizes, textSansSizes, titlepieceSizes } from './typography/data.js';\nexport { appearance } from './utils/supports-queries.js';\nexport { FocusStyleManager } from './accessibility/focus-style-manager.js';\nexport { pxToRem, rootPixelFontSize } from './utils/px-to-rem.js';\nexport { resets } from './utils/resets.js';\nexport { svgBackgroundImage } from './utils/svg-background-image.js';\n\n/**\n * @deprecated exports - to be removed in a future major version.\n * Colours should now be imported from the `palette` object.\n */\nconst { brand, brandAlt, neutral, error, success, news, opinion, sport, culture, lifestyle, labs, specialReport, focus, } = palette;\n\nexport { brand, brandAlt, culture, error, focus, labs, lifestyle, neutral, news, opinion, specialReport, sport, success };\n//# sourceMappingURL=index.js.map\n","import { breakpoints } from '../breakpoints/breakpoints.js';\n\nconst minWidth = (from) => `@media (min-width: ${`${from}px`})`;\nconst maxWidth = (until) => `@media (max-width: ${`${until - 1}px`})`;\nconst minWidthMaxWidth = (from, until) => `@media (min-width: ${`${from}px`}) and (max-width: ${`${until - 1}px`})`;\n/**\n * [Storybook](https://guardian.github.io/csnx/?path=/docs/source-foundations_media-queries--page#from)\n *\n * @example\n *\tconst styles = css`\n *\t\t${from.mobileLandscape} {\n *\t\t\tpadding: 0 20px;\n *\t\t}\n * `;\n */\nconst from = {\n    mobile: minWidth(breakpoints.mobile),\n    mobileMedium: minWidth(breakpoints.mobileMedium),\n    mobileLandscape: minWidth(breakpoints.mobileLandscape),\n    phablet: minWidth(breakpoints.phablet),\n    tablet: minWidth(breakpoints.tablet),\n    desktop: minWidth(breakpoints.desktop),\n    leftCol: minWidth(breakpoints.leftCol),\n    wide: minWidth(breakpoints.wide),\n};\n/**\n * [Storybook](https://guardian.github.io/csnx/?path=/docs/source-foundations_media-queries--page#until)\n *\n * @example\n *\tconst styles = css`\n *\t\t${until.wide} {\n *\t\t\tpadding: 0 40px;\n *\t\t}\n * `;\n */\nconst until = {\n    mobile: maxWidth(breakpoints.mobile),\n    mobileMedium: maxWidth(breakpoints.mobileMedium),\n    mobileLandscape: maxWidth(breakpoints.mobileLandscape),\n    phablet: maxWidth(breakpoints.phablet),\n    tablet: maxWidth(breakpoints.tablet),\n    desktop: maxWidth(breakpoints.desktop),\n    leftCol: maxWidth(breakpoints.leftCol),\n    wide: maxWidth(breakpoints.wide),\n};\n/**\n * [Storybook](https://guardian.github.io/csnx/?path=/docs/source-foundations_media-queries--page#betweenand)\n *\n * @example\n *\tconst styles = css`\n *\t\t${between.phablet.and.desktop} {\n *\t\t\tpadding: 0 32px;\n *\t\t}\n * `;\n */\nconst between = {\n    mobile: {\n        and: {\n            mobileMedium: minWidthMaxWidth(breakpoints.mobile, breakpoints.mobileMedium),\n            mobileLandscape: minWidthMaxWidth(breakpoints.mobile, breakpoints.mobileLandscape),\n            phablet: minWidthMaxWidth(breakpoints.mobile, breakpoints.phablet),\n            tablet: minWidthMaxWidth(breakpoints.mobile, breakpoints.tablet),\n            desktop: minWidthMaxWidth(breakpoints.mobile, breakpoints.desktop),\n            leftCol: minWidthMaxWidth(breakpoints.mobile, breakpoints.leftCol),\n            wide: minWidthMaxWidth(breakpoints.mobileMedium, breakpoints.wide),\n        },\n    },\n    mobileMedium: {\n        and: {\n            mobileLandscape: minWidthMaxWidth(breakpoints.mobileMedium, breakpoints.mobileLandscape),\n            phablet: minWidthMaxWidth(breakpoints.mobileMedium, breakpoints.phablet),\n            tablet: minWidthMaxWidth(breakpoints.mobileMedium, breakpoints.tablet),\n            desktop: minWidthMaxWidth(breakpoints.mobileMedium, breakpoints.desktop),\n            leftCol: minWidthMaxWidth(breakpoints.mobileMedium, breakpoints.leftCol),\n            wide: minWidthMaxWidth(breakpoints.mobileMedium, breakpoints.wide),\n        },\n    },\n    mobileLandscape: {\n        and: {\n            phablet: minWidthMaxWidth(breakpoints.mobileLandscape, breakpoints.phablet),\n            tablet: minWidthMaxWidth(breakpoints.mobileLandscape, breakpoints.tablet),\n            desktop: minWidthMaxWidth(breakpoints.mobileLandscape, breakpoints.desktop),\n            leftCol: minWidthMaxWidth(breakpoints.mobileLandscape, breakpoints.leftCol),\n            wide: minWidthMaxWidth(breakpoints.mobileLandscape, breakpoints.wide),\n        },\n    },\n    phablet: {\n        and: {\n            tablet: minWidthMaxWidth(breakpoints.phablet, breakpoints.tablet),\n            desktop: minWidthMaxWidth(breakpoints.phablet, breakpoints.desktop),\n            leftCol: minWidthMaxWidth(breakpoints.phablet, breakpoints.leftCol),\n            wide: minWidthMaxWidth(breakpoints.phablet, breakpoints.wide),\n        },\n    },\n    tablet: {\n        and: {\n            desktop: minWidthMaxWidth(breakpoints.tablet, breakpoints.desktop),\n            leftCol: minWidthMaxWidth(breakpoints.tablet, breakpoints.leftCol),\n            wide: minWidthMaxWidth(breakpoints.tablet, breakpoints.wide),\n        },\n    },\n    desktop: {\n        and: {\n            leftCol: minWidthMaxWidth(breakpoints.desktop, breakpoints.leftCol),\n            wide: minWidthMaxWidth(breakpoints.desktop, breakpoints.wide),\n        },\n    },\n    leftCol: {\n        and: {\n            wide: minWidthMaxWidth(breakpoints.leftCol, breakpoints.wide),\n        },\n    },\n};\n\nexport { between, from, until };\n//# sourceMappingURL=mq.js.map\n"],"names":["module","exports","h","svg","props","content","attributes","Object","assign","dangerouslySetInnerHTML","__html","children","desvg","React","bind","createElement","containerStyles","palette","isDynamo","css","textSans","lineHeight","text","dynamoHeadline","cardFooter","svgStyles","longStyles","between","shortStyles","CardCommentCount","containerPalette","format","short","long","decidePalette","div","CommentIcon","aria-hidden","extractMarkers","markers","document","querySelectorAll","forEach","element","HTMLElement","discussionId","dataset","push","JSON","parse","undefined","e","buildUrl","discussionIds","flatMap","marker","join","FetchCommentCounts","repeat","url","setUrl","useState","useEffect","useApi","refreshInterval","refreshWhenHidden","onSuccess","data","counts","map","count","id","formatCount","thisMarker","find","enhanceCounts","container","querySelector","createRoot","render","CacheProvider","value","getEmotionCache","setAttribute","countAsInteger","parseInt","toFixed","displayCountLong","val","digits","split","len","length","i","splice","integerCommas","Math","round","toString","checkForErrors","response","ok","Error","statusText","status","options","init","error","useSWR","fetch","then","res","json","fetcher","loading","ArticleDesign","ArticleDisplay","ArticlePillar","ArticleSpecial","breakpoints","mobile","mobileMedium","mobileLandscape","phablet","tablet","desktop","leftCol","wide","brand","brandAlt","neutral","success","news","opinion","sport","culture","lifestyle","labs","specialReport","focus","minWidth","from","maxWidth","until","minWidthMaxWidth","and"],"sourceRoot":""}