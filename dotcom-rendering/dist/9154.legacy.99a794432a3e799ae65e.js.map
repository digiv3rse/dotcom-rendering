{"version":3,"file":"9154.legacy.99a794432a3e799ae65e.js","mappings":"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","sources":["webpack://@guardian/dotcom-rendering/./src/web/components/SignInGate/dismissGate.ts","webpack://@guardian/dotcom-rendering/./src/web/components/SignInGate/displayRule.ts","webpack://@guardian/dotcom-rendering/./src/web/components/SignInGate/gates/main-control.ts","webpack://@guardian/dotcom-rendering/./src/web/components/Lazy.tsx","webpack://@guardian/dotcom-rendering/./src/web/components/SignInGate/gates/main-variant.tsx","webpack://@guardian/dotcom-rendering/./src/web/components/SignInGate/gates/sign-in-gate-copy-test-jan2023.tsx","webpack://@guardian/dotcom-rendering/./src/web/components/SignInGate/signInGate.ts","webpack://@guardian/dotcom-rendering/./src/web/experiments/tests/sign-in-gate-copy-test-variants.ts","webpack://@guardian/dotcom-rendering/./src/web/experiments/tests/sign-in-gate-main-control.ts","webpack://@guardian/dotcom-rendering/./src/web/experiments/tests/sign-in-gate-main-variant.ts","webpack://@guardian/dotcom-rendering/./src/web/lib/useAB.ts","webpack://@guardian/dotcom-rendering/./src/web/lib/useSignInGateSelector.ts"],"sourcesContent":["// TODO: Add localstorage lib from https://github.com/guardian/libs/pull/1 when it is merged\nconst localStorageKey = `gu.prefs.sign-in-gate`;\n// We use this key for storing the date the gate was dismissed against\nconst localStorageDismissedDateKey = (variant, name) => {\n    return `${name}-${variant}`;\n};\n// We use this key for storing the gate dismissed count against\nconst localStorageDismissedCountKey = (variant, name) => {\n    return `gate-dismissed-count-${name}-${variant}`;\n};\n// Invalid json stored against `localStorageKey` should not break signin gate for a user forever\nconst getSigninGatePrefsSafely = () => {\n    try {\n        const prefs = JSON.parse(localStorage.getItem(localStorageKey) ?? '{}');\n        if (typeof prefs === 'object' && typeof prefs.value === 'object') {\n            return prefs.value;\n        }\n        return {};\n    }\n    catch (e) {\n        return {};\n    }\n};\nconst setSigninGatePrefs = (prefs) => {\n    localStorage.setItem(localStorageKey, JSON.stringify({ value: prefs }));\n};\n// set in user preferences that the user has dismissed the gate, set the value to the current ISO date string\n// name is optional, but can be used to differentiate between multiple sign in gate tests\n//\n//\n// This is set in local storage with the following shape:\n//\n// key:   gu.prefs.sign-in-gate\n// value: {\"testVariantName\":\"2020-07-01T10:55:09.085Z\"}\n//\n// We set the value using the key, which remains constant\n// and add an entry to the object with the testname and variant, and use current ISO date string as the value\nexport const setUserDismissedGate = (variant, name) => {\n    try {\n        const prefs = getSigninGatePrefsSafely();\n        prefs[localStorageDismissedDateKey(variant, name)] =\n            new Date().toISOString();\n        setSigninGatePrefs(prefs);\n    }\n    catch (error) {\n        // Alas, sometimes localstorage isn't available\n    }\n};\nexport const unsetUserDismissedGate = (variant, name) => {\n    try {\n        const prefs = getSigninGatePrefsSafely();\n        delete prefs[localStorageDismissedDateKey(variant, name)];\n        setSigninGatePrefs(prefs);\n    }\n    catch (error) {\n        // Alas, sometimes localstorage isn't available\n    }\n};\n// Check if the user has dismissed the gate by checking the user preferences,\n// name is optional, but can be used to differentiate between multiple sign in gate tests\n//\n// This is set in local storage with the following shape:\n//\n// key:   gu.prefs.sign-in-gate\n// value: {\"testVariantName\":\"2020-07-01T10:55:09.085Z\"}\n//\n// We extract the value using the key, which remains constant\n// and the from within the value object we look up the variant we are looking for\nexport const hasUserDismissedGate = (variant, name, window) => {\n    try {\n        const prefs = getSigninGatePrefsSafely();\n        // checks if a dismissal occurred within a given window timeframe in hours\n        if (window !== undefined) {\n            // checks if prefs is empty, ie. the user has not dismissed gate before.\n            if (!prefs[localStorageDismissedDateKey(variant, name)]) {\n                return false;\n            }\n            const dismissalTZ = Date.parse(prefs[localStorageDismissedDateKey(variant, name)]);\n            const hours = (Date.now() - dismissalTZ) / 36e5; //  36e5 is the scientific notation for 60*60*1000, which converts the milliseconds difference into hours.\n            if (hours >= window) {\n                unsetUserDismissedGate(variant, name);\n                return false;\n            }\n            return true;\n        }\n        return !!prefs[localStorageDismissedDateKey(variant, name)];\n    }\n    catch (error) {\n        // Alas, sometimes localstorage isn't available. Please have a sign in gate as an apology\n        return false;\n    }\n};\nconst retrieveDismissedCount = (variant, name) => {\n    try {\n        const prefs = getSigninGatePrefsSafely();\n        const dismissed = prefs[localStorageDismissedCountKey(variant, name)];\n        if (Number.isFinite(dismissed)) {\n            return dismissed;\n        }\n        return 0;\n    }\n    catch (error) {\n        return 0;\n    }\n};\n// Test whether the user has dismissed the gate variant more than `count` times\nexport const hasUserDismissedGateMoreThanCount = (variant, name, count) => {\n    return retrieveDismissedCount(variant, name) > count;\n};\n// Increment the number of times a user has dismissed this gate variant\nexport const incrementUserDismissedGateCount = (variant, name) => {\n    try {\n        const prefs = getSigninGatePrefsSafely();\n        prefs[localStorageDismissedCountKey(variant, name)] =\n            retrieveDismissedCount(variant, name) + 1;\n        setSigninGatePrefs(prefs);\n    }\n    catch (error) {\n        // localstorage isn't available so show the gate\n    }\n};\n","// use the dailyArticleCount from the local storage to see how many articles the user has viewed in a day\nimport { onConsent } from '@guardian/consent-management-platform';\nimport { getDailyArticleCount } from '../../lib/dailyArticleCount';\nimport { hasUserDismissedGateMoreThanCount } from './dismissGate';\n// in our case if this is the n-numbered article or higher the user has viewed then set the gate\nexport const isNPageOrHigherPageView = (n = 2) => {\n    // get daily read article count array from local storage\n    const [dailyCount = {}] = getDailyArticleCount() ?? [];\n    const { count = 0 } = dailyCount;\n    return count >= n;\n};\n// determine if the useragent is running iOS 9 (known to be buggy for sign in flow)\nexport const isIOS9 = () => {\n    // get the browser user agent\n    const ua = navigator.userAgent;\n    // check useragent if the device is an iOS device\n    const appleDevice = /(iPhone|iPod|iPad)/i.test(ua);\n    // check useragent if the os is version 9\n    const os = /(CPU OS 9_)/i.test(ua);\n    // if both true, then it's an apple ios 9 device\n    return appleDevice && os;\n};\n// hide the sign in gate on article types that are not supported\nexport const isValidContentType = (contentType) => {\n    // It's safer to definitively *include* types as we\n    // know new types will not break the sign-in-gate going forward\n    const validTypes = ['Article'];\n    return validTypes.some((type) => contentType === type);\n};\n// hide the sign in gate on certain sections of the site, e.g info, about, help etc.\nexport const isValidSection = (sectionName) => {\n    const invalidSections = [\n        'about',\n        'info',\n        'membership',\n        'help',\n        'guardian-live-australia',\n        'gnm-archive',\n    ];\n    // we check for invalid section by reducing the above array, and then NOT the result so we know\n    // its a valid section\n    return !invalidSections.some((section) => sectionName === section);\n};\n// hide the sign in gate for certain tags on the site\nexport const isValidTag = (tags) => {\n    const invalidTags = ['info/newsletter-sign-up'];\n    return !invalidTags.some((invalidTag) => tags.map((tag) => tag.id).includes(invalidTag));\n};\n// check CMP banner consents\nexport const hasRequiredConsents = () => onConsent()\n    .then(({ canTarget }) => canTarget)\n    .catch(() => false);\nexport const canShowSignInGate = ({ isSignedIn, currentTest, contentType, sectionName, tags, isPaidContent, isPreview, }) => Promise.resolve(!isSignedIn &&\n    !hasUserDismissedGateMoreThanCount(currentTest.variant, currentTest.name, 5) &&\n    isNPageOrHigherPageView(3) &&\n    isValidContentType(contentType) &&\n    isValidSection(sectionName) &&\n    isValidTag(tags) &&\n    // hide the sign in gate on isPaidContent\n    !isPaidContent &&\n    // hide the sign in gate on internal tools preview &&\n    !isPreview &&\n    !isIOS9());\nexport const canShowSignInGateMandatory = async ({ isSignedIn, currentTest, contentType, sectionName, tags, isPaidContent, isPreview, }) => {\n    return ((await hasRequiredConsents()) &&\n        (await canShowSignInGate({\n            isSignedIn,\n            currentTest,\n            contentType,\n            sectionName,\n            tags,\n            isPaidContent,\n            isPreview,\n        })));\n};\n","import { hasUserDismissedGate } from '../dismissGate';\nimport { isIOS9, isNPageOrHigherPageView, isValidContentType, isValidSection, isValidTag, } from '../displayRule';\nconst canShow = ({ isSignedIn, currentTest, contentType, sectionName, tags, isPaidContent, isPreview, }) => Promise.resolve(!isSignedIn &&\n    !hasUserDismissedGate(currentTest.variant, currentTest.name) &&\n    isNPageOrHigherPageView(3) &&\n    isValidContentType(contentType) &&\n    isValidSection(sectionName) &&\n    isValidTag(tags) &&\n    // hide the sign in gate on isPaidContent\n    !isPaidContent &&\n    // hide the sign in gate on internal tools preview\n    !isPreview &&\n    !isIOS9());\nexport const signInGateComponent = {\n    canShow,\n};\n","import { Fragment as _Fragment, jsx as _jsx } from \"@emotion/react/jsx-runtime\";\nimport { css } from '@emotion/react';\nimport { useIsInView } from '../lib/useIsInView';\n// Ensure the ref wrapper expands. This is used for componenents like\n// MostViewedRightWrapper that needs to check it's parent's height\nconst flexGrowStyles = css `\n\tdisplay: flex;\n\tflex-grow: 1;\n`;\nexport const Lazy = ({ children, margin, disableFlexStyles }) => {\n    const [hasBeenSeen, setRef] = useIsInView({\n        rootMargin: `${margin}px`,\n    });\n    // Without this check below typescript complains because it thinks\n    // setRef could be false.\n    if (typeof setRef !== 'function') {\n        return null;\n    }\n    // Why do we check to see if we're disabled here? Because we\n    // use this as a flag to know when a component is\n    // being loaded as part of a Chromatic story or not so that\n    // we can prevent lazy loading our storybook snapshots that we\n    // use for visual regression\n    const renderChildren = hasBeenSeen || Lazy.disabled;\n    return (_jsx(\"div\", { ref: setRef, css: !disableFlexStyles && flexGrowStyles, children: renderChildren && _jsx(_Fragment, { children: children }) }));\n};\nLazy.disabled = false;\n","import { jsx as _jsx, Fragment as _Fragment } from \"@emotion/react/jsx-runtime\";\nimport React, { Suspense } from 'react';\nimport { initPerf } from '../../../browser/initPerf';\nimport { Lazy } from '../../Lazy';\nimport { canShowSignInGate } from '../displayRule';\nconst SignInGateMain = React.lazy(() => {\n    const { start, end } = initPerf('SignInGateMain');\n    start();\n    return import(\n    /* webpackChunkName: \"SignInGateMain\" */ '../gateDesigns/SignInGateMain').then((module) => {\n        end();\n        return { default: module.SignInGateMain };\n    });\n});\nconst SignInGateMainCheckoutComplete = React.lazy(() => {\n    const { start, end } = initPerf('SignInGateMainCheckoutComplete');\n    start();\n    return import(\n    /* webpackChunkName: \"SignInGateMainCheckoutComplete\" */ '../gateDesigns/SignInGateMainCheckoutComplete').then((module) => {\n        end();\n        return { default: module.SignInGateMainCheckoutComplete };\n    });\n});\n/**\n * GATE PERSONALISATION:\n *\n * If the GU_CO_COMPLETE cookie is present, personalise the sign in gate based on the userType\n * and product information in the cookie value.\n * AB tracking will be registered as part of the main gate AB test, but the component Id string\n * in Ophan ComponentEventTracking will have `_personalised_${userType}_${product}` appended.\n * This occurs in the SignInGateSelector.importable.tsx file\n * There is a feature switch called `personaliseSignInGateAfterCheckout` which can be set in the\n * admin tools, and depending on the state of that switch will determine which variant of the\n * gate to show.\n */\nexport const signInGateComponent = {\n    gate: ({ ophanComponentId, dismissGate, guUrl, signInUrl, abTest, checkoutCompleteCookieData, personaliseSignInGateAfterCheckoutSwitch, }) => {\n        return (_jsx(Lazy, { margin: 300, children: _jsx(Suspense, { fallback: _jsx(_Fragment, {}), children: personaliseSignInGateAfterCheckoutSwitch &&\n                    checkoutCompleteCookieData !== undefined ? (_jsx(SignInGateMainCheckoutComplete, { ophanComponentId: ophanComponentId, dismissGate: dismissGate, guUrl: guUrl, signInUrl: signInUrl, abTest: abTest, checkoutCompleteCookieData: checkoutCompleteCookieData })) : (_jsx(SignInGateMain, { ophanComponentId: ophanComponentId, dismissGate: dismissGate, guUrl: guUrl, signInUrl: signInUrl, abTest: abTest })) }) }));\n    },\n    canShow: canShowSignInGate,\n};\n","import { jsx as _jsx, Fragment as _Fragment } from \"@emotion/react/jsx-runtime\";\nimport React, { Suspense } from 'react';\nimport { initPerf } from '../../../browser/initPerf';\nimport { Lazy } from '../../Lazy';\nimport { canShowSignInGate } from '../displayRule';\nconst SignInGateCopyTestJan2023 = React.lazy(() => {\n    const { start, end } = initPerf('SignInGateCopyTestJan2023');\n    start();\n    return import(\n    /* webpackChunkName: \"SignInGateMain\" */ '../gateDesigns/SignInGateCopyTestJan2023').then((module) => {\n        end();\n        return { default: module.SignInGateCopyTestJan2023 };\n    });\n});\nexport const signInGateCopyTestJan2023Component = {\n    gate: ({ ophanComponentId, dismissGate, guUrl, signInUrl, abTest }) => (_jsx(Lazy, { margin: 300, children: _jsx(Suspense, { fallback: _jsx(_Fragment, {}), children: _jsx(SignInGateCopyTestJan2023, { ophanComponentId: ophanComponentId, dismissGate: dismissGate, guUrl: guUrl, signInUrl: signInUrl, abTest: abTest }) }) })),\n    canShow: canShowSignInGate,\n};\n","// Sign in Gate A/B Tests\nimport { signInGateCopyTestJan2023 } from '../../experiments/tests/sign-in-gate-copy-test-variants';\nimport { signInGateMainControl } from '../../experiments/tests/sign-in-gate-main-control';\nimport { signInGateMainVariant } from '../../experiments/tests/sign-in-gate-main-variant';\n// Sign in Gate Types\nimport { signInGateComponent as gateMainControl } from './gates/main-control';\nimport { signInGateComponent as gateMainVariant } from './gates/main-variant';\nimport { signInGateCopyTestJan2023Component } from './gates/sign-in-gate-copy-test-jan2023';\n/* When adding a new test, you need to add the test name to the tests array below,\n   and add a entry for each variant that maps it to a SignInGateComponent in\n   signInGateTestVariantToGateMapping, and in turn match each test id to an component\n   id in signInGateTestIdToComponentId\n*/\nexport const signInGateTests = [\n    signInGateMainVariant,\n    signInGateMainControl,\n    signInGateCopyTestJan2023,\n];\nexport const signInGateTestVariantToGateMapping = {\n    'main-control-4': gateMainControl,\n    'main-variant-4': gateMainVariant,\n    'quick-and-easy': signInGateCopyTestJan2023Component,\n    'take-a-moment': signInGateCopyTestJan2023Component,\n    'sign-in-copy-control': gateMainVariant,\n};\n// Component Id does not need to match gate test name, as ab test info passed separately to ophan\n// Consider Id name relevant to the gate component or design. Use snake_case\nexport const signInGateTestIdToComponentId = {\n    SignInGateMainVariant: 'main_variant_4',\n    SignInGateMainControl: 'main_control_4',\n    SignInGateCopyTestJan2023: 'sign_in_gate_copy_test_jan2023',\n};\n","export const signInGateCopyTestJan2023 = {\n    id: 'SignInGateCopyTestJan2023',\n    start: '2023-01-23',\n    expiry: '2025-12-01',\n    author: 'Lindsey Dew',\n    description: 'Test varying the copy in the call to action for sign in gate',\n    audience: 0.0,\n    audienceOffset: 0.0,\n    successMeasure: 'Users sign in or create a Guardian account',\n    audienceCriteria: '3rd article of the day, lower priority than consent banner, simple articles (not gallery, live etc.), not signed in, not shown after dismiss, not on help, info sections etc. Exclude iOS 9 and guardian-live-australia. Suppresses other banners, and appears over epics',\n    dataLinkNames: 'SignInGateCopyTest',\n    idealOutcome: 'One variants performs at least 2% better than the control and/OR 10% better than the other variant. Neither variant performs 5% worse than the control',\n    showForSensitive: false,\n    canRun: () => true,\n    variants: [\n        {\n            id: 'quick-and-easy',\n            test: () => { },\n        },\n        {\n            id: 'take-a-moment',\n            test: () => { },\n        },\n        {\n            id: 'sign-in-copy-control',\n            test: () => { },\n        },\n    ],\n};\n","export const signInGateMainControl = {\n    id: 'SignInGateMainControl',\n    start: '2020-05-20',\n    expiry: '2025-12-01',\n    author: 'Mahesh Makani',\n    description: 'Show sign in gate to 100% of users on 3rd article view of simple article templates, and show a further 5 times after the first dismissal, with higher priority over banners and epic. Control Audience.',\n    audience: 0.1,\n    audienceOffset: 0.9,\n    successMeasure: 'N/A - User does not see gate, only to compare to variant.',\n    audienceCriteria: '3rd article of the day, lower priority than consent banner, simple articles (not gallery, live etc.), not signed in, not shown after dismiss, not on help, info sections etc. Exclude iOS 9 and guardian-live-australia. Suppresses other banners, and appears over epics',\n    dataLinkNames: 'SignInGateMain',\n    idealOutcome: 'Increase the number of users signed in whilst running at a reasonable scale',\n    showForSensitive: false,\n    canRun: () => true,\n    variants: [\n        {\n            id: 'main-control-4',\n            test: () => { },\n        },\n    ],\n};\n","export const signInGateMainVariant = {\n    id: 'SignInGateMainVariant',\n    start: '2020-06-09',\n    expiry: '2025-12-01',\n    author: 'Mahesh Makani',\n    description: 'Show sign in gate to 100% of users on 3rd article view of simple article templates, and show a further 5 times after the first dismissal, with higher priority over banners and epic. Main/Variant Audience.',\n    audience: 0.9,\n    audienceOffset: 0.0,\n    successMeasure: 'Users sign in or create a Guardian account',\n    audienceCriteria: '3rd article of the day, lower priority than consent banner, simple articles (not gallery, live etc.), not signed in, not shown after dismiss, not on help, info sections etc. Exclude iOS 9 and guardian-live-australia. Suppresses other banners, and appears over epics',\n    dataLinkNames: 'SignInGateMain',\n    idealOutcome: 'Increase the number of users signed in whilst running at a reasonable scale',\n    showForSensitive: false,\n    canRun: () => true,\n    variants: [\n        {\n            id: 'main-variant-4',\n            test: () => { },\n        },\n    ],\n};\n","import { mutate } from 'swr';\nimport useSWRImmutable from 'swr/immutable';\nconst apiPromise = new Promise(() => { });\nconst key = 'ab-tests';\n/**\n * A hook which returns the AB Test Api when available,\n * or undefined otherwise.\n *\n * Leverages an immutable SWR to satisfy all requests to the\n * AB Core. As soon as the tests are available, all instances of\n * the useAB hook will render.\n */\nexport const useAB = () => {\n    const { data } = useSWRImmutable(key, () => apiPromise);\n    return data;\n};\nexport const setABTests = ({ api, participations }) => {\n    void mutate(key, { api, participations }, false);\n};\n","import { signInGateTests, signInGateTestVariantToGateMapping, } from '../components/SignInGate/signInGate';\nimport { useAB } from './useAB';\n/**\n * @description\n * A custom hook to make which selects the sign in gate (component and ab test)\n * to be displayed on the current page\n * */\nexport const useSignInGateSelector = () => {\n    const ab = useAB()?.api;\n    if (!ab)\n        return undefined;\n    const test = ab.firstRunnableTest(signInGateTests);\n    if (!test) {\n        return [null, null];\n    }\n    const currentTest = {\n        name: test.dataLinkNames ?? test.id,\n        variant: test.variantToRun.id,\n        id: test.id,\n    };\n    const gateVariant = signInGateTestVariantToGateMapping[currentTest.variant];\n    if (!gateVariant) {\n        return [null, null];\n    }\n    return [gateVariant, currentTest];\n};\n"],"names":["localStorageKey","localStorageDismissedDateKey","variant","name","localStorageDismissedCountKey","getSigninGatePrefsSafely","prefs","JSON","parse","localStorage","getItem","value","e","setSigninGatePrefs","setItem","stringify","setUserDismissedGate","Date","toISOString","error","hasUserDismissedGate","window","undefined","dismissalTZ","now","unsetUserDismissedGate","retrieveDismissedCount","dismissed","Number","isFinite","hasUserDismissedGateMoreThanCount","count","incrementUserDismissedGateCount","isNPageOrHigherPageView","n","getDailyArticleCount","isIOS9","ua","navigator","userAgent","appleDevice","test","os","isValidContentType","contentType","some","type","isValidSection","sectionName","section","isValidTag","tags","invalidTag","map","tag","id","includes","canShowSignInGate","isSignedIn","currentTest","isPaidContent","isPreview","Promise","resolve","signInGateComponent","canShow","flexGrowStyles","Lazy","children","margin","disableFlexStyles","useIsInView","rootMargin","hasBeenSeen","setRef","renderChildren","disabled","_jsx","ref","css","_Fragment","SignInGateMain","React","initPerf","start","end","then","module","default","SignInGateMainCheckoutComplete","gate","ophanComponentId","dismissGate","guUrl","signInUrl","abTest","checkoutCompleteCookieData","personaliseSignInGateAfterCheckoutSwitch","Suspense","fallback","SignInGateCopyTestJan2023","signInGateCopyTestJan2023Component","signInGateTests","signInGateMainVariant","signInGateMainControl","signInGateCopyTestJan2023","signInGateTestVariantToGateMapping","gateMainControl","gateMainVariant","signInGateTestIdToComponentId","SignInGateMainVariant","SignInGateMainControl","expiry","author","description","audience","audienceOffset","successMeasure","audienceCriteria","dataLinkNames","idealOutcome","showForSensitive","canRun","variants","apiPromise","key","useAB","useSWRImmutable","data","setABTests","api","participations","mutate","useSignInGateSelector","ab","firstRunnableTest","variantToRun","gateVariant"],"sourceRoot":""}