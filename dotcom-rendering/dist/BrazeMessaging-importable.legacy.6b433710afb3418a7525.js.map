{"version":3,"file":"BrazeMessaging-importable.legacy.6b433710afb3418a7525.js","mappings":"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","sources":["webpack://@guardian/dotcom-rendering/./src/web/components/BrazeMessaging.importable.tsx","webpack://@guardian/dotcom-rendering/./src/web/lib/getIdapiUserData.ts","webpack://@guardian/dotcom-rendering/./src/web/lib/hasCurrentBrazeUser.ts","webpack://@guardian/dotcom-rendering/./src/web/lib/getBrazeUuid.ts","webpack://@guardian/dotcom-rendering/./src/web/lib/braze/checkBrazeDependencies.ts","webpack://@guardian/dotcom-rendering/./src/web/lib/braze/initialiseAppboy.ts","webpack://@guardian/dotcom-rendering/./src/web/lib/braze/hasRequiredConsents.ts","webpack://@guardian/dotcom-rendering/./src/web/lib/braze/buildBrazeMessaging.ts","webpack://@guardian/dotcom-rendering/./src/web/lib/useBraze.ts","webpack://@guardian/dotcom-rendering/../node_modules/@guardian/braze-components/dist/logic/index.esm.js","webpack://@guardian/dotcom-rendering/../../../libs/@guardian/libs/src/joinUrl/joinUrl.ts"],"sourcesContent":["import { log } from '@guardian/libs';\nimport { useBraze } from '../lib/useBraze';\n/**\n * This component ensures we call buildBrazeMessaging at least once\n * on every page\n */\nexport const BrazeMessaging = ({ idApiUrl }) => {\n    const { brazeMessages, brazeCards } = useBraze(idApiUrl);\n    if (brazeMessages) {\n        log('tx', 'Braze Messages Interface loaded', brazeMessages);\n    }\n    if (brazeCards) {\n        log('tx', 'Braze Cards Interface loaded', brazeCards);\n    }\n    // we don’t render anything\n    return null;\n};\n","import { joinUrl } from '@guardian/libs';\nfunction checkForErrors(response) {\n    if (!response.ok) {\n        throw Error(response.statusText ||\n            `getIdApiUserData | An api call returned HTTP status ${response.status}`);\n    }\n    return response;\n}\nconst callApi = (url) => {\n    return fetch(url, {\n        credentials: 'include',\n    })\n        .then(checkForErrors)\n        .then((response) => response.json());\n};\nconst cache = {};\nexport const getIdApiUserData = (ajaxUrl) => {\n    if (!cache.idapiUserMeResponse) {\n        const url = joinUrl(ajaxUrl, 'user/me');\n        cache.idapiUserMeResponse = callApi(url);\n    }\n    return cache.idapiUserMeResponse;\n};\nexport const getIdapiUserIdentifiers = (ajaxUrl) => {\n    if (!cache.idapiUserIdentifiersResponse) {\n        const url = joinUrl(ajaxUrl, 'user/me/identifiers');\n        cache.idapiUserIdentifiersResponse = callApi(url);\n    }\n    return cache.idapiUserIdentifiersResponse;\n};\n","const KEY = 'gu.brazeUserSet';\nconst hasCurrentBrazeUser = () => {\n    return localStorage.getItem(KEY) === 'true';\n};\nconst setHasCurrentBrazeUser = () => {\n    localStorage.setItem(KEY, 'true');\n};\nconst clearHasCurrentBrazeUser = () => {\n    localStorage.removeItem(KEY);\n};\nexport { hasCurrentBrazeUser, setHasCurrentBrazeUser, clearHasCurrentBrazeUser, };\n","import { getIdapiUserIdentifiers } from './getIdapiUserData';\nexport const getBrazeUuid = async (ajaxUrl) => {\n    return getIdapiUserIdentifiers(ajaxUrl)\n        .then((data) => data.brazeUuid)\n        .catch((error) => {\n        window.guardian.modules.sentry.reportError(error, 'getBrazeUuid');\n    });\n};\n","import { getBrazeUuid } from '../getBrazeUuid';\nimport { hasRequiredConsents } from './hasRequiredConsents';\nconst buildFailureResponse = (name, value, data) => ({\n    isSuccessful: false,\n    failure: {\n        field: name,\n        data: value,\n    },\n    data,\n});\nconst buildDependencies = (isSignedIn, idApiUrl) => {\n    return [\n        {\n            name: 'apiKey',\n            value: Promise.resolve(window.guardian.config.page.brazeApiKey),\n        },\n        {\n            name: 'brazeSwitch',\n            value: Promise.resolve(window.guardian.config.switches.brazeSwitch),\n        },\n        {\n            name: 'brazeUuid',\n            value: isSignedIn ? getBrazeUuid(idApiUrl) : Promise.resolve(null),\n        },\n        {\n            name: 'consent',\n            value: hasRequiredConsents(),\n        },\n        {\n            name: 'isNotPaidContent',\n            value: Promise.resolve(!window.guardian.config.page.isPaidContent),\n        },\n    ];\n};\nconst checkBrazeDependencies = async (isSignedIn, idApiUrl) => {\n    const dependencies = buildDependencies(isSignedIn, idApiUrl);\n    const data = {};\n    // I think we could possibly clean this up a bit when we can use\n    // Promise.allSettled reliably (it's not available in our current Node\n    // version and polyfill.io doesn't have a polyfill yet).\n    for (const { name, value } of dependencies) {\n        try {\n            const result = await value;\n            // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions -- TODO: Complex types, look into this further\n            if (result) {\n                data[name] = result;\n            }\n            else {\n                return buildFailureResponse(name, result, data);\n            }\n        }\n        catch (e) {\n            return buildFailureResponse(name, e instanceof Error ? e.message : e, data);\n        }\n    }\n    return {\n        isSuccessful: true,\n        data,\n    };\n};\nexport { checkBrazeDependencies };\n","import { log } from '@guardian/libs';\nconst SDK_OPTIONS = {\n    enableLogging: true,\n    noCookies: true,\n    baseUrl: 'https://sdk.fra-01.braze.eu/api/v3',\n    sessionTimeoutInSeconds: 1,\n    minimumIntervalBetweenTriggerActionsInSeconds: 0,\n    devicePropertyAllowlist: [],\n};\nconst initialiseAppboy = async (apiKey) => {\n    const importedAppboy = (await import(\n    /* webpackChunkName: \"braze-web-sdk-core\" */ '@braze/web-sdk-core'));\n    importedAppboy.setLogger((message) => log('tx', message));\n    importedAppboy.initialize(apiKey, SDK_OPTIONS);\n    return importedAppboy;\n};\nconst getInitialisedAppboy = (() => {\n    let cache;\n    return (apiKey) => {\n        if (cache === undefined) {\n            cache = initialiseAppboy(apiKey);\n        }\n        return cache;\n    };\n})();\nexport { getInitialisedAppboy };\n","import { getConsentFor, onConsentChange, } from '@guardian/consent-management-platform';\nconst hasRequiredConsents = () => new Promise((resolve, reject) => {\n    onConsentChange((state) => {\n        try {\n            resolve(getConsentFor('braze', state));\n        }\n        catch (e) {\n            reject(e);\n        }\n    });\n});\nexport { hasRequiredConsents };\n","import { BrazeCards, BrazeMessages, LocalMessageCache, NullBrazeCards, NullBrazeMessages, } from '@guardian/braze-components/logic';\nimport { getCookie, log, storage } from '@guardian/libs';\nimport { initPerf } from '../../browser/initPerf';\nimport { record } from '../../browser/ophan/ophan';\nimport { clearHasCurrentBrazeUser, hasCurrentBrazeUser, setHasCurrentBrazeUser, } from '../hasCurrentBrazeUser';\nimport { checkBrazeDependencies } from './checkBrazeDependencies';\nimport { getInitialisedAppboy } from './initialiseAppboy';\nconst maybeWipeUserData = async (apiKey, brazeUuid, consent, brazeSwitch) => {\n    const hasCurrentBrazeUserValue = hasCurrentBrazeUser();\n    const userHasLoggedOut = !brazeUuid && hasCurrentBrazeUserValue;\n    const userHasRemovedConsent = !consent && hasCurrentBrazeUserValue;\n    const brazeHasBeenDisabled = !brazeSwitch && hasCurrentBrazeUserValue;\n    if (userHasLoggedOut || userHasRemovedConsent || brazeHasBeenDisabled) {\n        try {\n            if (apiKey) {\n                const appboy = await getInitialisedAppboy(apiKey);\n                appboy.wipeData();\n            }\n            LocalMessageCache.clear();\n            clearHasCurrentBrazeUser();\n        }\n        catch (error) {\n            window.guardian.modules.sentry.reportError(\n            // @ts-expect-error\n            error, 'braze-maybeWipeUserData');\n        }\n    }\n};\nexport const buildBrazeMessaging = async (idApiUrl) => {\n    if (!storage.local.isAvailable()) {\n        // we require local storage for using any message channel so that we know\n        // when to clear up user data from the device on logout\n        return {\n            brazeMessages: new NullBrazeMessages(),\n            brazeCards: new NullBrazeCards(),\n        };\n    }\n    const isSignedIn = !!getCookie({ name: 'GU_U', shouldMemoize: true });\n    const dependenciesResult = await checkBrazeDependencies(isSignedIn, idApiUrl);\n    if (!dependenciesResult.isSuccessful) {\n        const { failure, data } = dependenciesResult;\n        log('tx', `Not attempting to show Braze messages. Dependency ${failure.field} failed with ${String(failure.data)}.`);\n        await maybeWipeUserData(data.apiKey, data.brazeUuid, data.consent, data.brazeSwitch);\n        return {\n            brazeMessages: new NullBrazeMessages(),\n            brazeCards: new NullBrazeCards(),\n        };\n    }\n    try {\n        const sdkLoadTiming = initPerf('braze-sdk-load');\n        sdkLoadTiming.start();\n        const appboy = await getInitialisedAppboy(dependenciesResult.data.apiKey);\n        const sdkLoadTimeTaken = sdkLoadTiming.end();\n        record({\n            component: 'braze-sdk-load-timing',\n            value: sdkLoadTimeTaken,\n        });\n        const errorHandler = (error, desc) => {\n            window.guardian.modules.sentry.reportError(error, desc);\n        };\n        setHasCurrentBrazeUser();\n        appboy.changeUser(dependenciesResult.data.brazeUuid);\n        appboy.openSession();\n        const brazeCards = window.guardian.config.switches.brazeContentCards\n            ? new BrazeCards(appboy, errorHandler)\n            : new NullBrazeCards();\n        const brazeMessages = new BrazeMessages(appboy, LocalMessageCache, errorHandler);\n        return { brazeMessages, brazeCards };\n    }\n    catch {\n        return {\n            brazeMessages: new NullBrazeMessages(),\n            brazeCards: new NullBrazeCards(),\n        };\n    }\n};\n","import { NullBrazeCards, NullBrazeMessages, } from '@guardian/braze-components/logic';\nimport useSWRImmutable from 'swr/immutable';\nimport { buildBrazeMessaging } from './braze/buildBrazeMessaging';\n/**\n * Returns brazeMessaging as BrazeMessagesInterface and BrazeCardsInterface\n *\n * BrazeMessages is used to show single-impression messages (like ad impressions).\n * In contrast, BrazeCards can provide persistent user notifications.\n *\n * We're using useSWRImmutable to ensure this call is only made once\n * [doc]: https://swr.vercel.app/docs/revalidation#disable-automatic-revalidations\n */\nexport const useBraze = (idApiUrl) => {\n    const { data, error } = useSWRImmutable('braze-message', () => buildBrazeMessaging(idApiUrl));\n    if (error) {\n        return {\n            brazeMessages: new NullBrazeMessages(),\n            brazeCards: new NullBrazeCards(),\n        };\n    }\n    return {\n        brazeMessages: data?.brazeMessages,\n        brazeCards: data?.brazeCards,\n    };\n};\n","import { storage as e } from \"@guardian/libs\";\nfunction r(e, r) { if (!(e instanceof r))\n    throw new TypeError(\"Cannot call a class as a function\"); }\nfunction t(e, r) { for (var t = 0; t < r.length; t++) {\n    var n = r[t];\n    n.enumerable = n.enumerable || !1, n.configurable = !0, \"value\" in n && (n.writable = !0), Object.defineProperty(e, n.key, n);\n} }\nfunction n(e, r, n) { return r && t(e.prototype, r), n && t(e, n), e; }\nfunction o(e, r, t) { return r in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction a(e, r) { return function (e) { if (Array.isArray(e))\n    return e; }(e) || function (e, r) { var t = null == e ? null : \"undefined\" != typeof Symbol && e[Symbol.iterator] || e[\"@@iterator\"]; if (null == t)\n    return; var n, o, a = [], i = !0, s = !1; try {\n    for (t = t.call(e); !(i = (n = t.next()).done) && (a.push(n.value), !r || a.length !== r); i = !0)\n        ;\n}\ncatch (e) {\n    s = !0, o = e;\n}\nfinally {\n    try {\n        i || null == t.return || t.return();\n    }\n    finally {\n        if (s)\n            throw o;\n    }\n} return a; }(e, r) || i(e, r) || function () { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }(); }\nfunction i(e, r) { if (e) {\n    if (\"string\" == typeof e)\n        return s(e, r);\n    var t = Object.prototype.toString.call(e).slice(8, -1);\n    return \"Object\" === t && e.constructor && (t = e.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(e) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? s(e, r) : void 0;\n} }\nfunction s(e, r) { (null == r || r > e.length) && (r = e.length); for (var t = 0, n = new Array(r); t < r; t++)\n    n[t] = e[t]; return n; }\nvar l, u, c, d = [\"https://media.guim.co.uk/\", \"https://i.guim.co.uk/\"], h = function (e) { return d.some((function (r) { return e.startsWith(r); })); }, f = [\"%%CURRENCY_SYMBOL%%\", \"%%COUNTRY_NAME%%\"], g = /%%.*?%%/g, p = function (e) { var r, t, n = e.buttonText, o = e.buttonUrl, a = e.ophanComponentId, i = e.highlightedText, s = m(e), l = (i || \"\") + \" \" + s.join(\" \"), u = !!(t = null === (r = l.match(g)) || void 0 === r ? void 0 : r.filter((function (e) { return !f.includes(\"\".concat(e)); }))) && t.length > 0; return Boolean(n && o && a && s.length > 0 && !u); }, m = function (e) { var r, t = [], n = function (e, r) { var t = \"undefined\" != typeof Symbol && e[Symbol.iterator] || e[\"@@iterator\"]; if (!t) {\n    if (Array.isArray(e) || (t = i(e)) || r && e && \"number\" == typeof e.length) {\n        t && (e = t);\n        var n = 0, o = function () { };\n        return { s: o, n: function () { return n >= e.length ? { done: !0 } : { done: !1, value: e[n++] }; }, e: function (e) { throw e; }, f: o };\n    }\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n} var a, s = !0, l = !1; return { s: function () { t = t.call(e); }, n: function () { var e = t.next(); return s = e.done, e; }, e: function (e) { l = !0, a = e; }, f: function () { try {\n        s || null == t.return || t.return();\n    }\n    finally {\n        if (l)\n            throw a;\n    } } }; }(Object.keys(e).filter((function (e) { return /^paragraph\\d$/.test(e); })).sort()); try {\n    for (n.s(); !(r = n.n()).done;) {\n        var o = e[r.value];\n        o && t.push(o);\n    }\n}\ncatch (e) {\n    n.e(e);\n}\nfinally {\n    n.f();\n} return t; }, v = (o(l = {}, \"AppBanner\", (function (e) { var r = e.header, t = e.body, n = e.cta, o = e.imageUrl; return !!(r && t && n && o) && (!!h(o) || (console.log(\"Image URL \".concat(o, \" is not allowed\")), !1)); })), o(l, \"BannerWithLink\", (function (e) { var r = e.header, t = e.body, n = e.buttonText, o = e.buttonUrl, a = e.imageUrl, i = e.ophanComponentId; return a && !h(a) ? (console.log(\"Image URL \".concat(a, \" is not allowed\")), !1) : Boolean(r && t && n && o && a && i); })), o(l, \"BannerNewsletter\", (function (e) { var r = e.header, t = e.body, n = e.imageUrl, o = e.ophanComponentId, a = e.newsletterId, i = e.frequency; return n && !h(n) ? (console.log(\"Image URL \".concat(n, \" is not allowed\")), !1) : Boolean(r && t && n && o && a && i); })), o(l, \"Epic\", p), o(l, \"EpicWithSpecialHeader\", (function (e) { var r = p(e); if (r) {\n    var t = e.authoredEpicImageUrl, n = e.authoredEpicImageAltText, o = e.authoredEpicBylineName;\n    return Boolean(t && n && o);\n} return r; })), o(l, \"NewsletterEpic\", (function (e) { var r = e.header, t = e.frequency, n = e.paragraph1, o = e.imageUrl, a = e.newsletterId, i = e.ophanComponentId; return !!(r && t && n && o && a && i) && (!!h(o) || (console.log(\"Image URL \".concat(o, \" is not allowed\")), !1)); })), o(l, \"USNewsletterEpic\", (function (e) { var r = e.header, t = e.frequency, n = e.paragraph1, o = e.ophanComponentId; return Boolean(r && t && n && o); })), o(l, \"AUNewsletterEpic\", (function (e) { var r = e.header, t = e.frequency, n = e.paragraph1, o = e.ophanComponentId; return Boolean(r && t && n && o); })), o(l, \"UKNewsletterEpic\", (function (e) { var r = e.header, t = e.frequency, n = e.paragraph1, o = e.ophanComponentId; return Boolean(r && t && n && o); })), o(l, \"DownToEarthNewsletterEpic\", (function (e) { var r = e.header, t = e.frequency, n = e.paragraph1, o = e.ophanComponentId; return Boolean(r && t && n && o); })), o(l, \"EpicNewsletter_AU_AfternoonUpdate\", (function (e) { var r = e.header, t = e.frequency, n = e.paragraph1, o = e.ophanComponentId; return Boolean(r && t && n && o); })), o(l, \"EpicNewsletter_TheGuide\", (function (e) { var r = e.header, t = e.frequency, n = e.paragraph1, o = e.ophanComponentId; return Boolean(r && t && n && o); })), l), y = function () { function e(t, n, o, a, i, s) { r(this, e), this.id = void 0, this.appboy = void 0, this.message = void 0, this.slotName = void 0, this.cache = void 0, this.errorHandler = void 0, this.id = t, this.message = n, this.appboy = o, this.slotName = a, this.cache = i, this.errorHandler = s; } return n(e, [{ key: \"logImpression\", value: function () { try {\n            this.appboy.logInAppMessageImpression(this.message);\n        }\n        catch (e) {\n            e instanceof Error && this.errorHandler(e, \"BrazeMessage.logImpression\");\n        } this.cache.remove(this.slotName, this.id, this.errorHandler); } }, { key: \"logButtonClick\", value: function (e) { var r = new this.appboy.InAppMessageButton(\"Button: ID \".concat(e), void 0, void 0, void 0, void 0, void 0, e); try {\n            this.appboy.logInAppMessageButtonClick(r, this.message);\n        }\n        catch (e) {\n            e instanceof Error && this.errorHandler(e, \"BrazeMessage.logButtonClick\");\n        } } }, { key: \"extras\", get: function () { return this.message.extras; } }]), e; }(), b = function () { function e(t, n, o) { r(this, e), this.appboy = void 0, this.freshMessageBySlot = void 0, this.cache = void 0, this.errorHandler = void 0, this.appboy = t, this.cache = n, this.freshMessageBySlot = { Banner: this.getFreshMessagesForSlot(\"Banner\"), EndOfArticle: this.getFreshMessagesForSlot(\"EndOfArticle\") }, this.errorHandler = o; } return n(e, [{ key: \"getFreshMessagesForSlot\", value: function (e) { var r = this; return new Promise((function (t) { r.appboy.subscribeToInAppMessage((function (n) { var o = n, a = o.extras; a && a.slotName && a.slotName === e && (r.cache.push(e, { message: o, id: \"\".concat(Math.random().toString(16).slice(2), \"-\").concat((new Date).getTime()) }, r.errorHandler), t(o)); })); })); } }, { key: \"getMessageForBanner\", value: function (e) { return this.getMessageForSlot(\"Banner\", e); } }, { key: \"getMessageForEndOfArticle\", value: function (e) { return this.getMessageForSlot(\"EndOfArticle\", e); } }, { key: \"getMessageForSlot\", value: function (e, r) { var t = this, n = this.getHighestPriorityMessageFromCache(e, r); return n ? Promise.resolve(n) : this.freshMessageBySlot[e].then((function () { var n = t.getHighestPriorityMessageFromCache(e, r); if (n)\n            return Promise.resolve(n); throw new Error(\"No valid messages for \".concat(e, \" slot\")); })); } }, { key: \"getHighestPriorityMessageFromCache\", value: function (e, r) { var t, n = this.cache.all(e, this.appboy, this.errorHandler).filter((function (e) { return !!(r = e.message.extras) && !!v[r.componentName] && v[r.componentName](r); var r; })), o = { messagesWithFilters: (t = n).filter((function (e) { return Boolean(e.message.extras.section); })), messagesWithoutFilters: t.filter((function (e) { return !Boolean(e.message.extras.section); })) }, i = o.messagesWithoutFilters, s = a(o.messagesWithFilters.concat(i).filter((function (e) { var t; if (!e.message.extras.section || \"string\" != typeof e.message.extras.section)\n            return !0; var n = null == r || null === (t = r.section) || void 0 === t ? void 0 : t.toLowerCase(); return !!n && e.message.extras.section.split(\"|\").map((function (e) { return e.toLowerCase(); })).includes(n); })), 1)[0]; if (s)\n            return new y(s.id, s.message, this.appboy, e, this.cache, this.errorHandler); } }]), e; }(), C = function () { function e() { r(this, e); } return n(e, [{ key: \"getMessageForBanner\", value: function () { return Promise.reject(new Error(\"No banner message\")); } }, { key: \"getMessageForEndOfArticle\", value: function () { return Promise.reject(new Error(\"No end of article message\")); } }]), e; }();\n!function (e) { e.Banner = \"Banner\", e.EndOfArticle = \"EndOfArticle\"; }(u || (u = {})), function (e) { e.ProfileBadge = \"ProfileBadge\"; }(c || (c = {}));\nvar B = function () { function e(t, n, o, a, i) { r(this, e), this.id = void 0, this.slotName = void 0, this.card = void 0, this.appboy = void 0, this.errorHandler = void 0, this.id = t, this.slotName = n, this.card = o, this.appboy = a, this.errorHandler = i; } return n(e, [{ key: \"logImpression\", value: function () { try {\n            this.appboy.logCardImpressions([this.card], !0) || this.errorHandler(new Error(\"Failed to log card impression event\"), \"BrazeCard.logImpressions\");\n        }\n        catch (e) {\n            e instanceof Error && this.errorHandler(e, \"BrazeCard.logImpressions\");\n        } } }, { key: \"logCardClick\", value: function () { try {\n            this.appboy.logCardClick(this.card, !0) || this.errorHandler(new Error(\"Failed to log card click event\"), \"BrazeCard.logCardClick\");\n        }\n        catch (e) {\n            e instanceof Error && this.errorHandler(e, \"BrazeCard.logCardClick\");\n        } } }, { key: \"logCardDismissal\", value: function () { try {\n            this.appboy.logCardDismissal(this.card) || this.errorHandler(new Error(\"Failed to log card dismiss event\"), \"BrazeCard.logCardDismiss\");\n        }\n        catch (e) {\n            e instanceof Error && this.errorHandler(e, \"BrazeCard.logCardDismiss\");\n        } } }, { key: \"extras\", get: function () { var e = this.card.extras; return void 0 === e ? {} : e; } }, { key: \"expiry\", get: function () { var e = this.card.expiresAt; return null === e ? void 0 : e; } }]), e; }(), w = function () { function e(t, n) { r(this, e), this.appboy = void 0, this.errorHandler = void 0, this.appboy = t, this.errorHandler = n; } return n(e, [{ key: \"getCardsForProfileBadge\", value: function () { return this.getCardsForSlot(c.ProfileBadge); } }, { key: \"getCardsForSlot\", value: function (e) { var r = this; return this.appboy.getCachedContentCards().cards.flatMap((function (t) { var n = t.extras; return n && n.slotName && n.slotName === e ? void 0 === t.id ? (r.errorHandler(new Error(\"appboy card had no ID\"), \"BrazeCards.getCardsForSlot\"), []) : [new B(t.id, e, t, r.appboy, r.errorHandler)] : []; })); } }, { key: \"lastUpdated\", get: function () { return this.appboy.getCachedContentCards().lastUpdated; } }]), e; }(), I = function () { function e() { r(this, e); } return n(e, [{ key: \"getCardsForProfileBadge\", value: function () { return []; } }]), e; }(), E = 864e5, k = function (e) { return \"\".concat(\"gu.brazeMessageCache\", \".\").concat(e); }, F = function (r, t) { var n = k(r); e.local.set(n, t); }, M = function (e, r) { return new r.HtmlMessage(e.message, e.extras, e.campaignId, e.cardId, e.triggerId, e.dismissType, e.duration, e.animateIn, e.animateOut, e.frameColor, e.htmlId, e.css, e.messageFields); }, x = function (r, t) { var n = function (r) { var t = k(r), n = e.local.get(t); return Array.isArray(n) ? n : []; }(r), o = n.filter((function (e) { return r = e, Boolean((null == r ? void 0 : r.expires) && Number.isFinite(null == r ? void 0 : r.expires) && (null == r || null === (t = r.message) || void 0 === t ? void 0 : t.id) && (null == r || null === (n = r.message) || void 0 === n || null === (o = n.message) || void 0 === o ? void 0 : o.triggerId) && (null == r || null === (a = r.message) || void 0 === a || null === (i = a.message) || void 0 === i ? void 0 : i.extras)); var r, t, n, o, a, i; })).filter((function (e) { return e.expires > Date.now(); })); if (n.length !== o.length) {\n    var a = n.length - o.length;\n    t(Error(\"Removed \".concat(a, \" expired message\").concat(1 === a ? \"\" : \"s\", \" from queue\")), \"LocalMessageCache\"), F(r, o);\n} return o; }, A = function () { function t() { r(this, t); } return n(t, null, [{ key: \"peek\", value: function (e, r, t) { var n = x(e, t)[0]; if (n)\n            return { id: n.message.id, message: M(n.message.message, r) }; } }, { key: \"all\", value: function (e, r, t) { return x(e, t).map((function (e) { return { id: e.message.id, message: M(e.message.message, r) }; })); } }, { key: \"remove\", value: function (e, r, t) { var n = x(e, t), o = n.findIndex((function (e) { return e.message.id === r; })); if (o >= 0 && n.splice(o, 1))\n            return F(e, n), !0; return !1; } }, { key: \"push\", value: function (e, r, t) { var n = x(e, t); if (n.length < 2) {\n            var o = { message: r, expires: Date.now() + 864e5 };\n            return n.push(o), F(e, n), !0;\n        } return t(new Error(\"Failed to add message to queue - queue full\"), \"LocalMessageCache\"), !1; } }, { key: \"clear\", value: function () { for (var r in u) {\n            var t = k(r);\n            e.local.remove(t);\n        } } }]), t; }();\nexport { B as BrazeCard, w as BrazeCards, y as BrazeMessage, b as BrazeMessages, A as LocalMessageCache, I as NullBrazeCards, C as NullBrazeMessages, M as hydrateMessage, E as millisecondsBeforeExpiry, F as setQueue };\n","// detect two or more `/` chars after a word boundary\nconst multipleSlashesInRoute = /\\b\\/{2,}/g;\n\nexport const joinUrl = (...args: string[]): string =>\n\targs.join('/').replace(multipleSlashesInRoute, '/');\n"],"names":["BrazeMessaging","idApiUrl","useBraze","brazeMessages","brazeCards","log","checkForErrors","response","ok","Error","statusText","status","callApi","url","fetch","credentials","then","json","cache","getIdApiUserData","ajaxUrl","idapiUserMeResponse","joinUrl","getIdapiUserIdentifiers","idapiUserIdentifiersResponse","KEY","getBrazeUuid","data","brazeUuid","catch","error","window","guardian","modules","sentry","reportError","buildFailureResponse","name","value","isSuccessful","failure","field","buildDependencies","isSignedIn","Promise","resolve","config","page","brazeApiKey","switches","brazeSwitch","reject","onConsentChange","state","getConsentFor","e","isPaidContent","checkBrazeDependencies","dependencies","result","message","SDK_OPTIONS","enableLogging","noCookies","baseUrl","sessionTimeoutInSeconds","minimumIntervalBetweenTriggerActionsInSeconds","devicePropertyAllowlist","initialiseAppboy","apiKey","importedAppboy","setLogger","initialize","getInitialisedAppboy","undefined","maybeWipeUserData","consent","hasCurrentBrazeUserValue","localStorage","getItem","userHasRemovedConsent","brazeHasBeenDisabled","wipeData","LocalMessageCache","removeItem","buildBrazeMessaging","storage","NullBrazeMessages","NullBrazeCards","getCookie","shouldMemoize","dependenciesResult","String","sdkLoadTiming","initPerf","start","appboy","sdkLoadTimeTaken","end","record","component","errorHandler","desc","setItem","changeUser","openSession","brazeContentCards","BrazeCards","BrazeMessages","useSWRImmutable","r","TypeError","t","length","n","enumerable","configurable","writable","Object","defineProperty","key","prototype","o","a","Array","isArray","Symbol","iterator","i","s","call","next","done","push","return","toString","slice","constructor","from","test","l","u","c","d","h","some","startsWith","f","g","p","buttonText","buttonUrl","ophanComponentId","highlightedText","m","join","match","filter","includes","concat","Boolean","keys","sort","v","header","body","cta","imageUrl","console","newsletterId","frequency","authoredEpicImageUrl","authoredEpicImageAltText","authoredEpicBylineName","paragraph1","y","this","id","slotName","logInAppMessageImpression","remove","InAppMessageButton","logInAppMessageButtonClick","get","extras","b","freshMessageBySlot","Banner","getFreshMessagesForSlot","EndOfArticle","subscribeToInAppMessage","Math","random","Date","getTime","getMessageForSlot","getHighestPriorityMessageFromCache","all","componentName","messagesWithFilters","section","messagesWithoutFilters","toLowerCase","split","map","C","ProfileBadge","B","card","logCardImpressions","logCardClick","logCardDismissal","expiresAt","w","getCardsForSlot","getCachedContentCards","cards","flatMap","lastUpdated","I","k","F","M","HtmlMessage","campaignId","cardId","triggerId","dismissType","duration","animateIn","animateOut","frameColor","htmlId","css","messageFields","x","expires","Number","isFinite","now","A","findIndex","splice","multipleSlashesInRoute","args","replace"],"sourceRoot":""}