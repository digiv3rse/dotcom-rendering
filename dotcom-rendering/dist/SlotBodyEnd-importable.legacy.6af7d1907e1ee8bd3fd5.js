"use strict";(self.webpackChunk_guardian_dotcom_rendering=self.webpackChunk_guardian_dotcom_rendering||[]).push([[4678],{8184:(e,t,n)=>{n.r(t),n.d(t,{SlotBodyEnd:()=>_});var r=n(5809),o=n(4649),i=n(7800),c=n(4857),a=n(3904),u=n(8059),s=n(6358),d=n(8078),l=n(6849),p=n(3287),f=n(7791),m=n(824),h=n.n(m),b=n(3203),g=n(3053),w=n(9213),v=n(6530),y={name:"pc1kq1",styles:"margin:18px 0"},O="RETENTION_EPIC",C=function(){var e=(0,f.Z)(h().mark((function e(t,n,r,o){var i,c;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("interactive"!==r.toLowerCase()){e.next=2;break}return e.abrupt("return",{show:!1});case 2:if(!(i=(0,g.P)())){e.next=5;break}return e.abrupt("return",{show:!0,meta:i});case 5:if(!(0,v.p)(o)){e.next=7;break}return e.abrupt("return",{show:!1});case 7:return e.prev=7,e.next=10,t.getMessageForEndOfArticle(n);case 10:if(!(c=e.sent).extras){e.next=13;break}return e.abrupt("return",{show:!0,meta:{dataFromBraze:c.extras,logImpressionWithBraze:function(){c.logImpression()},logButtonClickWithBraze:function(e){c.logButtonClick(e)}}});case 13:return e.abrupt("return",{show:!1});case 16:return e.prev=16,e.t0=e.catch(7),e.abrupt("return",{show:!1});case 19:case"end":return e.stop()}}),e,null,[[7,16]])})));return function(t,n,r,o){return e.apply(this,arguments)}}(),x=function(e){var t=e.BrazeComponent,n=e.meta,o=e.countryCode,c=e.idApiUrl,u=(0,w.O)({rootMargin:"-18px",threshold:0,debounce:!0}),s=(0,r.Z)(u,2),d=s[0],l=s[1],m=(0,a.useRef)(null);(0,p.t)((function(){(0,b.X4)({component:{componentType:O,id:n.dataFromBraze.ophanComponentId},action:"INSERT"})}),[n.dataFromBraze,m.current]),(0,a.useEffect)((function(){d&&(n.logImpressionWithBraze(),(0,b.X4)({component:{componentType:O,id:n.dataFromBraze.ophanComponentId},action:"VIEW"}))}),[d,n]);var g,v=n.dataFromBraze.componentName;return v?(0,i.jsx)("div",{ref:l,css:y,children:(0,i.jsx)("div",{ref:m,children:(0,i.jsx)(t,{componentName:v,brazeMessageProps:n.dataFromBraze,subscribeToNewsletter:(g=(0,f.Z)(h().mark((function e(t){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(c,"/users/me/newsletters"),{method:"PATCH",body:JSON.stringify({id:t,subscribed:!0}),credentials:"include"});case 2:case"end":return e.stop()}}),e)}))),function(e){return g.apply(this,arguments)}),countryCode:o,logButtonClickWithBraze:n.logButtonClickWithBraze,submitComponentEvent:b.X4})})}):null},j=function(e){var t=e.meta,o=e.countryCode,c=e.idApiUrl,u=(0,a.useState)(),s=(0,r.Z)(u,2),d=s[0],l=s[1];return(0,a.useEffect)((function(){Promise.all([n.e(8887),n.e(8639),n.e(3725)]).then(n.bind(n,5663)).then((function(e){l((function(){return e.BrazeEndOfArticleComponent}))})).catch((function(e){return window.guardian.modules.sentry.reportError(e,"braze-epic")}))}),[]),(0,i.jsx)(i.Fragment,{children:d?(0,i.jsx)(x,{BrazeComponent:d,meta:t,countryCode:o,idApiUrl:c}):(0,i.jsx)("div",{})})},E=n(5226),P=n(232),I=n(1846),k=n(7789),S=n(9175),A=n(8576);function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var R={name:"rmxmld",styles:"margin:18px 0;clear:both"},M=function(){var e=(0,f.Z)(h().mark((function e(t){var n,r;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0={ophanPageId:window.guardian.config.ophan.pageViewId,platformId:"GUARDIAN_WEB",clientName:"dcr",referrerUrl:window.location.origin+window.location.pathname},e.t1=t.contentType,e.t2=t.sectionId,e.t3=t.shouldHideReaderRevenue,e.t4=t.isMinuteArticle,e.t5=t.isPaidContent,e.t6=t.tags,e.t7=!(0,S.S9)(null!==(n=t.isSignedIn)&&void 0!==n&&n),e.t8=(0,S.T0)(null!==(r=t.isSignedIn)&&void 0!==r&&r),e.t9=(0,S.qQ)(),e.t10=(0,I.Es)(P.t.local),e.next=13,t.asyncArticleCount;case 13:return e.t11=e.sent,e.next=16,(0,S.Am)();case 16:return e.t12=e.sent,e.t13=Number((0,c.e)({name:"GU_mvt_id",shouldMemoize:!0})),e.t14=t.countryCode,e.t15=S.BQ,e.t16=window.location.origin+window.location.pathname,e.next=23,(0,S.H2)();case 23:if(!e.sent){e.next=27;break}e.t17=t.browserId,e.next=28;break;case 27:e.t17=void 0;case 28:return e.t18=e.t17,e.t19=t.isSignedIn,e.t20={contentType:e.t1,sectionId:e.t2,shouldHideReaderRevenue:e.t3,isMinuteArticle:e.t4,isPaidContent:e.t5,tags:e.t6,showSupportMessaging:e.t7,isRecurringContributor:e.t8,lastOneOffContributionDate:e.t9,epicViewLog:e.t10,weeklyArticleHistory:e.t11,hasOptedOutOfArticleCount:e.t12,mvtId:e.t13,countryCode:e.t14,modulesVersion:e.t15,url:e.t16,browserId:e.t18,isSignedIn:e.t19},e.abrupt("return",{tracking:e.t0,targeting:e.t20});case 32:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=function(){var e=(0,f.Z)(h().mark((function e(t){var n,r,o,i,c,a,u,s,d,l,p,f;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.isSignedIn,o=t.shouldHideReaderRevenue,i=t.isPaidContent,c=t.contributionsServiceUrl,a=t.idApiUrl,u=t.stage,!o&&!i){e.next=3;break}return e.abrupt("return",Promise.resolve({show:!1}));case 3:return(0,k.i)("contributions-epic-data").start(),e.next=7,M(t);case 7:return s=e.sent,e.next=10,(0,I.bv)(c,s);case 10:if(d=e.sent,l=null===(n=d.data)||void 0===n?void 0:n.module){e.next=14;break}return e.abrupt("return",{show:!1});case 14:return p=r?(0,S.nh)(a):void 0,e.next=17,(0,S.G9)();case 17:return f=e.sent,e.abrupt("return",{show:!0,meta:{module:l,fetchEmail:p,hasConsentForArticleCount:f,stage:u}});case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=function(e){var t=e.module,n=e.fetchEmail,o=e.hasConsentForArticleCount,c=e.stage,u=(0,a.useState)(),s=(0,r.Z)(u,2),d=s[0],l=s[1];return(0,a.useEffect)((function(){(0,A.R)();var e=(0,k.i)("contributions-epic-module");e.start(),window.guardianPolyfilledImport(t.url).then((function(t){e.end(),l((function(){return t.ContributionsEpic}))})).catch((function(e){var t=e instanceof Error?"Error importing RR epic: ".concat(e.message):"Unknown error";console.log(t),window.guardian.modules.sentry.reportError(new Error(t),"rr-epic")}))}),[]),void 0!==d?(0,i.jsx)("div",{css:R,children:(0,i.jsx)(d,z(z({},t.props),{},{fetchEmail:n,submitComponentEvent:b.X4,openCmp:function(){E.cmp.showPrivacyManager()},hasConsentForArticleCount:o,stage:c}))}):null};function Z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var _=function(e){var t=e.contentType,n=e.sectionName,f=e.sectionId,m=e.shouldHideReaderRevenue,h=e.isMinuteArticle,b=e.isPaidContent,g=e.tags,w=e.contributionsServiceUrl,v=e.idApiUrl,y=e.stage,O=e.pageId,x=e.keywordIds,E=(0,l._)(v).brazeMessages,P=(0,a.useState)(),I=(0,r.Z)(P,2),k=I[0],S=I[1],A=!!(0,c.e)({name:"GU_U",shouldMemoize:!0}),B=(0,c.e)({name:"bwid",shouldMemoize:!0}),z=(0,a.useState)(null),R=(0,r.Z)(z,2),M=R[0],_=R[1],F=(0,a.useState)(),N=(0,r.Z)(F,2),D=N[0],H=N[1];return(0,a.useEffect)((function(){(0,s.A)().then((function(e){S(null!=e?e:"")})).catch((function(e){return console.error("countryCodePromise - error: ".concat(String(e)))}))}),[]),(0,a.useEffect)((function(){H((0,u.o)(O,x).then((function(e){return null==e?void 0:e.weeklyArticleHistory})))}),[O,x]),(0,p.t)((function(){var e,r=(e={isSignedIn:A,countryCode:k,contentType:t,sectionId:f,shouldHideReaderRevenue:m,isMinuteArticle:h,isPaidContent:b,tags:g,contributionsServiceUrl:w,idApiUrl:v,stage:y,asyncArticleCount:D,browserId:null!=B?B:void 0},{candidate:{id:"reader-revenue-banner",canShow:function(){return U(e)},show:function(e){return function(){return(0,i.jsx)(T,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e))}}},timeoutMillis:null}),c=function(e,t,n,r,o,c){return{candidate:{id:"braze-epic",canShow:function(){return C(e,o,r,c)},show:function(e){return function(){return(0,i.jsx)(j,{meta:e,countryCode:t,idApiUrl:n})}}},timeoutMillis:2e3}}(E,k,v,t,{section:n},g),a={candidates:[c,r],name:"slotBodyEnd"};(0,d.B)(a).then((function(e){return _(e)})).catch((function(e){return console.error("SlotBodyEnd pickMessage - error: ".concat(String(e)))}))}),[A,k,E,D]),null!==M?(0,i.jsx)("div",{id:"slot-body-end",children:(0,i.jsx)(M,{})}):null}}}]);
//# sourceMappingURL=SlotBodyEnd-importable.legacy.6af7d1907e1ee8bd3fd5.js.map