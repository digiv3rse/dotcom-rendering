"use strict";(self.webpackChunk_guardian_dotcom_rendering=self.webpackChunk_guardian_dotcom_rendering||[]).push([[2798],{6839:(e,n,t)=>{t.r(n),t.d(n,{Metrics:()=>E});var a,r=t(2840),i=t(7791),o=t(824),s=t.n(o),c=t(6621),u=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,t=Math.pow(10,n);return Math.round(e*t)/t};!function(e){e.PROD="https://performance-events.guardianapis.com/core-web-vitals",e.CODE="https://performance-events.code.dev-guardianapis.com/core-web-vitals"}(a||(a={}));var d,l={browser_id:null,page_view_id:null,fid:null,cls:null,lcp:null,fcp:null,ttfb:null},f=new Set,p=!1,v=function(e){d=e?a.CODE:a.PROD},w=!1,g=function(){w||null!==l.fcp&&(w=navigator.sendBeacon(d,JSON.stringify(l)),f.size>0&&f.forEach((function(e){(0,c.c)(e,w?"Core Web Vitals payload successfully queued for transfer":"Failed to queue Core Web Vitals payload for transfer")})))},b=function(e){switch(e.name){case"FCP":l.fcp=u(e.value);break;case"CLS":l.cls=u(e.value);break;case"LCP":l.lcp=u(e.value);break;case"FID":l.fid=u(e.value);break;case"TTFB":l.ttfb=u(e.value)}},m=function(e){switch(e.type){case"visibilitychange":return void("hidden"===document.visibilityState&&g());case"pagehide":return void g()}},h=function(){var e=(0,i.Z)(s().mark((function e(){var n,a,r,i,o,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(t.bind(t,2716));case 2:n=e.sent,a=n.getCLS,r=n.getFCP,i=n.getFID,o=n.getLCP,c=n.getTTFB,a(b,{reportAllChanges:!1}),i(b),o(b),r(b),c(b),addEventListener("visibilitychange",m),addEventListener("pagehide",m);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),C=function(){var e=(0,i.Z)(s().mark((function e(n){var t,a,r,i,o,c,u,d,w,g;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.browserId,a=void 0===t?null:t,r=n.pageViewId,i=void 0===r?null:r,o=n.sampling,c=void 0===o?.01:o,u=n.isDev,d=n.team,!p){e.next=4;break}return console.warn("initCoreWebVitals already initialised","use the bypassCoreWebVitalsSampling method instead"),e.abrupt("return");case 4:if(p=!0,d&&f.add(d),v(u),l.browser_id=a,l.page_view_id=i,a&&i||console.warn("browserId or pageViewId missing from Core Web Vitals.","Resulting data cannot be joined to page view tables",{browserId:a,pageViewId:i}),(c<0||c>1)&&console.warn("Core Web Vitals sampling is outside the 0 to 1 range: ",c),0===c&&console.warn("Core Web Vitals are sampled at 0%"),1===c&&console.warn("Core Web Vitals are sampled at 100%"),w=Math.random()<c,g="#bypassCoreWebVitalsSampling"===window.location.hash,!w&&!g){e.next=17;break}return e.abrupt("return",h());case 17:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),y=function(){var e=(0,i.Z)(s().mark((function e(n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p){e.next=3;break}return console.warn("initCoreWebVitals not yet initialised"),e.abrupt("return");case 3:return n&&f.add(n),e.abrupt("return",h());case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),k=t(4857),I=t(2108),V=t(4671),_=t(8223),M=t(3287),x=Math.random()<.01,D=[I.N],E=function(e){var n,t=e.commercialMetricsEnabled,a=null===(n=(0,V.N)())||void 0===n?void 0:n.api,i=(0,_.c)(),o=(0,k.e)({name:"bwid",shouldMemoize:!0}),s=window.guardian.config.ophan.pageViewId,c=!!window.guardian.config.page.isDev||"m.code.dev-theguardian.com"===window.location.hostname||"localhost"===window.location.hostname||"preview.gutools.co.uk"===window.location.hostname,u=Object.keys(window.guardian.config.tests).length>0,d=function(e){return x||u||D.some((function(n){return e.runnableTest(n)}))};return(0,M.t)((function(){var e=!!a&&d(a),n=Number.MIN_VALUE;C({browserId:o,pageViewId:s,isDev:c,sampling:n,team:"dotcom"}),(e||c)&&y("commercial")}),[a]),(0,M.t)((function(){if(t){var e=!!a&&d(a);(0,r.cJ)({pageViewId:s,browserId:null!=o?o:void 0,isDev:c,adBlockerInUse:i}).then((function(){(e||c)&&(0,r.NV)()})).catch((function(e){return console.error("Error initialising commercial metrics: ".concat(String(e)))}))}}),[a,i,t]),null}},2108:(e,n,t)=>{t.d(n,{N:()=>a});var a={id:"IntegrateIma",start:"2022-07-14",expiry:"2023-04-04",author:"Zeke Hunter-Green",description:"Test the commercial impact of replacing YouTube ads with Interactive Media Ads on first-party videos",audience:0,audienceOffset:0,audienceCriteria:"Opt in",successMeasure:"IMA integration works as expected without adversely affecting pages with videos",canRun:function(){return!0},variants:[{id:"control",test:function(){}},{id:"variant",test:function(){}}]}},4671:(e,n,t)=>{t.d(n,{N:()=>s,x:()=>c});var a=t(6131),r=t(2699),i=new Promise((function(){})),o="ab-tests",s=function(){return(0,r.Z)(o,(function(){return i})).data},c=function(e){var n=e.api,t=e.participations;(0,a.JG)(o,{api:n,participations:t},!1)}},8223:(e,n,t)=>{t.d(n,{c:()=>o});var a=t(5809),r=t(2840),i=t(3904),o=function(){var e=(0,i.useState)(),n=(0,a.Z)(e,2),t=n[0],o=n[1];return(0,i.useEffect)((function(){(0,r.Hy)().then((function(e){o(e)}))}),[]),t}},3287:(e,n,t)=>{t.d(n,{t:()=>i});var a=t(5809),r=t(3904),i=function(e,n){var t=(0,r.useState)(!1),i=(0,a.Z)(t,2),o=i[0],s=i[1],c=n.every((function(e){return void 0!==e}));(0,r.useEffect)((function(){!o&&c&&(e(),s(!0))}),[o,c,e])}}}]);
//# sourceMappingURL=Metrics-importable.legacy.8afcc642fb952b520acb.js.map