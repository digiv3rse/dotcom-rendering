"use strict";(self.webpackChunk_guardian_dotcom_rendering=self.webpackChunk_guardian_dotcom_rendering||[]).push([[4678],{8606:(e,t,n)=>{n.r(t),n.d(t,{SlotBodyEnd:()=>_});var r=n(7800),o=n(1614),i=n(3904),a=n(5670),s=n(6134),c=n(6622),l=n(7617),d=n(7410),u=n(43),p=n(9038),m=n(1780),g=n(4463),f=n(2011);function h(){const e=(t=["\n\tmargin: 18px 0;\n"],n||(n=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(n)}})));var t,n;return h=function(){return e},e}const b=(0,u.css)(h()),w="RETENTION_EPIC",y=e=>{let{BrazeComponent:t,meta:n,countryCode:o,idApiUrl:a}=e;const[s,c]=(0,g.O)({rootMargin:"-18px",threshold:0,debounce:!0}),l=(0,i.useRef)(null);(0,d.t)((()=>{(0,p.X4)({component:{componentType:w,id:n.dataFromBraze.ophanComponentId},action:"INSERT"})}),[n.dataFromBraze,l.current]),(0,i.useEffect)((()=>{s&&(n.logImpressionWithBraze(),(0,p.X4)({component:{componentType:w,id:n.dataFromBraze.ophanComponentId},action:"VIEW"}))}),[s,n]);const u=n.dataFromBraze.componentName;return u?(0,r.jsx)("div",{ref:c,css:b,children:(0,r.jsx)("div",{ref:l,children:(0,r.jsx)(t,{componentName:u,brazeMessageProps:n.dataFromBraze,subscribeToNewsletter:async e=>{await fetch("".concat(a,"/users/me/newsletters"),{method:"PATCH",body:JSON.stringify({id:e,subscribed:!0}),credentials:"include"})},countryCode:o,logButtonClickWithBraze:n.logButtonClickWithBraze,submitComponentEvent:p.X4})})}):null},v=e=>{let{meta:t,countryCode:o,idApiUrl:a}=e;const[s,c]=(0,i.useState)();return(0,i.useEffect)((()=>{Promise.all([n.e(3033),n.e(9861),n.e(3725)]).then(n.bind(n,3280)).then((e=>{c((()=>e.BrazeEndOfArticleComponent))})).catch((e=>window.guardian.modules.sentry.reportError(e,"braze-epic")))}),[]),(0,r.jsx)(r.Fragment,{children:s?(0,r.jsx)(y,{BrazeComponent:s,meta:t,countryCode:o,idApiUrl:a}):(0,r.jsx)("div",{})})};var O=n(8706),C=n(9103),j=n(1279),P=n(8869),E=n(4914),I=n(6354);function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){S(e,t,n[t])}))}return e}function z(){const e=(t=["\n\tmargin: 18px 0;\n\tclear: both;\n"],n||(n=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(n)}})));var t,n;return z=function(){return e},e}const B=(0,u.css)(z());var R,k;const x=e=>{let{module:t,fetchEmail:n,hasConsentForArticleCount:o,stage:a}=e;const[s,c]=(0,i.useState)();return(0,i.useEffect)((()=>{(0,I.R)();const e=(0,P.i)("contributions-epic-module");e.start(),window.guardianPolyfilledImport(t.url).then((t=>{e.end(),c((()=>t.ContributionsEpic))})).catch((e=>{const t=e instanceof Error?"Error importing RR epic: ".concat(e.message):"Unknown error";console.log(t),window.guardian.modules.sentry.reportError(new Error(t),"rr-epic")}))}),[]),void 0!==s?(0,r.jsx)("div",{css:B,children:(0,r.jsx)(s,(l=A({},t.props),d={fetchEmail:n,submitComponentEvent:p.X4,openCmp:()=>{O.cmp.showPrivacyManager()},hasConsentForArticleCount:o,stage:a},d=null!=d?d:{},Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(d)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(d)).forEach((function(e){Object.defineProperty(l,e,Object.getOwnPropertyDescriptor(d,e))})),l))}):null;var l,d};function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const U=e=>({candidate:{id:"reader-revenue-banner",canShow:()=>(async e=>{var t;const{isSignedIn:n,shouldHideReaderRevenue:r,isPaidContent:i,contributionsServiceUrl:a,idApiUrl:s,stage:c}=e;if(r||i)return Promise.resolve({show:!1});(0,P.i)("contributions-epic-data").start();const l=await(async e=>({tracking:{ophanPageId:window.guardian.config.ophan.pageViewId,platformId:"GUARDIAN_WEB",clientName:"dcr",referrerUrl:window.location.origin+window.location.pathname},targeting:{contentType:e.contentType,sectionId:e.sectionId,shouldHideReaderRevenue:e.shouldHideReaderRevenue,isMinuteArticle:e.isMinuteArticle,isPaidContent:e.isPaidContent,tags:e.tags,showSupportMessaging:!(0,E.S9)(null!==(R=e.isSignedIn)&&void 0!==R&&R),isRecurringContributor:(0,E.T0)(null!==(k=e.isSignedIn)&&void 0!==k&&k),lastOneOffContributionDate:(0,E.qQ)(),epicViewLog:(0,j.Es)(C.t.local),weeklyArticleHistory:await e.asyncArticleCount,hasOptedOutOfArticleCount:await(0,E.Am)(),mvtId:Number((0,o.e)({name:"GU_mvt_id",shouldMemoize:!0})),countryCode:e.countryCode,modulesVersion:E.BQ,url:window.location.origin+window.location.pathname,browserId:await(0,E.H2)()?e.browserId:void 0,isSignedIn:e.isSignedIn}}))(e),d=null===(t=(await(0,j.bv)(a,l)).data)||void 0===t?void 0:t.module;return d?{show:!0,meta:{module:d,fetchEmail:n?(0,E.nh)(s):void 0,hasConsentForArticleCount:await(0,E.G9)(),stage:c}}:{show:!1}})(e),show:e=>()=>(0,r.jsx)(x,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){M(e,t,n[t])}))}return e}({},e))},timeoutMillis:null}),T=(e,t,n,o,i,a)=>({candidate:{id:"braze-epic",canShow:()=>(async(e,t,n,r)=>{if("interactive"===n.toLowerCase())return{show:!1};const o=(0,m.P)();if(o)return{show:!0,meta:o};if((0,f.p)(r))return{show:!1};try{const n=await e.getMessageForEndOfArticle(t);return n.extras?{show:!0,meta:{dataFromBraze:n.extras,logImpressionWithBraze:()=>{n.logImpression()},logButtonClickWithBraze:e=>{n.logButtonClick(e)}}}:{show:!1}}catch(e){return{show:!1}}})(e,i,o,a),show:e=>()=>(0,r.jsx)(v,{meta:e,countryCode:t,idApiUrl:n})},timeoutMillis:2e3}),_=e=>{let{contentType:t,sectionName:n,sectionId:u,shouldHideReaderRevenue:p,isMinuteArticle:m,isPaidContent:g,tags:f,contributionsServiceUrl:h,idApiUrl:b,stage:w,pageId:y,keywordIds:v}=e;const{brazeMessages:O}=(0,l._)(b),[C,j]=(0,i.useState)(),P=!!(0,o.e)({name:"GU_U",shouldMemoize:!0}),E=(0,o.e)({name:"bwid",shouldMemoize:!0}),[I,S]=(0,i.useState)(null),[A,z]=(0,i.useState)();return(0,i.useEffect)((()=>{(0,s.A)().then((e=>{j(null!=e?e:"")})).catch((e=>console.error("countryCodePromise - error: ".concat(String(e)))))}),[]),(0,i.useEffect)((()=>{z((0,a.o)(y,v).then((e=>null==e?void 0:e.weeklyArticleHistory)))}),[y,v]),(0,d.t)((()=>{const e=U({isSignedIn:P,countryCode:C,contentType:t,sectionId:u,shouldHideReaderRevenue:p,isMinuteArticle:m,isPaidContent:g,tags:f,contributionsServiceUrl:h,idApiUrl:b,stage:w,asyncArticleCount:A,browserId:null!=E?E:void 0}),r={candidates:[T(O,C,b,t,{section:n},f),e],name:"slotBodyEnd"};(0,c.B)(r).then((e=>S(e))).catch((e=>console.error("SlotBodyEnd pickMessage - error: ".concat(String(e)))))}),[P,C,O,A]),null!==I?(0,r.jsx)("div",{id:"slot-body-end",children:(0,r.jsx)(I,{})}):null}}}]);
//# sourceMappingURL=SlotBodyEnd-importable.modern.c8320d67d847471922dc.js.map