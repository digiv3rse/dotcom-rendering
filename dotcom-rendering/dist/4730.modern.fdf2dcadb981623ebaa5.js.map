{"version":3,"file":"4730.modern.fdf2dcadb981623ebaa5.js","mappings":"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","sources":["webpack://@guardian/dotcom-rendering/./src/web/components/Dropdown.tsx","webpack://@guardian/dotcom-rendering/./src/web/lib/linkNotificationCount.ts","webpack://@guardian/dotcom-rendering/./src/web/lib/getZIndex.tsx","webpack://@guardian/dotcom-rendering/./src/web/lib/useIsInView.ts","webpack://@guardian/dotcom-rendering/./src/web/lib/useOnce.ts"],"sourcesContent":["import type { SerializedStyles } from '@emotion/react';\nimport { css } from '@emotion/react';\nimport type { OphanComponent } from '@guardian/libs';\nimport {\n\tborder,\n\tbrandAlt,\n\tbrandText,\n\tfrom,\n\tneutral,\n\tnews,\n\tpalette,\n\ttext,\n\ttextSans,\n\tuntil,\n\tvisuallyHidden,\n} from '@guardian/source-foundations';\nimport { useEffect, useMemo, useState } from 'react';\nimport { submitComponentEvent } from '../browser/ophan/ophan';\nimport { getZIndex } from '../lib/getZIndex';\nimport { linkNotificationCount } from '../lib/linkNotificationCount';\nimport type { Notification } from '../lib/notification';\nimport { useIsInView } from '../lib/useIsInView';\nimport { useOnce } from '../lib/useOnce';\n\nconst NOTIFICATION_COMPONENT_TYPE = 'RETENTION_HEADER';\nexport interface DropdownLinkType {\n\tid: string;\n\turl: string;\n\ttitle: string;\n\tisActive?: boolean;\n\tdataLinkName: string;\n\tnotifications?: Notification[];\n}\n\ninterface Props {\n\tid: string;\n\tlabel: string;\n\tlinks: DropdownLinkType[];\n\tdataLinkName: string;\n\tcssOverrides?: SerializedStyles;\n\tchildren?: React.ReactNode;\n}\n\nconst ulStyles = css`\n\t${getZIndex('dropdown')}\n\tlist-style: none;\n\t/* https://developer.mozilla.org/en-US/docs/Web/CSS/list-style#accessibility_concerns */\n\t/* Needs double escape char: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#es2018_revision_of_illegal_escape_sequences */\n\tli::before {\n\t\tcontent: '\\\\200B'; /* Zero width space */\n\t\tdisplay: block;\n\t\theight: 0;\n\t\twidth: 0;\n\t}\n\tbackground-color: white;\n\tpadding: 6px 0;\n\tbox-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1);\n\n\t${until.tablet} {\n\t\tposition: fixed;\n\t\tborder-radius: 0;\n\t\ttop: 32px;\n\t\tleft: 0;\n\t\tright: 0;\n\t\twidth: auto;\n\t\tmax-height: calc(100% - 50px);\n\t\toverflow: auto;\n\t}\n\n\t${from.tablet} {\n\t\tposition: absolute;\n\t\ttop: 100%;\n\t\twidth: 200px;\n\t\tborder-radius: 3px;\n\t}\n`;\n\nconst liStyles = css`\n\tposition: relative;\n\tdisplay: flex;\n`;\n\nconst displayBlock = css`\n\tdisplay: block;\n`;\n\nconst displayNone = css`\n\tdisplay: none;\n`;\n\nconst linkStyles = css`\n\t${textSans.small()};\n\tcolor: ${text.anchorSecondary};\n\tposition: relative;\n\ttransition: color 80ms ease-out;\n\tmargin: -1px 0 0 0;\n\ttext-decoration: none;\n\tdisplay: block;\n\tpadding: 10px 18px 15px 30px;\n\n\t:hover {\n\t\tbackground-color: ${neutral[93]};\n\t\ttext-decoration: none;\n\t}\n\n\t:focus {\n\t\ttext-decoration: underline;\n\t}\n\n\t:before {\n\t\tcontent: '';\n\t\tborder-top: 1px solid ${border.secondary};\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\ttop: 0px;\n\t\tleft: 30px;\n\t\tright: 0px;\n\t}\n`;\n\nconst linkActive = css`\n\tfont-weight: bold;\n\n\t:after {\n\t\tcontent: '';\n\t\tborder: 2px solid ${news[400]};\n\t\tborder-top: 0px;\n\t\tborder-right: 0px;\n\t\tposition: absolute;\n\t\ttop: 19px;\n\t\tleft: 12px;\n\t\twidth: 10px;\n\t\theight: 4px;\n\t\ttransform: rotate(-45deg);\n\t}\n`;\n\nconst linkFirst = css`\n\t:before {\n\t\tcontent: none;\n\t}\n`;\n\nconst buttonStyles = css`\n\t${textSans.medium()};\n\tdisplay: block;\n\tcursor: pointer;\n\tbackground: none;\n\tborder: none;\n\t/* Design System: The buttons should be components that handle their own layout using primitives  */\n\tline-height: 1.2;\n\tcolor: ${brandText.primary};\n\ttransition: color 80ms ease-out;\n\tpadding: 0px 10px 6px 5px;\n\tmargin: 1px 0 0;\n\ttext-decoration: none;\n\tposition: relative;\n\n\t:hover {\n\t\tcolor: ${brandAlt[400]};\n\n\t\t:after {\n\t\t\ttransform: translateY(0) rotate(45deg);\n\t\t}\n\t}\n\n\t:after {\n\t\tcontent: '';\n\t\tdisplay: inline-block;\n\t\twidth: 5px;\n\t\theight: 5px;\n\t\ttransform: translateY(-2px) rotate(45deg);\n\t\tborder: 1px solid currentColor;\n\t\tborder-left: transparent;\n\t\tborder-top: transparent;\n\t\tmargin-left: 5px;\n\t\tvertical-align: middle;\n\t\ttransition: transform 250ms ease-out;\n\t}\n`;\n\nconst buttonExpanded = css`\n\t:hover:after {\n\t\ttransform: translateY(-1px) rotate(-135deg);\n\t}\n\t:after {\n\t\ttransform: translateY(1px) rotate(-135deg);\n\t}\n`;\n\nconst notificationColor = palette.error[400];\n\nconst notificationBadgeStyles = (diameter: number) => css`\n\tbackground-color: ${notificationColor};\n\tcolor: ${palette.neutral[100]};\n\ttext-align: center;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\t${textSans.xsmall()};\n\tline-height: 1;\n\n\twidth: ${diameter}px;\n\theight: ${diameter}px;\n\tborder-radius: ${diameter}px;\n`;\n\nconst dropdownButtonNotificationBadgeStyles = css`\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tmargin-left: -10px;\n\tmargin-top: -3px;\n`;\n\nconst notificationTextStyles = css`\n\t${textSans.xxsmall()};\n`;\n\nconst buildOphanComponentWithNotifications = (\n\tlink: DropdownLinkType,\n): OphanComponent | undefined => {\n\t// Only track if it has notifications\n\tif (link.notifications && link.notifications.length > 0) {\n\t\treturn {\n\t\t\tcomponentType: NOTIFICATION_COMPONENT_TYPE,\n\t\t\tid: link.id,\n\t\t\tlabels: link.notifications.map(\n\t\t\t\t(notification) => notification.ophanLabel,\n\t\t\t),\n\t\t};\n\t}\n\treturn undefined;\n};\n\nconst addTrackingToUrl = (\n\turl: string,\n\tophanComponent: OphanComponent,\n): string => {\n\t// Use the acquisitionData query param to send tracking to the destination\n\tconst acquisitionData = encodeURIComponent(\n\t\tJSON.stringify({\n\t\t\tsource: 'GUARDIAN_WEB',\n\t\t\tcomponentId: ophanComponent.id,\n\t\t\tcomponentType: ophanComponent.componentType,\n\t\t\tcampaignCode: ophanComponent.id,\n\t\t\treferrerPageviewId: window.guardian.config.ophan.pageViewId,\n\t\t\treferrerUrl: window.location.origin + window.location.pathname,\n\t\t\tlabels: ophanComponent.labels,\n\t\t}),\n\t);\n\tconst prefix = url.includes('?') ? '&' : '?';\n\treturn `${url}${prefix}acquisitionData=${acquisitionData}`;\n};\n\nconst NotificationBadge = ({ diameter }: { diameter: number }) => {\n\treturn (\n\t\t<div css={notificationBadgeStyles(diameter)}>\n\t\t\t<span>!</span>\n\t\t</div>\n\t);\n};\n\ntype NotificationMessageProps = {\n\tnotification: Notification;\n};\nconst NotificationMessage = ({ notification }: NotificationMessageProps) => {\n\tconst { message } = notification;\n\n\treturn <div css={notificationTextStyles}>{message}</div>;\n};\n\ntype DropdownLinkProps = {\n\tlink: DropdownLinkType;\n\tindex: number;\n};\nconst DropdownLink = ({ link, index }: DropdownLinkProps) => {\n\tconst ophanComponent = useMemo(\n\t\t() => buildOphanComponentWithNotifications(link),\n\t\t[link],\n\t);\n\n\tconst [hasBeenSeen, setNode] = useIsInView({\n\t\tdebounce: true,\n\t});\n\tconst [hasSentViewEvent, setHasSentViewEvent] = useState<boolean>(false);\n\n\t// The following hooks, which send INSERT and VIEW events to Ophan,\n\t// intentionally only run when the link has notifications (which is why\n\t// link.notifications is part of the dependency array for both). In future\n\t// if we ever have notifications arriving from different sources at\n\t// different times, we'll need to revisit this logic (currently they only\n\t// come from Braze).\n\tuseEffect(() => {\n\t\tif (\n\t\t\thasBeenSeen &&\n\t\t\tophanComponent &&\n\t\t\tlink.notifications &&\n\t\t\tlink.notifications.length > 0 &&\n\t\t\t!hasSentViewEvent\n\t\t) {\n\t\t\tsetHasSentViewEvent(true);\n\n\t\t\t// For each notification for this link, log the impression back to\n\t\t\t// Braze separately\n\t\t\tlink.notifications.forEach((notification) => {\n\t\t\t\tnotification.logImpression?.();\n\t\t\t});\n\n\t\t\tsubmitComponentEvent({\n\t\t\t\tcomponent: ophanComponent,\n\t\t\t\taction: 'VIEW',\n\t\t\t});\n\t\t}\n\t}, [\n\t\thasBeenSeen,\n\t\tophanComponent,\n\t\tlink.notifications,\n\t\thasSentViewEvent,\n\t\tlink.id,\n\t]);\n\n\tuseOnce(() => {\n\t\tif (ophanComponent) {\n\t\t\tsubmitComponentEvent({\n\t\t\t\tcomponent: ophanComponent,\n\t\t\t\taction: 'INSERT',\n\t\t\t});\n\t\t}\n\t}, [ophanComponent]);\n\n\tconst url = ophanComponent\n\t\t? addTrackingToUrl(link.url, ophanComponent)\n\t\t: link.url;\n\n\tconst hasNotifications =\n\t\tlink.notifications !== undefined && link.notifications.length > 0;\n\n\treturn (\n\t\t<li css={liStyles} key={link.title} ref={setNode}>\n\t\t\t<a\n\t\t\t\thref={url}\n\t\t\t\tcss={[\n\t\t\t\t\tlinkStyles,\n\t\t\t\t\t!!link.isActive && linkActive,\n\t\t\t\t\tindex === 0 && linkFirst,\n\t\t\t\t]}\n\t\t\t\tdata-link-name={link.dataLinkName}\n\t\t\t\tonClick={() => {\n\t\t\t\t\tif (ophanComponent) {\n\t\t\t\t\t\tsubmitComponentEvent({\n\t\t\t\t\t\t\tcomponent: ophanComponent,\n\t\t\t\t\t\t\taction: 'CLICK',\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{link.title}\n\t\t\t\t{link.notifications?.map((notification) => (\n\t\t\t\t\t<NotificationMessage\n\t\t\t\t\t\tnotification={notification}\n\t\t\t\t\t\tkey={notification.id}\n\t\t\t\t\t/>\n\t\t\t\t))}\n\t\t\t</a>\n\n\t\t\t{hasNotifications && (\n\t\t\t\t<div\n\t\t\t\t\tcss={css`\n\t\t\t\t\t\tmargin-top: 12px;\n\t\t\t\t\t\tmargin-right: 8px;\n\t\t\t\t\t`}\n\t\t\t\t>\n\t\t\t\t\t<NotificationBadge diameter={22} />\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</li>\n\t);\n};\n\nexport const Dropdown = ({\n\tid,\n\tlabel,\n\tlinks,\n\tdataLinkName,\n\tcssOverrides,\n\tchildren,\n}: Props) => {\n\tconst [isExpanded, setIsExpanded] = useState(false);\n\tconst [noJS, setNoJS] = useState(true);\n\n\tuseEffect(() => {\n\t\t// If hook runs we know client-side JS is enabled\n\t\tsetNoJS(false);\n\t}, []);\n\n\tuseEffect(() => {\n\t\tconst dismissOnEsc = (event: KeyboardEvent) => {\n\t\t\tif (isExpanded && event.code === 'Escape') {\n\t\t\t\tsetIsExpanded(false);\n\t\t\t}\n\t\t};\n\n\t\tdocument.addEventListener('keydown', dismissOnEsc, false);\n\n\t\t// Remove listener on unmount\n\t\treturn () => document.removeEventListener('keydown', dismissOnEsc);\n\t}, [isExpanded]);\n\n\tuseEffect(() => {\n\t\tconst dismissOnClick = (event: MouseEvent) => {\n\t\t\tif (isExpanded) {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tsetIsExpanded(false);\n\t\t\t}\n\t\t};\n\n\t\tdocument.addEventListener('click', dismissOnClick, false);\n\n\t\t// Remove listener on unmount\n\t\treturn () => document.removeEventListener('click', dismissOnClick);\n\t}, [isExpanded]);\n\n\tconst handleToggle = () => setIsExpanded(!isExpanded);\n\n\t// needs to be unique to allow multiple dropdowns on same page\n\tconst dropdownID = `dropbox-id-${id}`;\n\tconst checkboxID = `checkbox-id-${id}`;\n\n\tconst notificationCount = linkNotificationCount(links);\n\n\treturn (\n\t\t<>\n\t\t\t{noJS ? (\n\t\t\t\t<div\n\t\t\t\t\tcss={css`\n\t\t\t\t\t\t${`#${checkboxID}`} {\n\t\t\t\t\t\t\t/* Never show the input */\n\t\t\t\t\t\t\t${visuallyHidden}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t${`#${dropdownID}`} {\n\t\t\t\t\t\t\t/* Hide caption by default */\n\t\t\t\t\t\t\tdisplay: none;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t/* stylelint-disable-next-line selector-type-no-unknown */\n\t\t\t\t\t\t${`#${checkboxID}`}:checked + ${`#${dropdownID}`} {\n\t\t\t\t\t\t\t/* Show the caption if the input is checked */\n\t\t\t\t\t\t\tdisplay: block;\n\t\t\t\t\t\t}\n\t\t\t\t\t`}\n\t\t\t\t>\n\t\t\t\t\t<label\n\t\t\t\t\t\thtmlFor={checkboxID}\n\t\t\t\t\t\tcss={[buttonStyles, cssOverrides]}\n\t\t\t\t\t>\n\t\t\t\t\t\t{label}\n\t\t\t\t\t</label>\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\tid={checkboxID}\n\t\t\t\t\t\taria-checked=\"false\"\n\t\t\t\t\t\ttabIndex={-1}\n\t\t\t\t\t/>\n\t\t\t\t\t<ul id={dropdownID} css={[ulStyles, cssOverrides]}>\n\t\t\t\t\t\t{links.map((l, index) => (\n\t\t\t\t\t\t\t<li key={l.title}>\n\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\thref={l.url}\n\t\t\t\t\t\t\t\t\tcss={[\n\t\t\t\t\t\t\t\t\t\tlinkStyles,\n\t\t\t\t\t\t\t\t\t\t!!l.isActive && linkActive,\n\t\t\t\t\t\t\t\t\t\tindex === 0 && linkFirst,\n\t\t\t\t\t\t\t\t\t]}\n\t\t\t\t\t\t\t\t\tdata-link-name={l.dataLinkName}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{l.title}\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t) : (\n\t\t\t\t<>\n\t\t\t\t\t<button\n\t\t\t\t\t\tonClick={handleToggle}\n\t\t\t\t\t\tcss={[\n\t\t\t\t\t\t\tbuttonStyles,\n\t\t\t\t\t\t\tcssOverrides,\n\t\t\t\t\t\t\tisExpanded && buttonExpanded,\n\t\t\t\t\t\t]}\n\t\t\t\t\t\taria-expanded={isExpanded ? 'true' : 'false'}\n\t\t\t\t\t\tdata-link-name={dataLinkName}\n\t\t\t\t\t\tdata-cy=\"dropdown-button\"\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{label}\n\t\t\t\t\t\t{notificationCount > 0 && (\n\t\t\t\t\t\t\t<div css={dropdownButtonNotificationBadgeStyles}>\n\t\t\t\t\t\t\t\t<NotificationBadge diameter={18} />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</button>\n\t\t\t\t\t<div css={isExpanded ? displayBlock : displayNone}>\n\t\t\t\t\t\t{/* eslint-disable-next-line @typescript-eslint/strict-boolean-expressions -- Children types are awkward but this should work */}\n\t\t\t\t\t\t{children ? (\n\t\t\t\t\t\t\t<>{children}</>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<ul\n\t\t\t\t\t\t\t\tcss={[ulStyles, cssOverrides]}\n\t\t\t\t\t\t\t\tdata-cy=\"dropdown-options\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{links.map((link, index) => (\n\t\t\t\t\t\t\t\t\t<DropdownLink\n\t\t\t\t\t\t\t\t\t\tkey={link.id}\n\t\t\t\t\t\t\t\t\t\tlink={link}\n\t\t\t\t\t\t\t\t\t\tindex={index}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</>\n\t\t\t)}\n\t\t</>\n\t);\n};\n","import type { DropdownLinkType } from '../components/Dropdown';\n\nexport const linkNotificationCount = (links: DropdownLinkType[]): number => {\n\treturn links.reduce((runningCount, link) => {\n\t\tconst thisLinkNotificationCount = link.notifications?.length ?? 0;\n\t\treturn runningCount + thisLinkNotificationCount;\n\t}, 0);\n};\n","/**\n * How do I get a z-index for my new item?\n *\n * Decide a meaningful name for your item and then insert it\n * in the indices array below. The higher up your item visually,\n * then the higher it will be in the z-index stack,\n * 'higher' means _earlier_ in the array.\n *\n * Eg. stickyAdWrapper will be given a higher z-index than bodyArea\n *\n * Once inserted in the array, use getZIndex() to return the css\n *\n * Eg.\n *\n * import { getZIndex } from './getZIndex';\n *\n * const myCss = css`\n *    color: blue;\n *    ${getZIndex('TheGuardian')}\n * `;\n *\n * As new items are added, all z-indexes are adjusted\n */\nconst indices = [\n\t// Modals will go here at the top\n\n\t// Sticky video and button need to be above everything\n\t'sticky-video-button',\n\t'sticky-video',\n\t'banner',\n\t'dropdown',\n\t'burger',\n\t'expanded-veggie-menu-wrapper',\n\t'expanded-veggie-menu',\n\n\t// Mobile sticky appears below banners\n\t'mobileSticky',\n\n\t// Headers with sticky ads\n\t'stickyAdWrapperLabsHeader',\n\t'stickyAdWrapper',\n\t'stickyAdWrapperNav',\n\n\t// Edition selector in nav - needs to be below stickyAdWrapper\n\t'editionDropdown',\n\n\t// Liveblog toast\n\t'toast',\n\n\t// Onwards Carousel (Related content etc)\n\t'onwardsCarousel',\n\n\t// Search link should be above The Guardian svg\n\t'myAccountDropdown',\n\t'searchHeaderLink',\n\t'TheGuardian',\n\n\t// Wrapper after nav stuff\n\t'headerWrapper',\n\n\t// Article headline (should be above main media)\n\t'articleHeadline',\n\t'immersiveBlackBox',\n\n\t// Body\n\t'bodyArea',\n\t'rightColumnArea',\n\n\t// Main media\n\t'mainMedia',\n\n\t// Nested links in cards should sit above the main card link\n\t// See: https://www.sarasoueidan.com/blog/nested-links/\n\t'card-nested-link',\n\t'card-link',\n] as const;\n\n// Implementation code - you don't need to change this to get a new index\nexport type ZIndex = (typeof indices)[number];\n\nconst decideIndex = (name: ZIndex): number => {\n\tconst index = indices.indexOf(name);\n\tif (index === -1) return -1; // indexOf returns -1 if there is no match\n\treturn indices.length - index; // reverse the indices: last item gets 1\n};\n\nexport const getZIndex = (zIndex: ZIndex): string =>\n\t`z-index: ${decideIndex(zIndex)};`;\n\nexport const getZIndexImportant = (zIndex: ZIndex): string =>\n\t`z-index: ${decideIndex(zIndex)} !important;`;\n","import libDebounce from 'lodash.debounce';\nimport { useEffect, useRef, useState } from 'react';\n\n/**\n * Custom hook around the `IntersectionObserver`.\n *\n * @param options\n * @param {boolean} [options.debouce] If `true`, debounce triggers by 200ms.\n * By default, trigger instantaneously. Enabling debouncing ensures the target\n * element intersects for at least 200ms before the callback is executed\n * @param {boolean} [options.repeat] If `true`, trigger the hook on\n * all intersections. By default, only trigger on the first intersection.\n * @param {boolean} [options.node] Set the initial node, if known.\n * @returns a tuple containing [isInView, setNode];\n */\nconst useIsInView = (\n\toptions: IntersectionObserverInit & {\n\t\tdebounce?: true;\n\t\trepeat?: true;\n\t\tnode?: HTMLElement;\n\t},\n): [boolean, React.Dispatch<React.SetStateAction<HTMLElement | null>>] => {\n\tconst [isInView, setIsInView] = useState<boolean>(false);\n\tconst [node, setNode] = useState<HTMLElement | null>(options.node ?? null);\n\n\tconst observer = useRef<IntersectionObserver | null>(null);\n\n\tconst intersectionFn: IntersectionObserverCallback = ([entry]) => {\n\t\tif (!entry) return;\n\n\t\tif (entry.isIntersecting) {\n\t\t\tsetIsInView(true);\n\t\t} else if (options.repeat) {\n\t\t\tsetIsInView(false);\n\t\t}\n\t};\n\tconst intersectionCallback = options.debounce\n\t\t? libDebounce(intersectionFn, 200)\n\t\t: intersectionFn;\n\n\tuseEffect(() => {\n\t\t// TODO: can we remove this? It’s now always cleaned up\n\t\tif (observer.current) {\n\t\t\tobserver.current.disconnect();\n\t\t}\n\n\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions, @typescript-eslint/no-unnecessary-condition -- Safety for browser support\n\t\tif (window.IntersectionObserver) {\n\t\t\tobserver.current = new window.IntersectionObserver(\n\t\t\t\tintersectionCallback,\n\t\t\t\toptions,\n\t\t\t);\n\n\t\t\tif (node) {\n\t\t\t\tobserver.current.observe(node);\n\t\t\t}\n\t\t}\n\n\t\treturn () => observer.current?.disconnect();\n\t}, [node, options, intersectionCallback]);\n\n\treturn [isInView, setNode];\n};\n\nexport { useIsInView };\n","import { useEffect, useState } from 'react';\n\n/**\n * Ensures that the given task is only run once and only after all items in waitFor are defined\n * @param {Function} task - The task to execute once\n * @param {Array} waitFor - An array of variables that must be defined before the task is executed\n * */\nexport const useOnce = (task: () => void, waitFor: unknown[]): void => {\n\tconst [alreadyRun, setAlreadyRun] = useState(false);\n\tconst isReady = waitFor.every((dep) => dep !== undefined);\n\tuseEffect(() => {\n\t\tif (!alreadyRun && isReady) {\n\t\t\ttask();\n\t\t\tsetAlreadyRun(true);\n\t\t}\n\t}, [alreadyRun, isReady, task]);\n};\n"],"names":["ulStyles","css","getZIndex","until","from","liStyles","displayBlock","displayNone","linkStyles","textSans","text","neutral","border","linkActive","news","linkFirst","buttonStyles","brandText","brandAlt","buttonExpanded","notificationColor","palette","notificationBadgeStyles","diameter","dropdownButtonNotificationBadgeStyles","notificationTextStyles","NotificationBadge","div","span","NotificationMessage","notification","message","DropdownLink","link","index","ophanComponent","useMemo","notifications","length","componentType","id","labels","map","ophanLabel","buildOphanComponentWithNotifications","hasBeenSeen","setNode","useIsInView","debounce","hasSentViewEvent","setHasSentViewEvent","useState","useEffect","forEach","logImpression","submitComponentEvent","component","action","useOnce","url","acquisitionData","encodeURIComponent","JSON","stringify","source","componentId","campaignCode","referrerPageviewId","window","guardian","config","ophan","pageViewId","referrerUrl","location","origin","pathname","prefix","includes","addTrackingToUrl","hasNotifications","undefined","li","ref","a","href","isActive","data-link-name","dataLinkName","onClick","title","Dropdown","label","links","cssOverrides","children","isExpanded","setIsExpanded","noJS","setNoJS","dismissOnEsc","event","code","document","addEventListener","removeEventListener","dismissOnClick","stopPropagation","dropdownID","checkboxID","notificationCount","reduce","runningCount","linkNotificationCount","visuallyHidden","htmlFor","input","type","aria-checked","tabIndex","ul","l","button","aria-expanded","data-cy","indices","zIndex","name","indexOf","decideIndex","options","isInView","setIsInView","node","observer","useRef","intersectionFn","entry","isIntersecting","repeat","intersectionCallback","libDebounce","current","disconnect","IntersectionObserver","observe","task","waitFor","alreadyRun","setAlreadyRun","isReady","every","dep"],"sourceRoot":""}