"use strict";(self.webpackChunk_guardian_dotcom_rendering=self.webpackChunk_guardian_dotcom_rendering||[]).push([[1450],{9512:(e,n,t)=>{t.r(n),t.d(n,{StickyBottomBanner:()=>G});var r=t(5809),i=t(7800),o=t(5226),a=t(4857),s=t(3904),u=t(8059),c=t(8534),d=t(6358),l=t(8078),p=t(6849),m=t(3287),f=t(9154),g=t(7791),v=t(824),h=t.n(v),C=t(43),b=t(3203),y=t(3053),w=t(2290),S=t(6530),A=(0,C.css)("position:fixed;bottom:-1px;width:100%;",(0,w.K)("banner"),";"),B=function(){var e=(0,g.Z)(h().mark((function e(n,t,r){var i,o,a,s,u;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=(0,y.P)())){e.next=3;break}return e.abrupt("return",{show:!0,meta:i});case 3:if(!(0,S.p)(r)){e.next=5;break}return e.abrupt("return",{show:!1});case 5:return e.prev=5,e.next=8,n.getMessageForBanner(t);case 8:if(o=e.sent,a=function(e){o.logButtonClick(e)},s=function(){o.logImpression()},!o.extras){e.next=14;break}return u={dataFromBraze:o.extras,logImpressionWithBraze:s,logButtonClickWithBraze:a},e.abrupt("return",{show:!0,meta:u});case 14:return e.abrupt("return",{show:!1});case 17:return e.prev=17,e.t0=e.catch(5),e.abrupt("return",{show:!1});case 20:case"end":return e.stop()}}),e,null,[[5,17]])})));return function(n,t,r){return e.apply(this,arguments)}}(),I=function(e){var n=e.BrazeComponent,t=e.meta,r=e.idApiUrl;(0,s.useEffect)((function(){var e;t.logImpressionWithBraze(),(0,b.X4)({component:{componentType:"RETENTION_ENGAGEMENT_BANNER",id:null!==(e=t.dataFromBraze.ophanComponentId)&&void 0!==e?e:t.dataFromBraze.componentName},action:"VIEW"})}),[]);var o,a=t.dataFromBraze.componentName;return a?(0,i.jsx)("div",{css:A,children:(0,i.jsx)(n,{logButtonClickWithBraze:t.logButtonClickWithBraze,submitComponentEvent:b.X4,componentName:a,brazeMessageProps:t.dataFromBraze,subscribeToNewsletter:(o=(0,g.Z)(h().mark((function e(n){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(r,"/users/me/newsletters"),{method:"PATCH",body:JSON.stringify({id:n,subscribed:!0}),credentials:"include"});case 2:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})})}):null},x=function(e){var n=e.meta,o=e.idApiUrl,a=(0,s.useState)(),u=(0,r.Z)(a,2),c=u[0],d=u[1];return(0,s.useEffect)((function(){Promise.all([t.e(8887),t.e(8639),t.e(7371)]).then(t.bind(t,9823)).then((function(e){d((function(){return e.BrazeBannerComponent}))})).catch((function(e){return window.guardian.modules.sentry.reportError(e,"braze-banner")}))}),[]),(0,i.jsx)(i.Fragment,{children:c?(0,i.jsx)(I,{BrazeComponent:c,meta:n,idApiUrl:o}):(0,i.jsx)("div",{})})},k=t(4649),P=t(1846),O=t(6792),E=t(9175),N=t(2460),R=t(8576),T=t(9213);function U(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function z(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?U(Object(t),!0).forEach((function(n){(0,k.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):U(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var L=function(e){var n=null==e?void 0:e.dailyArticleHistory[0];if(n)return n.day===(0,N.x2)()?n.count:0},j=function(){var e=(0,g.Z)(h().mark((function e(n){var t,r,i,o,s,u,c,d,l,p,m,f,g,v,C,b,y;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.isSignedIn,r=n.shouldHideReaderRevenue,i=n.isPaidContent,o=n.alreadyVisitedCount,s=n.engagementBannerLastClosedAt,u=n.subscriptionBannerLastClosedAt,c=n.signInBannerLastClosedAt,d=n.countryCode,l=n.optedOutOfArticleCount,p=n.asyncArticleCounts,m=n.sectionId,f=n.tags,g=n.contentType,e.next=3,p;case 3:return v=e.sent,C=null==v?void 0:v.weeklyArticleHistory,b=L(v),y=(0,a.e)({name:"bwid",shouldMemoize:!0}),e.t0={ophanPageId:window.guardian.config.ophan.pageViewId,platformId:"GUARDIAN_WEB",clientName:"dcr",referrerUrl:window.location.origin+window.location.pathname},e.t1=o,e.t2=r,e.t3=i,e.t4=!(0,E.S9)(t),e.t5=s,e.t6=u,e.t7=c,e.t8=Number((0,a.e)({name:"GU_mvt_id",shouldMemoize:!0})),e.t9=d,e.t10=C,e.t11=b,e.t12=l,e.t13=E.BQ,e.t14=m,e.t15=f.map((function(e){return e.id})),e.t16=g,e.next=26,(0,E.H2)();case 26:if(!e.sent){e.next=30;break}e.t17=null!=y?y:void 0,e.next=31;break;case 30:e.t17=void 0;case 31:return e.t18=e.t17,e.t19=(0,E.cs)(),e.t20=t,e.t21=(0,E.tq)(),e.t22={alreadyVisitedCount:e.t1,shouldHideReaderRevenue:e.t2,isPaidContent:e.t3,showSupportMessaging:e.t4,engagementBannerLastClosedAt:e.t5,subscriptionBannerLastClosedAt:e.t6,signInBannerLastClosedAt:e.t7,mvtId:e.t8,countryCode:e.t9,weeklyArticleHistory:e.t10,articleCountToday:e.t11,hasOptedOutOfArticleCount:e.t12,modulesVersion:e.t13,sectionId:e.t14,tagIds:e.t15,contentType:e.t16,browserId:e.t18,purchaseInfo:e.t19,isSignedIn:e.t20,lastOneOffContributionDate:e.t21},e.abrupt("return",{tracking:e.t0,targeting:e.t22});case 37:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),M=function(){var e=(0,g.Z)(h().mark((function e(n){var t,r,i,o,a,s,u,c,d,l,p,m,f,g,v,C,b,y,w,S,A,B,I,x,k,O,N,R,T,U;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.remoteBannerConfig,r=n.isSignedIn,i=n.asyncCountryCode,o=n.contentType,a=n.sectionId,s=n.shouldHideReaderRevenue,u=n.isMinuteArticle,c=n.isPaidContent,d=n.isSensitive,l=n.tags,p=n.contributionsServiceUrl,m=n.alreadyVisitedCount,f=n.engagementBannerLastClosedAt,g=n.subscriptionBannerLastClosedAt,v=n.signInBannerLastClosedAt,C=n.isPreview,b=n.idApiUrl,y=n.signInGateWillShow,w=n.asyncArticleCounts,t){e.next=3;break}return e.abrupt("return",{show:!1});case 3:if(!(s||c||C||y)){e.next=5;break}return e.abrupt("return",{show:!1});case 5:if(S=(0,E.cs)(),A=S&&!r&&!v,B=window.location.search.includes("force-banner"),A||B||!f||!g||!(0,E.Pl)()){e.next=10;break}return e.abrupt("return",{show:!1});case 10:return e.next=12,i;case 12:return I=e.sent,e.next=15,(0,E.Am)();case 15:return x=e.sent,e.next=18,j({isSignedIn:r,countryCode:I,contentType:o,sectionId:a,shouldHideReaderRevenue:s,isMinuteArticle:u,isPaidContent:c,tags:l,contributionsServiceUrl:p,isSensitive:d,alreadyVisitedCount:m,engagementBannerLastClosedAt:f,subscriptionBannerLastClosedAt:g,signInBannerLastClosedAt:v,optedOutOfArticleCount:x,asyncArticleCounts:w});case 18:return k=e.sent,e.next=21,(0,P.Eg)(p,k);case 21:if((O=e.sent).data){e.next=25;break}return f&&g&&(0,E.ZD)(),e.abrupt("return",{show:!1});case 25:return N=O.data,R=N.module,T=N.meta,U=r?(0,E.nh)(b):void 0,e.abrupt("return",{show:!0,meta:{module:R,meta:T,fetchEmail:U}});case 28:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),H=function(){var e=(0,g.Z)(h().mark((function e(n){var t,r,i,o,a,s,u,c,d,l,p,m,f,g,v,C,b,y,w,S;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.remoteBannerConfig,r=n.isSignedIn,i=n.asyncCountryCode,o=n.contentType,a=n.sectionId,s=n.shouldHideReaderRevenue,u=n.isMinuteArticle,c=n.isPaidContent,d=n.isSensitive,l=n.tags,p=n.contributionsServiceUrl,m=n.alreadyVisitedCount,f=n.engagementBannerLastClosedAt,g=n.subscriptionBannerLastClosedAt,v=n.section,C=n.asyncArticleCounts,b="crosswords"===v||l.some((function(e){return"Series"===e.type&&"Sudoku"===e.title})),!s){e.next=4;break}return e.abrupt("return",{show:!1});case 4:if(!b||!t){e.next=15;break}return e.next=7,i;case 7:return y=e.sent,e.next=10,(0,E.Am)();case 10:return w=e.sent,e.next=13,j({isSignedIn:r,countryCode:y,contentType:o,sectionId:a,shouldHideReaderRevenue:s,isMinuteArticle:u,isPaidContent:c,tags:l,contributionsServiceUrl:p,isSensitive:d,alreadyVisitedCount:m,engagementBannerLastClosedAt:f,subscriptionBannerLastClosedAt:g,optedOutOfArticleCount:w,asyncArticleCounts:C});case 13:return S=e.sent,e.abrupt("return",(0,P.Nh)(p,S).then((function(e){if(!e.data)return{show:!1};var n=e.data;return{show:!0,meta:{module:n.module,meta:n.meta}}})));case 15:return e.abrupt("return",{show:!1});case 16:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),Z=function(e){var n=e.componentTypeName,t=e.displayEvent,o=e.meta,a=e.module,u=e.fetchEmail,c=(0,s.useState)(),d=(0,r.Z)(c,2),l=d[0],p=d[1],f=(0,T.O)({threshold:0,debounce:!0}),g=(0,r.Z)(f,2),v=g[0],h=g[1];return(0,m.t)((function(){void 0!==a&&void 0!==o&&((0,R.R)(),window.guardianPolyfilledImport(a.url).then((function(e){p((function(){var n;return null!==(n=e[a.name])&&void 0!==n?n:null}))})).catch((function(e){var n="Error importing RR banner: ".concat(String(e));console.log(n),window.guardian.modules.sentry.reportError(new Error(n),"rr-banner")})))}),[]),(0,m.t)((function(){o.componentType===n&&(0,O.C4)(t)}),[v,o]),void 0!==l?(0,i.jsx)("div",{ref:h,css:(0,C.css)("width:100%;",(0,w.K)("banner"),";"),children:(0,i.jsx)(l,z(z({},a.props),{},{submitComponentEvent:b.X4,fetchEmail:u}))}):null},_=function(e){var n=e.meta,t=e.module,r=e.fetchEmail;return(0,i.jsx)(Z,{componentTypeName:"ACQUISITIONS_SUBSCRIPTIONS_BANNER",displayEvent:"subscription-banner : display",meta:n,module:t,fetchEmail:r})},W=function(e){var n=e.meta,t=e.module;return(0,i.jsx)(Z,{componentTypeName:"ACQUISITIONS_OTHER",displayEvent:"puzzles-banner : display",meta:n,module:t})},V=function(e){var n=localStorage.getItem("gu.prefs.".concat(e));return n?JSON.parse(n).value:n},F=function(e){var n=e.id,t=e.BannerComponent,r=e.canShowFn,o=e.isEnabled;return function(e){var a=e.isSignedIn,s=e.asyncCountryCode,u=e.isPreview,d=e.asyncArticleCounts,l=e.signInGateWillShow,p=void 0!==l&&l,m=e.contentType,f=e.section,g=e.shouldHideReaderRevenue,v=e.isMinuteArticle,h=e.isPaidContent,C=e.isSensitive,b=e.tags,y=e.contributionsServiceUrl,w=e.idApiUrl;return{candidate:{id:n,canShow:function(){return r({remoteBannerConfig:o,isSignedIn:a,asyncCountryCode:s,contentType:m,sectionId:f,shouldHideReaderRevenue:g,isMinuteArticle:v,isPaidContent:h,isSensitive:C,tags:b,contributionsServiceUrl:y,alreadyVisitedCount:(0,c.n1)(),engagementBannerLastClosedAt:V("engagementBannerLastClosedAt"),subscriptionBannerLastClosedAt:V("subscriptionBannerLastClosedAt"),signInBannerLastClosedAt:V("signInBannerLastClosedAt"),section:f,isPreview:u,idApiUrl:w,signInGateWillShow:p,asyncArticleCounts:d})},show:function(e){var n=e.meta,r=e.module,o=e.fetchEmail;return function(){return(0,i.jsx)(t,{meta:n,module:r,fetchEmail:o})}}},timeoutMillis:2e3}}},G=function(e){var n=e.contentType,t=e.sectionName,c=e.section,g=e.tags,v=e.isPaidContent,h=e.isPreview,C=e.shouldHideReaderRevenue,b=e.isMinuteArticle,y=e.isSensitive,w=e.contributionsServiceUrl,S=e.idApiUrl,A=e.pageId,I=e.keywordIds,k=e.remoteBannerSwitch,P=e.puzzleBannerSwitch,O=(0,p._)(S).brazeMessages,E=(0,d.A)(),N=!!(0,a.e)({name:"GU_U",shouldMemoize:!0}),R=(0,s.useState)(null),T=(0,r.Z)(R,2),U=T[0],z=T[1],L=(0,s.useState)(),j=(0,r.Z)(L,2),Z=j[0],V=j[1],G=function(e){var n=e.isSignedIn,t=e.contentType,i=e.sectionName,o=e.tags,a=e.isPaidContent,u=e.isPreview,c=(0,s.useState)(void 0),d=(0,r.Z)(c,2),l=d[0],p=d[1],g=(0,s.useState)(void 0),v=(0,r.Z)(g,2),h=v[0],C=v[1],b=(0,s.useState)(!1),y=(0,r.Z)(b,2),w=y[0],S=y[1],A=(0,f.C)();return(0,m.t)((function(){var e=(0,r.Z)(A,2),n=e[0],t=e[1];p(n),C(t)}),[A]),(0,s.useEffect)((function(){l&&h&&l.canShow({isSignedIn:!!n,currentTest:h,contentType:t,sectionName:i,tags:o,isPaidContent:a,isPreview:u}).then(S)}),[h,l,n,t,i,o,a,u]),w&&!!l&&!!l.gate}({isSignedIn:N,contentType:n,sectionName:t,tags:g,isPaidContent:v,isPreview:h});return(0,s.useEffect)((function(){V((0,u.o)(A,I))}),[A,I]),(0,m.t)((function(){var e={candidate:{id:"cmpUi",canShow:function(){return o.cmp.willShowPrivacyMessage().then((function(e){return e?{show:!0,meta:void 0}:{show:!1}}))},show:function(){return null}},timeoutMillis:null},r=F({id:"puzzles-banner",BannerComponent:W,canShowFn:H,isEnabled:P})({isSignedIn:N,asyncCountryCode:E,isPreview:h,asyncArticleCounts:Z,contentType:n,section:c,shouldHideReaderRevenue:C,isMinuteArticle:b,isPaidContent:v,isSensitive:y,tags:g,contributionsServiceUrl:w,idApiUrl:S}),a=F({id:"reader-revenue-banner",BannerComponent:_,canShowFn:M,isEnabled:k})({isSignedIn:N,asyncCountryCode:E,isPreview:h,asyncArticleCounts:Z,signInGateWillShow:G,contentType:n,section:c,shouldHideReaderRevenue:C,isMinuteArticle:b,isPaidContent:v,isSensitive:y,tags:g,contributionsServiceUrl:w,idApiUrl:S}),s=function(e,n,t,r){return{candidate:{id:"braze-banner",canShow:function(){return B(e,n,r)},show:function(e){return function(){return(0,i.jsx)(x,{meta:e,idApiUrl:t})}}},timeoutMillis:2e3}}(O,{section:t},S,g),u={candidates:[e,r,a,s],name:"banner"};(0,l.B)(u).then((function(e){return z(e)})).catch((function(e){return console.error("StickyBottomBanner pickMessage - error: ".concat(String(e)))}))}),[N,E,O,Z]),U?(0,i.jsx)(U,{}):null}},8534:(e,n,t)=>{t.d(n,{Hs:()=>a,Jt:()=>o,n1:()=>i});var r="gu.alreadyVisited",i=function(){var e,n=parseInt(null!==(e=localStorage.getItem(r))&&void 0!==e?e:"",10);return Number.isNaN(n)?0:n},o=function(e){localStorage.setItem(r,e.toString())},a=function(){var e=i();o(e+1)}},2290:(e,n,t)=>{t.d(n,{K:()=>i});var r=["sticky-video-button","sticky-video","banner","dropdown","burger","expanded-veggie-menu-wrapper","expanded-veggie-menu","mobileSticky","stickyAdWrapperLabsHeader","stickyAdWrapper","stickyAdWrapperNav","editionDropdown","toast","onwardsCarousel","myAccountDropdown","searchHeaderLink","TheGuardian","headerWrapper","articleHeadline","immersiveBlackBox","bodyArea","rightColumnArea","mainMedia","card-nested-link","card-link"],i=function(e){return"z-index: ".concat((n=e,-1===(t=r.indexOf(n))?-1:r.length-t),";");var n,t}}}]);
//# sourceMappingURL=StickyBottomBanner-importable.legacy.1c8df4807e2d52117b6d.js.map