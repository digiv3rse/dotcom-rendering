(self.webpackChunk_guardian_dotcom_rendering=self.webpackChunk_guardian_dotcom_rendering||[]).push([[5992],{1504:(e,r,t)=>{"use strict";t.d(r,{BX:()=>O,J9:()=>x,Vp:()=>E,dL:()=>S,uU:()=>B});var n=t(232);function o(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function a(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,r,t){return r&&a(e.prototype,r),t&&a(e,t),e}function s(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function u(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var n,o,a=[],i=!0,s=!1;try{for(t=t.call(e);!(i=(n=t.next()).done)&&(a.push(n.value),!r||a.length!==r);i=!0);}catch(e){s=!0,o=e}finally{try{i||null==t.return||t.return()}finally{if(s)throw o}}return a}}(e,r)||c(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,r){if(e){if("string"==typeof e)return l(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?l(e,r):void 0}}function l(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var f,d,h,g,p=["https://media.guim.co.uk/","https://i.guim.co.uk/"],v=function(e){return p.some((function(r){return e.startsWith(r)}))},m=["%%CURRENCY_SYMBOL%%","%%COUNTRY_NAME%%"],y=/%%.*?%%/g,b=function(e){var r,t,n=e.buttonText,o=e.buttonUrl,a=e.ophanComponentId,i=e.highlightedText,s=w(e),u=!!(t=null===(r=((i||"")+" "+s.join(" ")).match(y))||void 0===r?void 0:r.filter((function(e){return!m.includes("".concat(e))})))&&t.length>0;return Boolean(n&&o&&a&&s.length>0&&!u)},w=function(e){var r,t=[],n=function(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=c(e))){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==t.return||t.return()}finally{if(s)throw a}}}}(Object.keys(e).filter((function(e){return/^paragraph\d$/.test(e)})).sort());try{for(n.s();!(r=n.n()).done;){var o=e[r.value];o&&t.push(o)}}catch(e){n.e(e)}finally{n.f()}return t},C=(s(f={},"AppBanner",(function(e){var r=e.header,t=e.body,n=e.cta,o=e.imageUrl;return!(!(r&&t&&n&&o)||!v(o)&&(console.log("Image URL ".concat(o," is not allowed")),1))})),s(f,"BannerWithLink",(function(e){var r=e.header,t=e.body,n=e.buttonText,o=e.buttonUrl,a=e.imageUrl,i=e.ophanComponentId;return a&&!v(a)?(console.log("Image URL ".concat(a," is not allowed")),!1):Boolean(r&&t&&n&&o&&a&&i)})),s(f,"BannerNewsletter",(function(e){var r=e.header,t=e.body,n=e.imageUrl,o=e.ophanComponentId,a=e.newsletterId,i=e.frequency;return n&&!v(n)?(console.log("Image URL ".concat(n," is not allowed")),!1):Boolean(r&&t&&n&&o&&a&&i)})),s(f,"Epic",b),s(f,"EpicWithSpecialHeader",(function(e){var r=b(e);if(r){var t=e.authoredEpicImageUrl,n=e.authoredEpicImageAltText,o=e.authoredEpicBylineName;return Boolean(t&&n&&o)}return r})),s(f,"NewsletterEpic",(function(e){var r=e.header,t=e.frequency,n=e.paragraph1,o=e.imageUrl,a=e.newsletterId,i=e.ophanComponentId;return!(!(r&&t&&n&&o&&a&&i)||!v(o)&&(console.log("Image URL ".concat(o," is not allowed")),1))})),s(f,"USNewsletterEpic",(function(e){var r=e.header,t=e.frequency,n=e.paragraph1,o=e.ophanComponentId;return Boolean(r&&t&&n&&o)})),s(f,"AUNewsletterEpic",(function(e){var r=e.header,t=e.frequency,n=e.paragraph1,o=e.ophanComponentId;return Boolean(r&&t&&n&&o)})),s(f,"UKNewsletterEpic",(function(e){var r=e.header,t=e.frequency,n=e.paragraph1,o=e.ophanComponentId;return Boolean(r&&t&&n&&o)})),s(f,"DownToEarthNewsletterEpic",(function(e){var r=e.header,t=e.frequency,n=e.paragraph1,o=e.ophanComponentId;return Boolean(r&&t&&n&&o)})),s(f,"EpicNewsletter_AU_AfternoonUpdate",(function(e){var r=e.header,t=e.frequency,n=e.paragraph1,o=e.ophanComponentId;return Boolean(r&&t&&n&&o)})),s(f,"EpicNewsletter_TheGuide",(function(e){var r=e.header,t=e.frequency,n=e.paragraph1,o=e.ophanComponentId;return Boolean(r&&t&&n&&o)})),f),k=function(){function e(r,t,n,a,i,s){o(this,e),this.id=void 0,this.appboy=void 0,this.message=void 0,this.slotName=void 0,this.cache=void 0,this.errorHandler=void 0,this.id=r,this.message=t,this.appboy=n,this.slotName=a,this.cache=i,this.errorHandler=s}return i(e,[{key:"logImpression",value:function(){try{this.appboy.logInAppMessageImpression(this.message)}catch(e){e instanceof Error&&this.errorHandler(e,"BrazeMessage.logImpression")}this.cache.remove(this.slotName,this.id,this.errorHandler)}},{key:"logButtonClick",value:function(e){var r=new this.appboy.InAppMessageButton("Button: ID ".concat(e),void 0,void 0,void 0,void 0,void 0,e);try{this.appboy.logInAppMessageButtonClick(r,this.message)}catch(e){e instanceof Error&&this.errorHandler(e,"BrazeMessage.logButtonClick")}}},{key:"extras",get:function(){return this.message.extras}}]),e}(),B=function(){function e(r,t,n){o(this,e),this.appboy=void 0,this.freshMessageBySlot=void 0,this.cache=void 0,this.errorHandler=void 0,this.appboy=r,this.cache=t,this.freshMessageBySlot={Banner:this.getFreshMessagesForSlot("Banner"),EndOfArticle:this.getFreshMessagesForSlot("EndOfArticle")},this.errorHandler=n}return i(e,[{key:"getFreshMessagesForSlot",value:function(e){var r=this;return new Promise((function(t){r.appboy.subscribeToInAppMessage((function(n){var o=n,a=o.extras;a&&a.slotName&&a.slotName===e&&(r.cache.push(e,{message:o,id:"".concat(Math.random().toString(16).slice(2),"-").concat((new Date).getTime())},r.errorHandler),t(o))}))}))}},{key:"getMessageForBanner",value:function(e){return this.getMessageForSlot("Banner",e)}},{key:"getMessageForEndOfArticle",value:function(e){return this.getMessageForSlot("EndOfArticle",e)}},{key:"getMessageForSlot",value:function(e,r){var t=this,n=this.getHighestPriorityMessageFromCache(e,r);return n?Promise.resolve(n):this.freshMessageBySlot[e].then((function(){var n=t.getHighestPriorityMessageFromCache(e,r);if(n)return Promise.resolve(n);throw new Error("No valid messages for ".concat(e," slot"))}))}},{key:"getHighestPriorityMessageFromCache",value:function(e,r){var t,n=this.cache.all(e,this.appboy,this.errorHandler).filter((function(e){return!!(r=e.message.extras)&&!!C[r.componentName]&&C[r.componentName](r);var r})),o={messagesWithFilters:(t=n).filter((function(e){return Boolean(e.message.extras.section)})),messagesWithoutFilters:t.filter((function(e){return!Boolean(e.message.extras.section)}))},a=o.messagesWithoutFilters,i=u(o.messagesWithFilters.concat(a).filter((function(e){var t;if(!e.message.extras.section||"string"!=typeof e.message.extras.section)return!0;var n=null==r||null===(t=r.section)||void 0===t?void 0:t.toLowerCase();return!!n&&e.message.extras.section.split("|").map((function(e){return e.toLowerCase()})).includes(n)})),1)[0];if(i)return new k(i.id,i.message,this.appboy,e,this.cache,this.errorHandler)}}]),e}(),E=function(){function e(){o(this,e)}return i(e,[{key:"getMessageForBanner",value:function(){return Promise.reject(new Error("No banner message"))}},{key:"getMessageForEndOfArticle",value:function(){return Promise.reject(new Error("No end of article message"))}}]),e}();(g=d||(d={})).Banner="Banner",g.EndOfArticle="EndOfArticle",function(e){e.ProfileBadge="ProfileBadge"}(h||(h={}));var I=function(){function e(r,t,n,a,i){o(this,e),this.id=void 0,this.slotName=void 0,this.card=void 0,this.appboy=void 0,this.errorHandler=void 0,this.id=r,this.slotName=t,this.card=n,this.appboy=a,this.errorHandler=i}return i(e,[{key:"logImpression",value:function(){try{this.appboy.logCardImpressions([this.card],!0)||this.errorHandler(new Error("Failed to log card impression event"),"BrazeCard.logImpressions")}catch(e){e instanceof Error&&this.errorHandler(e,"BrazeCard.logImpressions")}}},{key:"logCardClick",value:function(){try{this.appboy.logCardClick(this.card,!0)||this.errorHandler(new Error("Failed to log card click event"),"BrazeCard.logCardClick")}catch(e){e instanceof Error&&this.errorHandler(e,"BrazeCard.logCardClick")}}},{key:"logCardDismissal",value:function(){try{this.appboy.logCardDismissal(this.card)||this.errorHandler(new Error("Failed to log card dismiss event"),"BrazeCard.logCardDismiss")}catch(e){e instanceof Error&&this.errorHandler(e,"BrazeCard.logCardDismiss")}}},{key:"extras",get:function(){var e=this.card.extras;return void 0===e?{}:e}},{key:"expiry",get:function(){var e=this.card.expiresAt;return null===e?void 0:e}}]),e}(),O=function(){function e(r,t){o(this,e),this.appboy=void 0,this.errorHandler=void 0,this.appboy=r,this.errorHandler=t}return i(e,[{key:"getCardsForProfileBadge",value:function(){return this.getCardsForSlot(h.ProfileBadge)}},{key:"getCardsForSlot",value:function(e){var r=this;return this.appboy.getCachedContentCards().cards.flatMap((function(t){var n=t.extras;return n&&n.slotName&&n.slotName===e?void 0===t.id?(r.errorHandler(new Error("appboy card had no ID"),"BrazeCards.getCardsForSlot"),[]):[new I(t.id,e,t,r.appboy,r.errorHandler)]:[]}))}},{key:"lastUpdated",get:function(){return this.appboy.getCachedContentCards().lastUpdated}}]),e}(),x=function(){function e(){o(this,e)}return i(e,[{key:"getCardsForProfileBadge",value:function(){return[]}}]),e}(),j=function(e){return"".concat("gu.brazeMessageCache",".").concat(e)},A=function(e,r){var t=j(e);n.t.local.set(t,r)},F=function(e,r){return new r.HtmlMessage(e.message,e.extras,e.campaignId,e.cardId,e.triggerId,e.dismissType,e.duration,e.animateIn,e.animateOut,e.frameColor,e.htmlId,e.css,e.messageFields)},M=function(e,r){var t=function(e){var r=j(e),t=n.t.local.get(r);return Array.isArray(t)?t:[]}(e),o=t.filter((function(e){return r=e,Boolean((null==r?void 0:r.expires)&&Number.isFinite(null==r?void 0:r.expires)&&(null==r||null===(t=r.message)||void 0===t?void 0:t.id)&&(null==r||null===(n=r.message)||void 0===n||null===(o=n.message)||void 0===o?void 0:o.triggerId)&&(null==r||null===(a=r.message)||void 0===a||null===(i=a.message)||void 0===i?void 0:i.extras));var r,t,n,o,a,i})).filter((function(e){return e.expires>Date.now()}));if(t.length!==o.length){var a=t.length-o.length;r(Error("Removed ".concat(a," expired message").concat(1===a?"":"s"," from queue")),"LocalMessageCache"),A(e,o)}return o},S=function(){function e(){o(this,e)}return i(e,null,[{key:"peek",value:function(e,r,t){var n=M(e,t)[0];if(n)return{id:n.message.id,message:F(n.message.message,r)}}},{key:"all",value:function(e,r,t){return M(e,t).map((function(e){return{id:e.message.id,message:F(e.message.message,r)}}))}},{key:"remove",value:function(e,r,t){var n=M(e,t),o=n.findIndex((function(e){return e.message.id===r}));return!!(o>=0&&n.splice(o,1))&&(A(e,n),!0)}},{key:"push",value:function(e,r,t){var n=M(e,t);if(n.length<2){var o={message:r,expires:Date.now()+864e5};return n.push(o),A(e,n),!0}return t(new Error("Failed to add message to queue - queue full"),"LocalMessageCache"),!1}},{key:"clear",value:function(){for(var e in d){var r=j(e);n.t.local.remove(r)}}}]),e}()},3742:(e,r,t)=>{"use strict";t.d(r,{p:()=>o});var n=/\b\/{2,}/g,o=function(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.join("/").replace(n,"/")}},1846:(e,r,t)=>{"use strict";t.d(r,{DF:()=>f,Ec:()=>g,Eg:()=>p,Es:()=>i,Nh:()=>v,Pg:()=>m,bv:()=>h,lL:()=>u});var n=t(4649);function o(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function a(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?o(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var i=function(e){return e.get("gu.contributions.views")||void 0},s=function(e){var r=e.getDay()||7;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()-(r-1))/864e5},u=function(e){return e.get("gu.history.weeklyArticleCount")||void 0},c=new Set(["environment/climate-change","environment/climate-crisis","environment/environment","science/science","politics/politics","us-news/us-politics","australia-news/australian-politics","world/world","world/europe-news","world/russia","books/books","culture/culture","world/coronavirus-outbreak","world/race","inequality/inequality","technology/technology","business/business"]),l=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.forEach((function(e){var t;c.has(e)&&(r[e]=(null!==(t=r[e])&&void 0!==t?t:0)+1)})),r},f=function(e,r,t){if(!function(e,r){var t=s(new Date),o=e.get("gu.history.articleCountsThisWeek");if(o&&o.week===t){var i=o.articles[r]||0;return e.set("gu.history.articleCountsThisWeek",{week:t,articles:a(a({},o.articles),{},(0,n.Z)({},r,i+1))}),i>0}return e.set("gu.history.articleCountsThisWeek",{week:t,articles:(0,n.Z)({},r,1)}),!1}(e,r)){var o=s(new Date),i=e.get("gu.history.weeklyArticleCount")||[],u=i[0];if(u&&u.week&&u.week===o)u.count+=1,u.tags=l(t,u.tags),e.set("gu.history.weeklyArticleCount",i);else{i.unshift({week:o,count:1,tags:l(t,{})});var c=o-365,f=i.filter((function(e){return e.week>=c}));e.set("gu.history.weeklyArticleCount",f)}}},d=function(e,r,t){var n=function(e){if(URLSearchParams){var r=new URLSearchParams(window.location.search).get("force-"+e);if(r)return r}return null}(e);return fetch("".concat(r,"/").concat(e).concat(n?"?force="+n:""),{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(r){if(!r.ok)throw Error(r.statusText||"Supporter Revenue ".concat(e," | Api call returned HTTP status ").concat(r.status));return r})).then((function(e){return e.json()}))},h=function(e,r){return d("epic",e,r)},g=function(e,r){return d("liveblog-epic",e,r)},p=function(e,r){return d("banner",e,r)},v=function(e,r){return d("puzzles",e,r)},m=function(e,r){return d("header",e,r)}},3198:(e,r,t)=>{var n=NaN,o="[object Symbol]",a=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,u=/^0o[0-7]+$/i,c=parseInt,l="object"==typeof t.g&&t.g&&t.g.Object===Object&&t.g,f="object"==typeof self&&self&&self.Object===Object&&self,d=l||f||Function("return this")(),h=Object.prototype.toString,g=Math.max,p=Math.min,v=function(){return d.Date.now()};function m(e){var r=typeof e;return!!e&&("object"==r||"function"==r)}function y(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&h.call(e)==o}(e))return n;if(m(e)){var r="function"==typeof e.valueOf?e.valueOf():e;e=m(r)?r+"":r}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(a,"");var t=s.test(e);return t||u.test(e)?c(e.slice(2),t?2:8):i.test(e)?n:+e}e.exports=function(e,r,t){var n,o,a,i,s,u,c=0,l=!1,f=!1,d=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function h(r){var t=n,a=o;return n=o=void 0,c=r,i=e.apply(a,t)}function b(e){var t=e-u;return void 0===u||t>=r||t<0||f&&e-c>=a}function w(){var e=v();if(b(e))return C(e);s=setTimeout(w,function(e){var t=r-(e-u);return f?p(t,a-(e-c)):t}(e))}function C(e){return s=void 0,d&&n?h(e):(n=o=void 0,i)}function k(){var e=v(),t=b(e);if(n=arguments,o=this,u=e,t){if(void 0===s)return function(e){return c=e,s=setTimeout(w,r),l?h(e):i}(u);if(f)return s=setTimeout(w,r),h(u)}return void 0===s&&(s=setTimeout(w,r)),i}return r=y(r)||0,m(t)&&(l=!!t.leading,a=(f="maxWait"in t)?g(y(t.maxWait)||0,r):a,d="trailing"in t?!!t.trailing:d),k.cancel=function(){void 0!==s&&clearTimeout(s),c=0,n=u=o=s=void 0},k.flush=function(){return void 0===s?i:C(v())},k}}}]);
//# sourceMappingURL=5992.legacy.f8c613a7581c707bd048.js.map