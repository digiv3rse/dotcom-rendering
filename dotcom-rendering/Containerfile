# This container is used in our CICD pipelines for running E2E and regression tests.
FROM node:16.19.0-alpine AS dependencies

COPY ./node_modules /opt/app/dotcom-rendering/node_modules
COPY ./dotcom-rendering/node_modules /opt/app/dotcom-rendering/dotcom-rendering/node_modules

# Seperate dependencies into their own layer to allow for better caching
FROM dependencies

WORKDIR /opt/app/dotcom-rendering/dotcom-rendering

COPY ./dotcom-rendering/dist /opt/app/dotcom-rendering/dotcom-rendering/dist

EXPOSE 9000

ENV DISABLE_LOGGING_AND_METRICS=true
ENV NODE_ENV=production

ENTRYPOINT ["node", "dist/frontend.server.js"]
